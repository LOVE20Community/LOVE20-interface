(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1786],{75125:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote",function(){return t(36968)}])},27460:function(e,s,t){"use strict";var n=t(85893),r=t(86501),a=t(74855),l=t(18289),i=t(91529);s.Z=e=>{let{address:s,showCopyButton:t=!0,showAddress:c=!0}=e;return(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[c&&(0,n.jsx)("span",{className:"text-xs text-gray-500",children:(0,i.Vu)(s)}),t&&(0,n.jsx)(a.CopyToClipboard,{text:s,onCopy:(e,s)=>{s?r.ZP.success("复制成功"):r.ZP.error("复制失败")},children:(0,n.jsx)("button",{className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",onClick:e=>{e.preventDefault(),e.stopPropagation()},"aria-label":"复制地址",children:(0,n.jsx)(l.Z,{className:"h-4 w-4 text-gray-500"})})})]})}},74089:function(e,s,t){"use strict";var n=t(85893),r=t(67294),a=t(91529);s.Z=e=>{let{initialTimeLeft:s}=e,[t,l]=(0,r.useState)(s);(0,r.useEffect)(()=>{if(s<=0)return;l(s);let e=setInterval(()=>{l(s=>s<=1?(clearInterval(e),window.location.reload(),0):s-1)},1e3);return()=>{clearInterval(e)}},[s]);let i=(0,a.ZC)(t);return(0,n.jsx)(n.Fragment,{children:i})}},91318:function(e,s,t){"use strict";var n=t(85893);s.Z=()=>(0,n.jsx)("span",{className:"flex justify-center items-center",children:(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},7191:function(e,s,t){"use strict";var n=t(85893);t(67294);var r=t(3125),a=t(74089);s.Z=e=>{let{currentRound:s,roundName:t}=e,{data:l}=(0,r.O)(),i=Number("100")||0,c=Number("12")||0,d=l?i-Number(l)%i:0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("h1",{className:"text-base text-center font-bold",children:[t,"（第 ",(0,n.jsx)("span",{className:"text-red-500",children:Number(null!=s?s:0n)})," 轮）"]}),(0,n.jsxs)("span",{className:"text-sm text-gray-400 mt-1 pt-0",children:["本轮剩余：",(0,n.jsx)(a.Z,{initialTimeLeft:d>0?d*c:0})]})]})}},36968:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var n=t(85893),r=t(35337),a=t(41664),l=t.n(a),i=t(7080),c=t(67294),d=t(11163),o=t(86501),u=t(27245),x=t(94782),m=t(93778),h=t(91318),j=t(27460),f=e=>{let{currentRound:s}=e,{token:t}=(0,c.useContext)(m.M)||{},r=(0,d.useRouter)(),{votes:a,isPending:f,error:N}=(0,i.$S)((null==t?void 0:t.address)||"",s),{actionSubmits:g,isPending:v,error:b}=(0,x.WZ)((null==t?void 0:t.address)||"",s),p=Array.from(new Set((null==g?void 0:g.map(e=>BigInt(e.actionId)))||[])).sort((e,s)=>Number(e)-Number(s)),{actionInfos:y,isPending:w,error:Z}=(0,x.fT)((null==t?void 0:t.address)||"",p),[k,C]=(0,c.useState)(new Set),_=e=>{C(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},I=(null==a?void 0:a.reduce((e,s)=>e+s,0n))||0n;return f||v||p&&p.length>0&&w?(0,n.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,n.jsx)(h.Z,{})}):b||Z?(0,n.jsx)("div",{children:"加载出错，请稍后再试。"}):(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h2",{className:"text-sm font-bold mb-4 text-gray-600",children:"行动列表 (行动轮)"}),(0,n.jsx)("div",{className:"space-y-4",children:p.length>0?(0,n.jsxs)(n.Fragment,{children:[null==y?void 0:y.map((e,s)=>{var t;let r=null==g?void 0:null===(t=g.find(s=>BigInt(s.actionId)===BigInt(e.head.id)))||void 0===t?void 0:t.submitter;return(0,n.jsxs)("div",{className:"flex bg-white p-4 rounded-lg mb-4",children:[(0,n.jsx)("input",{type:"checkbox",className:"checkbox checkbox-warning mr-2",checked:k.has(BigInt(e.head.id)),onChange:()=>_(BigInt(e.head.id))}),(0,n.jsxs)(l(),{href:"/action/".concat(e.head.id,"?type=vote"),className:"flex-grow block",children:[(0,n.jsxs)("div",{className:"font-semibold mb-2",children:[(0,n.jsx)("span",{className:"text-gray-400 text-base mr-1",children:"No.".concat(e.head.id)}),(0,n.jsx)("span",{className:"text-gray-800 text-lg",children:"".concat(e.body.action)})]}),(0,n.jsx)("p",{className:"leading-tight",children:e.body.consensus}),(0,n.jsxs)("div",{className:"flex justify-between mt-1 text-gray-400",children:[(0,n.jsxs)("span",{className:"text-sm flex-1",children:["推举人 ",(0,n.jsx)(j.Z,{address:r,showCopyButton:!1})]}),(0,n.jsxs)("span",{className:"text-sm flex-1 text-right",children:[(0,n.jsx)("span",{className:"mr-1",children:"投票占比"}),0===Number((null==a?void 0:a[s])||0n)?"0":(100*Number((null==a?void 0:a[s])||0n)/Number(I)).toFixed(1),"%"]})]})]})]},e.head.id)}),(0,n.jsx)("div",{className:"flex justify-center mt-4",children:(0,n.jsx)(u.z,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{let e=Array.from(k).join(",");if(0===e.length){o.Am.error("请选择行动");return}r.push("/vote/vote?ids=".concat(e))},children:"投票"})})]}):(0,n.jsx)("div",{className:"text-sm text-gray-500 text-center",children:"没有行动"})})]})},N=t(7191),g=()=>{let{currentRound:e,isPending:s,error:t}=(0,i.Bk)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{title:"投票首页"}),(0,n.jsxs)("main",{className:"flex-grow",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-white",children:[s?(0,n.jsx)(h.Z,{}):(0,n.jsx)(N.Z,{currentRound:e,roundName:"投票轮"}),(0,n.jsx)(l(),{href:"/vote/actions4submit",className:"w-1/2",children:(0,n.jsx)(u.z,{className:"w-full bg-blue-600 hover:bg-blue-700",children:"推举其他行动"})})]}),(0,n.jsx)(f,{currentRound:e})]})]})}}},function(e){e.O(0,[4846,8424,8741,7140,5714,2888,9774,179],function(){return e(e.s=75125)}),_N_E=e.O()}]);