(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{44104:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/[id]",function(){return t(89703)}])},89703:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var r=t(85893),n=t(67294),l=t(11163),a=t(35337),i=t(20725),c=t(86501),d=t(94782),x=t(93778),o=t(91318),m=e=>{let{actionId:s,submitted:t,onRoundChange:a}=e,{token:i}=(0,n.useContext)(x.M)||{},m=(0,l.useRouter)(),{currentRound:u,isPending:h,error:f}=(0,d.Bk)();(0,n.useEffect)(()=>{a&&"function"==typeof a&&a(u)},[u,a]);let{submit:j,isWriting:b,isConfirming:g,isConfirmed:N,writeError:p}=(0,d.qd)();return(0,n.useEffect)(()=>{N&&!p&&(c.Am.success("推举成功",{duration:2e3}),setTimeout(()=>{m.push("/vote")},2e3))},[N,p]),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-base-100 mb-4 border-t border-gray-100",children:[(0,r.jsxs)("h1",{className:"text-base text-center",children:["投票轮 (第 ",(0,r.jsx)("span",{className:"text-red-500",children:h?(0,r.jsx)(o.Z,{}):Number(u)}),"轮)"]}),t||N?(0,r.jsx)("button",{className:"btn w-1/2",children:"已推举"}):(0,r.jsx)("button",{onClick:()=>{b||g||j(null==i?void 0:i.address,s)},className:"btn-primary btn w-1/2",children:b||g?(0,r.jsx)(o.Z,{}):"推举"}),p?(0,r.jsxs)("p",{className:"text-red-500",children:["Error: ",p.shortMessage||p.message]}):null]})},u=t(92321),h=t(92180),f=t(7080),j=t(22877),b=e=>{let{actionId:s,onRoundChange:t}=e,{address:l}=(0,u.m)(),{token:a}=(0,n.useContext)(x.M)||{},{currentRound:i,isPending:c,error:d}=(0,f.Bk)();(0,n.useEffect)(()=>{t&&"function"==typeof t&&t(i)},[i,t]);let{validGovVotes:m,isPending:b}=(0,h.Ty)(null==a?void 0:a.address,l),{votesNumByAccountByActionId:g,isPending:N,error:p}=(0,f.Ol)(null==a?void 0:a.address,i,l,s),{vote:v,isWriting:y,isConfirming:w,isConfirmed:E,writeError:C}=(0,f.rv)();return(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-base-100 mb-4 border-t border-gray-100 ",children:[(0,r.jsxs)("h1",{className:"text-base text-center",children:["投票轮 (第",(0,r.jsx)("span",{className:"text-red-500",children:c?(0,r.jsx)(o.Z,{}):Number(i)}),"轮)"]}),(0,r.jsxs)("div",{className:"flex w-full justify-center space-x-20",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"我的已投票数"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:N?(0,r.jsx)(o.Z,{}):(0,j.L)(g||BigInt(0))})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"我的剩余票数"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:b||N?(0,r.jsx)(o.Z,{}):(0,j.L)(m-g)})]})]}),N||g?(0,r.jsx)("div",{className:"flex flex-col items-center",children:(0,r.jsx)("button",{disabled:!0,className:"btn-disabled",children:"您已投票"})}):(0,r.jsx)("button",{className:"btn-primary btn w-1/2",onClick:()=>{y||w||v(null==a?void 0:a.address,[s],[m])},disabled:y||w,children:y||w?(0,r.jsx)(o.Z,{}):"投100%票"}),p?(0,r.jsxs)("p",{className:"text-red-500",children:["Error:",p.shortMessage||p.message]}):null,C?(0,r.jsxs)("p",{className:"text-red-500",children:["Error: ",C.shortMessage||C.message]}):null]})},g=t(41664),N=t.n(g),p=t(5028),v=e=>{let{actionId:s,onRoundChange:t}=e,{address:l}=(0,u.m)(),{token:a}=(0,n.useContext)(x.M)||{},{currentRound:i,isPending:c,error:d}=(0,p.Bk)();(0,n.useEffect)(()=>{t&&"function"==typeof t&&t(i)},[i,t]);let{joinedAmountByActionIdByAccount:m,isPending:h,error:f}=(0,p.X9)((null==a?void 0:a.address)||"",i,s,l||""),{joinedAmountByActionId:b,isPending:g,error:v}=(0,p.PL)((null==a?void 0:a.address)||"",i,s),y=m&&m>0&&b&&b>0,w=y?100*Number(m/b)+"%":"0%",{verificationInfo:E,isPending:C,error:I}=(0,p.Y5)((null==a?void 0:a.address)||"",i,s,l||"",y);return(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-base-100 mb-4 border-t border-gray-100 ",children:[(0,r.jsxs)("h1",{className:"text-base text-center",children:["行动轮 (第 ",(0,r.jsx)("span",{className:"text-red-500",children:c?(0,r.jsx)(o.Z,{}):Number(i)}),"轮)"]}),(0,r.jsxs)("div",{className:"flex w-full justify-center space-x-20",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"我参与的代币数"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:g?(0,r.jsx)(o.Z,{}):(0,j.L)(m||BigInt(0))})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"所占比例"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:w})]})]}),y?(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("button",{disabled:!0,className:"btn btn-disabled",children:"您已参与"}),(0,r.jsx)("div",{className:"mt-2 text-sm text-gray-600",children:C?"加载中...":E})]}):(0,r.jsx)(N(),{href:"/acting/join?id=".concat(s),className:"btn-primary btn w-1/2",children:"参与行动"})]})},y=t(87250),w=e=>{let{actionId:s,onRoundChange:t}=e,{token:l}=(0,n.useContext)(x.M)||{},{address:a}=(0,u.m)(),{currentRound:i,isPending:c,error:d}=(0,y.Bk)();(0,n.useEffect)(()=>{t&&"function"==typeof t&&t(i)},[i,t]);let{scoreByVerifierByActionId:m,isPending:h,error:f}=(0,y.Tl)(null==l?void 0:l.address,i,a,s);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-base-100 mb-4 border-t border-gray-100",children:[(0,r.jsxs)("h1",{className:"text-base text-center",children:["验证轮 (第 ",(0,r.jsx)("span",{className:"text-red-500",children:c?(0,r.jsx)(o.Z,{}):Number(i)}),"轮)"]}),h?(0,r.jsx)(o.Z,{}):m?(0,r.jsx)("button",{className:"btn-default btn w-1/2",children:"已验证"}):(0,r.jsx)(N(),{href:"/verify/".concat(s),className:"btn-primary btn w-1/2",children:"去验证"}),d&&(0,r.jsxs)("p",{className:"text-red-500",children:["Error: ",d.shortMessage||d.message]}),f&&(0,r.jsxs)("p",{className:"text-red-500",children:["Error:"," ",f.shortMessage||f.message]})]})})},E=()=>{let{id:e,type:s,submitted:t}=(0,l.useRouter)().query,[c,d]=(0,n.useState)(null),x=e=>{d(e)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{title:"行动详情"}),(0,r.jsxs)("main",{className:"flex-grow",children:["submit"===s&&(0,r.jsx)(m,{actionId:BigInt(e||0),submitted:"true"===t,onRoundChange:x}),"vote"===s&&(0,r.jsx)(b,{actionId:BigInt(e||0),onRoundChange:x}),("join"===s||void 0===s)&&(0,r.jsx)(v,{actionId:BigInt(e||0),onRoundChange:x}),"verify"===s&&(0,r.jsx)(w,{actionId:BigInt(e||0),onRoundChange:x}),(0,r.jsx)(i.Z,{actionId:BigInt(e||0),round:BigInt(c||0),showSubmitter:"submit"!==s})]})]})}}},function(e){e.O(0,[8554,6789,8205,7080,7250,2180,379,2888,9774,179],function(){return e(e.s=44104)}),_N_E=e.O()}]);