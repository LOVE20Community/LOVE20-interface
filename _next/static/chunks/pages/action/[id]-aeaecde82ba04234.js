(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{44104:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/[id]",function(){return r(89703)}])},89703:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return C}});var t=r(85893),l=r(67294),n=r(11163),a=r(35337),c=r(20725),i=r(86501),d=r(27245),x=r(94782),o=r(93778),u=r(91318),m=e=>{let{actionId:s,submitted:r,onRoundChange:a}=e,{token:c}=(0,l.useContext)(o.M)||{},m=(0,n.useRouter)(),{currentRound:h,isPending:g,error:f}=(0,x.Bk)();(0,l.useEffect)(()=>{a&&"function"==typeof a&&a(h)},[h,a]);let{submit:j,isWriting:b,isConfirming:N,isConfirmed:p,writeError:v}=(0,x.qd)();return(0,l.useEffect)(()=>{p&&!v&&(i.Am.success("推举成功",{duration:2e3}),setTimeout(()=>{m.push("/vote")},2e3))},[p,v]),(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-white mb-4 border-t border-gray-100",children:[(0,t.jsxs)("h1",{className:"text-base text-center",children:["投票轮 (第 ",(0,t.jsx)("span",{className:"text-red-500",children:g?(0,t.jsx)(u.Z,{}):Number(h)}),"轮)"]}),r||p?(0,t.jsx)(d.z,{className:"w-1/2 bg-gray-400 cursor-not-allowed",children:"已推举"}):(0,t.jsx)(d.z,{onClick:()=>{b||N||j(null==c?void 0:c.address,s)},className:"w-1/2 bg-blue-600 hover:bg-blue-700",children:b||N?(0,t.jsx)(u.Z,{}):"推举"}),v?(0,t.jsxs)("p",{className:"text-red-500",children:["Error: ",v.shortMessage||v.message]}):null]})},h=r(92321),g=r(92180),f=r(7080),j=r(91529),b=e=>{let{actionId:s,onRoundChange:r}=e,{address:n}=(0,h.m)(),{token:a}=(0,l.useContext)(o.M)||{},{currentRound:c,isPending:i,error:x}=(0,f.Bk)();(0,l.useEffect)(()=>{r&&"function"==typeof r&&r(c)},[c,r]);let{validGovVotes:m,isPending:b}=(0,g.Ty)(null==a?void 0:a.address,n),{votesNumByAccountByActionId:N,isPending:p,error:v}=(0,f.Ol)(null==a?void 0:a.address,c,n,s),{vote:w,isWriting:y,isConfirming:E,isConfirmed:C,writeError:I}=(0,f.rv)();return(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-white mb-4 border-t border-gray-100 ",children:[(0,t.jsxs)("h1",{className:"text-base text-center",children:["投票轮 (第",(0,t.jsx)("span",{className:"text-red-500",children:i?(0,t.jsx)(u.Z,{}):Number(c)}),"轮)"]}),(0,t.jsxs)("div",{className:"flex w-full justify-center space-x-20",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"我的已投票数"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:p?(0,t.jsx)(u.Z,{}):(0,j.LH)(N||BigInt(0))})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"我的剩余票数"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:b||p?(0,t.jsx)(u.Z,{}):(0,j.LH)(m-N)})]})]}),p||N?(0,t.jsx)("div",{className:"flex flex-col items-center",children:(0,t.jsx)(d.z,{className:"w-1/2 bg-gray-400 cursor-not-allowed",children:"您已投票"})}):(0,t.jsx)(d.z,{className:"w-1/2 bg-blue-600 hover:bg-blue-700",onClick:()=>{y||E||w(null==a?void 0:a.address,[s],[m])},disabled:y||E,children:y||E?(0,t.jsx)(u.Z,{}):"投100%票"}),v?(0,t.jsxs)("p",{className:"text-red-500",children:["Error:",v.shortMessage||v.message]}):null,I?(0,t.jsxs)("p",{className:"text-red-500",children:["Error: ",I.shortMessage||I.message]}):null]})},N=r(41664),p=r.n(N),v=r(5028),w=e=>{let{actionId:s,onRoundChange:r}=e,{address:n}=(0,h.m)(),{token:a}=(0,l.useContext)(o.M)||{},{currentRound:c,isPending:i,error:x}=(0,v.Bk)();(0,l.useEffect)(()=>{r&&"function"==typeof r&&r(c)},[c,r]);let{joinedAmountByActionIdByAccount:m,isPending:g,error:f}=(0,v.X9)((null==a?void 0:a.address)||"",c,s,n||""),{joinedAmountByActionId:b,isPending:N,error:w}=(0,v.PL)((null==a?void 0:a.address)||"",c,s),y=m&&m>0&&b&&b>0,E=y?100*Number(m/b)+"%":"0%",{verificationInfo:C,isPending:I,error:P}=(0,v.Y5)((null==a?void 0:a.address)||"",c,s,n||"",y);return(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-white mb-4 border-t border-gray-100 ",children:[(0,t.jsxs)("h1",{className:"text-base text-center",children:["行动轮 (第 ",(0,t.jsx)("span",{className:"text-red-500",children:i?(0,t.jsx)(u.Z,{}):Number(c)}),"轮)"]}),(0,t.jsxs)("div",{className:"flex w-full justify-center space-x-20",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"我参与的代币数"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:N?(0,t.jsx)(u.Z,{}):(0,j.LH)(m||BigInt(0))})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"所占比例"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:E})]})]}),y?(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)(d.z,{disabled:!0,className:"w-full bg-gray-400 cursor-not-allowed",children:"您已参与"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-gray-600",children:I?"加载中...":C})]}):(0,t.jsx)(p(),{href:"/acting/join?id=".concat(s),className:"w-1/2",children:(0,t.jsx)(d.z,{className:"w-full bg-blue-600 hover:bg-blue-700",children:"参与行动"})})]})},y=r(87250),E=e=>{let{actionId:s,onRoundChange:r}=e,{token:n}=(0,l.useContext)(o.M)||{},{address:a}=(0,h.m)(),{currentRound:c,isPending:i,error:x}=(0,y.Bk)();(0,l.useEffect)(()=>{r&&"function"==typeof r&&r(c)},[c,r]);let{scoreByVerifierByActionId:m,isPending:g,error:f}=(0,y.Tl)(null==n?void 0:n.address,c,a,s);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-6 p-8 bg-white mb-4 border-t border-gray-100",children:[(0,t.jsxs)("h1",{className:"text-base text-center",children:["验证轮 (第 ",(0,t.jsx)("span",{className:"text-red-500",children:i?(0,t.jsx)(u.Z,{}):Number(c)}),"轮)"]}),g?(0,t.jsx)(u.Z,{}):m?(0,t.jsx)(d.z,{className:"w-full bg-gray-400 cursor-not-allowed",children:"已验证"}):(0,t.jsx)(p(),{href:"/verify/".concat(s),className:"w-1/2",children:(0,t.jsx)(d.z,{className:"w-full bg-blue-600 hover:bg-blue-700",children:"去验证"})}),x&&(0,t.jsxs)("p",{className:"text-red-500",children:["Error: ",x.shortMessage||x.message]}),f&&(0,t.jsxs)("p",{className:"text-red-500",children:["Error:"," ",f.shortMessage||f.message]})]})})},C=()=>{let{id:e,type:s,submitted:r}=(0,n.useRouter)().query,[i,d]=(0,l.useState)(null),x=e=>{d(e)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Z,{title:"行动详情"}),(0,t.jsxs)("main",{className:"flex-grow",children:["submit"===s&&(0,t.jsx)(m,{actionId:BigInt(e||0),submitted:"true"===r,onRoundChange:x}),"vote"===s&&(0,t.jsx)(b,{actionId:BigInt(e||0),onRoundChange:x}),("join"===s||void 0===s)&&(0,t.jsx)(w,{actionId:BigInt(e||0),onRoundChange:x}),"verify"===s&&(0,t.jsx)(E,{actionId:BigInt(e||0),onRoundChange:x}),(0,t.jsx)(c.Z,{actionId:BigInt(e||0),round:BigInt(i||0),showSubmitter:"submit"!==s})]})]})}}},function(e){e.O(0,[9215,8424,6789,3601,2077,765,7250,379,2888,9774,179],function(){return e(e.s=44104)}),_N_E=e.O()}]);