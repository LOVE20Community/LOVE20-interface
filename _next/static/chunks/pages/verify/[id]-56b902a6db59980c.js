(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5394],{143:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/[id]",function(){return t(37295)}])},91318:function(e,s,t){"use strict";var n=t(85893);s.Z=()=>(0,n.jsx)("span",{className:"flex justify-center items-center",children:(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},37295:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var n=t(85893),r=t(11163),a=t(67294),l=t(87250),i=t(35337),c=t(20725),d=t(92321),o=t(7080),u=t(93778),x=t(91529),m=t(91318),h=e=>{let{currentRound:s,actionId:t,onRemainingVotesChange:r}=e,{token:i}=(0,a.useContext)(u.M)||{},{address:c}=(0,d.m)(),{votesNumByAccountByActionId:h,isPending:f,error:j}=(0,o.Ol)(null==i?void 0:i.address,s,c||"",t),{scoreByVerifierByActionId:g,isPending:b,error:p}=(0,l.Tl)(null==i?void 0:i.address,s,c||"",t),N=f||b?BigInt(0):h-g;return(0,a.useEffect)(()=>{f||b||null==r||r(N)},[N]),(0,n.jsx)("div",{className:"mb-4 text-center",children:(0,n.jsxs)("span",{className:"font-semibold",children:["我的剩余验证票数：",f||b?(0,n.jsx)(m.Z,{}):(0,n.jsx)("span",{className:"text-orange-500",children:(0,x.LH)(N)})]})})},f=t(86501),j=t(45551),g=t(27460),b=e=>{let{currentRound:s,actionId:t,remainingVotes:i}=e,{token:c}=(0,a.useContext)(u.M)||{},d=(0,r.useRouter)(),{accounts:o,infos:x,isPending:h,error:b}=(0,j.X5)(null==c?void 0:c.address,s,t);(0,a.useEffect)(()=>{if(o&&o.length>0){let e=Math.floor(100/o.length).toString(),s={};o.forEach(t=>{s[t]=e}),N(s)}},[o]);let[p,N]=(0,a.useState)({}),v=100-Object.values(p).reduce((e,s)=>e+(parseInt(s)||0),0),y=(e,s)=>{N({...p,[e]:s})},{verify:w,isWriting:_,isConfirmed:I,writeError:E}=(0,l.yl)();return(0,a.useEffect)(()=>{I&&!E&&(f.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{d.push("/verify")},2e3))},[I,E]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-full max-w-2xl",children:(0,n.jsxs)("ul",{className:"space-y-4",children:[h&&(0,n.jsx)(m.Z,{}),o&&o.length>0?o.map((e,s)=>(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("div",{className:"font-mono",children:(0,n.jsx)(g.Z,{address:e})}),(0,n.jsx)("div",{className:"text-sm text-gray-800",children:x[s]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:p[e]||"",onChange:s=>y(e,s.target.value),className:"w-13 px-1 py-1 border rounded",disabled:_||I}),"%"]})]},e)):(0,n.jsx)("div",{className:"text-center text-gray-500",children:"没有人参与活动"}),o&&(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsx)("div",{className:"text-left",children:(0,n.jsx)("div",{className:"text-sm text-gray-800",children:(0,n.jsx)("span",{children:"弃权票数："})})}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:v,className:"w-13 px-1 py-1 border rounded",disabled:!0}),"%"]})]})]})}),i>0&&(0,n.jsx)("button",{onClick:()=>{let e=o.map(e=>BigInt(parseInt(p[e]||"0"))*i/100n),s=BigInt(v)*i/100n;w(null==c?void 0:c.address,t,s,e)},disabled:_||I,className:"mt-6 px-6 py-2 rounded ".concat(I?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"," text-white"),children:I?"已提交":"提交"}),!i&&(0,n.jsx)("button",{disabled:!0,className:"btn btn-ghost mt-6 px-6 py-2 rounded",children:"提交"}),E&&(0,n.jsx)("div",{className:"text-red-500 text-center",children:E.message})]})},p=()=>{let{id:e}=(0,r.useRouter)().query,s=BigInt(e||"0"),{currentRound:t}=(0,l.Bk)(),[d,o]=(0,a.useState)(BigInt(0));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{title:"验证页面"}),(0,n.jsxs)("main",{className:"flex-grow",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center p-4 border-t border-gray-200 bg-base-100 mb-4",children:[(0,n.jsx)(h,{currentRound:t,actionId:s,onRemainingVotesChange:function(e){o(e)}}),(0,n.jsx)(b,{currentRound:t,actionId:s,remainingVotes:d})]}),(0,n.jsx)(c.Z,{actionId:s,round:BigInt(t||0),showSubmitter:!0})]})]})}}},function(e){e.O(0,[9215,6789,2077,5551,7250,379,2888,9774,179],function(){return e(e.s=143)}),_N_E=e.O()}]);