(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5394],{143:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/[id]",function(){return t(37295)}])},91318:function(e,s,t){"use strict";var n=t(85893);s.Z=()=>(0,n.jsx)("span",{className:"flex justify-center items-center",children:(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},37295:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var n=t(85893),r=t(11163),i=t(67294),a=t(87250),l=t(35337),c=t(20725),d=t(92321),o=t(7080),u=t(93778),x=t(22877),m=t(91318),h=e=>{let{currentRound:s,actionId:t,onRemainingVotesChange:r}=e,{token:l}=(0,i.useContext)(u.M)||{},{address:c}=(0,d.m)(),{votesNumByAccountByActionId:h,isPending:f,error:g}=(0,o.Ol)(null==l?void 0:l.address,s,c||"",t),{scoreByVerifierByActionId:b,isPending:j,error:N}=(0,a.Tl)(null==l?void 0:l.address,s,c||"",t),p=f||j?BigInt(0):h-b;return(0,i.useEffect)(()=>{f||j||null==r||r(p)},[p]),(0,n.jsx)("div",{className:"mb-4 text-center",children:(0,n.jsxs)("span",{className:"font-semibold",children:["我的剩余验证票数：",f||j?(0,n.jsx)(m.Z,{}):(0,n.jsx)("span",{className:"text-orange-500",children:(0,x.L)(p)})]})})},f=t(86501),g=t(45551),b=t(27460),j=e=>{let{currentRound:s,actionId:t,remainingVotes:l}=e,{token:c}=(0,i.useContext)(u.M)||{},d=(0,r.useRouter)(),{accounts:o,infos:x,isPending:h,error:j}=(0,g.X5)(null==c?void 0:c.address,s,t);(0,i.useEffect)(()=>{if(o&&o.length>0){let e=Math.floor(100/o.length).toString(),s={};o.forEach(t=>{s[t]=e}),p(s)}},[o]);let[N,p]=(0,i.useState)({}),v=100-Object.values(N).reduce((e,s)=>e+(parseInt(s)||0),0),y=(e,s)=>{p({...N,[e]:s})},{verify:w,isWriting:I,isConfirmed:_,writeError:E}=(0,a.yl)();return(0,i.useEffect)(()=>{_&&!E&&(f.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{d.push("/verify")},2e3))},[_,E]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-full max-w-2xl",children:(0,n.jsxs)("ul",{className:"space-y-4",children:[h&&(0,n.jsx)(m.Z,{}),o&&o.length>0?o.map((e,s)=>(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("div",{className:"font-mono",children:(0,n.jsx)(b.Z,{address:e})}),(0,n.jsx)("div",{className:"text-sm text-gray-800",children:x[s]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:N[e]||"",onChange:s=>y(e,s.target.value),className:"w-13 px-1 py-1 border rounded",disabled:I||_}),"%"]})]},e)):(0,n.jsx)("div",{className:"text-center text-gray-500",children:"没有人参与活动"}),o&&(0,n.jsxs)("li",{className:"flex justify-between items-center p-4 border-b border-gray-100",children:[(0,n.jsx)("div",{className:"text-left",children:(0,n.jsx)("div",{className:"text-sm text-gray-800",children:(0,n.jsx)("span",{children:"弃权票数："})})}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:"0",max:"100",value:v,className:"w-13 px-1 py-1 border rounded",disabled:!0}),"%"]})]})]})}),l>0&&(0,n.jsx)("button",{onClick:()=>{let e=o.map(e=>BigInt(parseInt(N[e]||"0"))*l/100n),s=BigInt(v)*l/100n;w(null==c?void 0:c.address,t,s,e)},disabled:I||_,className:"mt-6 px-6 py-2 rounded ".concat(_?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"," text-white"),children:_?"已提交":"提交"}),!l&&(0,n.jsx)("button",{disabled:!0,className:"btn btn-ghost mt-6 px-6 py-2 rounded",children:"提交"}),E&&(0,n.jsx)("div",{className:"text-red-500 text-center",children:E.message})]})},N=()=>{let{id:e}=(0,r.useRouter)().query,s=BigInt(e||"0"),{currentRound:t}=(0,a.Bk)(),[d,o]=(0,i.useState)(BigInt(0));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{title:"验证页面"}),(0,n.jsxs)("main",{className:"flex-grow",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center p-4 border-t border-gray-200 bg-base-100 mb-4",children:[(0,n.jsx)(h,{currentRound:t,actionId:s,onRemainingVotesChange:function(e){o(e)}}),(0,n.jsx)(j,{currentRound:t,actionId:s,remainingVotes:d})]}),(0,n.jsx)(c.Z,{actionId:s,round:BigInt(t||0),showSubmitter:!0})]})]})}},22877:function(e,s,t){"use strict";t.d(s,{L:function(){return r},V:function(){return n}});let n=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",r=e=>{let s=10n**BigInt(Number("18")),t=Number(e)/Number(s);return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(t)}}},function(e){e.O(0,[8554,6789,7080,5551,7250,379,2888,9774,179],function(){return e(e.s=143)}),_N_E=e.O()}]);