(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return r(21171)}])},74089:function(e,t,r){"use strict";var n=r(85893),s=r(67294),a=r(91529);t.Z=e=>{let{initialTimeLeft:t}=e,[r,i]=(0,s.useState)(t);(0,s.useEffect)(()=>{if(t<=0)return;i(t);let e=setInterval(()=>{i(t=>t<=1?(clearInterval(e),window.location.reload(),0):t-1)},1e3);return()=>{clearInterval(e)}},[t]);let c=(0,a.ZC)(r);return(0,n.jsx)(n.Fragment,{children:c})}},91318:function(e,t,r){"use strict";var n=r(85893);t.Z=()=>(0,n.jsx)("span",{className:"flex justify-center items-center",children:(0,n.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},7191:function(e,t,r){"use strict";var n=r(85893);r(67294);var s=r(3125),a=r(74089);t.Z=e=>{let{currentRound:t,roundName:r}=e,{data:i}=(0,s.O)(),c=Number("100")||0,l=Number("12")||0,d=i?c-Number(i)%c:0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("h1",{className:"text-base text-center font-bold",children:[r,"（第 ",(0,n.jsx)("span",{className:"text-red-500",children:Number(null!=t?t:0n)})," 轮）"]}),(0,n.jsxs)("span",{className:"text-sm text-gray-400 mt-1 pt-0",children:["本轮剩余：",(0,n.jsx)(a.Z,{initialTimeLeft:d>0?d*l:0})]})]})}},21171:function(e,t,r){"use strict";r.r(t);var n=r(85893),s=r(67294),a=r(11163),i=r(92321),c=r(86501),l=r(27245),d=r(41664),u=r.n(d),o=r(91529),h=r(93778),m=r(94782),f=r(92180),x=r(7080),g=r(35337),b=r(91318),p=r(7191);t.default=()=>{let{token:e}=(0,s.useContext)(h.M)||{},[t,r]=(0,s.useState)({}),{address:d}=(0,i.m)(),{currentRound:N,isPending:y,error:j}=(0,x.Bk)(),v=(0,a.useRouter)(),{ids:w}=v.query,[I,E]=(0,s.useState)([]);(0,s.useEffect)(()=>{w&&E(w.split(",").map(e=>parseInt(e,10)))},[w]),(0,s.useEffect)(()=>{if(1===I.length)r({[I[0]]:100});else{let e={},t=Math.floor(100/I.length);I.forEach((r,n)=>{n===I.length-1?e[r]=100-t*(I.length-1):e[r]=t}),r(e)}},[I]);let C=(e,n)=>{if(1===I.length)return;let s={...t,[e]:n},a=I.slice(0,-1).reduce((e,t)=>e+(s[t]||0),0);if(a>100){c.Am.error("投票百分比之和不能超过100%");return}s[I[I.length-1]]=100-a,r(s)},{validGovVotes:_,isPending:k}=(0,f.Ty)(null==e?void 0:e.address,d),{votesNumByAccount:Z,isPending:q}=(0,x.VI)(null==e?void 0:e.address,N,d),B=(null==I?void 0:I.map(e=>BigInt(e)))||[],{actionInfos:O,isPending:P,error:M}=(0,m.fT)(null==e?void 0:e.address,B),{vote:T,isWriting:F,isConfirming:K,isConfirmed:S,writeError:A}=(0,x.rv)(),L=async()=>{if(100!==Object.values(t).reduce((e,t)=>e+t,0)){c.Am.error("百分比之和必须为100");return}let r=I.map(e=>BigInt(e)),n=I.map(e=>BigInt(t[e]||0)*_/100n);try{await T(null==e?void 0:e.address,r,n)}catch(e){console.error("投票提交失败:",e),c.Am.error("提交失败，请重试")}};return(0,s.useEffect)(()=>{S&&!A&&(c.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{v.push("/gov")},2e3))},[S,A]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{title:"执行投票页"}),(0,n.jsxs)("main",{className:"flex-grow",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-white",children:[y?(0,n.jsx)(b.Z,{}):(0,n.jsx)(p.Z,{currentRound:N,roundName:"投票轮"}),(0,n.jsxs)("div",{className:"text-base text-gray-500",children:[(0,n.jsx)("span",{children:"我的剩余票数："}),k||q?(0,n.jsx)(b.Z,{}):(0,o.LH)(_-Z||BigInt(0))]})]}),(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h2",{className:"text-sm font-bold mb-4 text-gray-600",children:"行动列表 (行动轮)"}),(0,n.jsx)("div",{className:"space-y-4",children:null==O?void 0:O.map((e,r)=>{let s=r===O.length-1,a=100-I.slice(0,-1).reduce((e,r)=>e+(t[r]||0),0);return(0,n.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,n.jsxs)(u(),{href:"/action/".concat(e.head.id,"?type=vote"),className:"flex-grow",children:[(0,n.jsxs)("div",{className:"font-semibold mb-2",children:[(0,n.jsx)("span",{className:"text-gray-400 text-base mr-1",children:"No.".concat(e.head.id)}),(0,n.jsx)("span",{className:"text-gray-800 text-lg",children:"".concat(e.body.action)})]}),(0,n.jsx)("p",{className:"leading-tight",children:e.body.consensus})]},e.head.id),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"number",min:s?a:1,max:"100",value:s?a:t[e.head.id]||"",onChange:t=>C(e.head.id,Number(t.target.value)),className:"p-2 border rounded w-16",disabled:1===I.length||s,placeholder:""}),"%"]})]},e.head.id)})}),(0,n.jsx)("div",{className:"flex justify-center mt-4",children:(0,n.jsx)(l.z,{className:"w-1/2 bg-blue-600 hover:bg-blue-700",onClick:L,disabled:F||K,children:F||K?"提交中...":"提交投票"})}),A?(0,n.jsxs)("div",{className:"text-red-500",children:["Error: ",A.shortMessage||A.message]}):null]})]})]})}},11163:function(e,t,r){e.exports=r(43079)},3125:function(e,t,r){"use strict";r.d(t,{O:function(){return h}});var n=r(30202),s=r(97712),a=r(81946),i=r(36100),c=r(82451),l=r(82002),d=r(37122),u=r(65185),o=r(67294);function h(e={}){let{query:t={},watch:r}=e,h=(0,d.Z)(e),m=(0,n.NL)(),f=(0,l.x)({config:h}),x=e.chainId??f,g=function(e,t={}){return{gcTime:0,async queryFn({queryKey:t}){let{scopeKey:r,...n}=t[1];return await function(e,t={}){let{chainId:r,...n}=t,i=e.getClient({chainId:r});return(0,a.s)(i,s.z,"getBlockNumber")(n)}(e,n)??null},queryKey:function(e={}){return["blockNumber",(0,i.OP)(e)]}(t)}}(h,{...e,chainId:x});return!function(e={}){let{enabled:t=!0,onBlockNumber:r,config:n,...s}=e,i=(0,d.Z)(e),c=(0,l.x)({config:i}),h=e.chainId??c;(0,o.useEffect)(()=>{if(t&&r)return function(e,t){let r,n;let{syncConnectedChain:s=e._internal.syncConnectedChain,...i}=t,c=t=>{r&&r();let n=e.getClient({chainId:t});return r=(0,a.s)(n,u.q,"watchBlockNumber")(i)},l=c(t.chainId);return s&&!t.chainId&&(n=e.subscribe(({chainId:e})=>e,async e=>c(e))),()=>{l?.(),n?.()}}(i,{...s,chainId:h,onBlockNumber:r})},[h,i,t,r,s.onError,s.emitMissed,s.emitOnBegin,s.poll,s.pollingInterval,s.syncConnectedChain])}({...{config:e.config,chainId:e.chainId,..."object"==typeof r?r:{}},enabled:!!((t.enabled??!0)&&("object"==typeof r?r.enabled:r)),onBlockNumber(e){m.setQueryData(g.queryKey,e)}}),(0,c.aM)({...t,...g})}},89810:function(e,t,r){"use strict";r.d(t,{u:function(){return l}});var n=r(37003),s=r(36100),a=r(82451),i=r(82002),c=r(37122);function l(e={}){let{abi:t,address:r,functionName:l,query:d={}}=e,u=e.code,o=(0,c.Z)(e),h=(0,i.x)({config:o}),m=function(e,t={}){return{async queryFn({queryKey:r}){let s=t.abi;if(!s)throw Error("abi is required");let{functionName:a,scopeKey:i,...c}=r[1],l=(()=>{let e=r[1];if(e.address)return{address:e.address};if(e.code)return{code:e.code};throw Error("address or code is required")})();if(!a)throw Error("functionName is required");return(0,n.L)(e,{abi:s,functionName:a,args:c.args,...l,...c})},queryKey:function(e={}){let{abi:t,...r}=e;return["readContract",(0,s.OP)(r)]}(t)}}(o,{...e,chainId:e.chainId??h}),f=!!((r||u)&&t&&l&&(d.enabled??!0));return(0,a.aM)({...d,...m,enabled:f,structuralSharing:d.structuralSharing??s.if})}}},function(e){e.O(0,[4846,8424,7140,5714,2180,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);