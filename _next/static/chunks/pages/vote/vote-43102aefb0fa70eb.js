(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return t(21171)}])},91318:function(e,s,t){"use strict";var r=t(85893);s.Z=()=>(0,r.jsx)("span",{className:"flex justify-center items-center",children:(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},21171:function(e,s,t){"use strict";t.r(s);var r=t(85893),n=t(67294),a=t(11163),l=t(92321),i=t(86501),c=t(27245),d=t(41664),o=t.n(d),u=t(91529),h=t(93778),m=t(94782),x=t(92180),g=t(7080),f=t(35337),p=t(91318);s.default=()=>{let{token:e}=(0,n.useContext)(h.M)||{},[s,t]=(0,n.useState)({}),{address:d}=(0,l.m)(),{currentRound:j,isPending:N,error:v}=(0,g.Bk)(),b=(0,a.useRouter)(),{ids:w}=b.query,[y,_]=(0,n.useState)([]);(0,n.useEffect)(()=>{w&&_(w.split(",").map(e=>parseInt(e,10)))},[w]),(0,n.useEffect)(()=>{if(1===y.length)t({[y[0]]:100});else{let e={},s=Math.floor(100/y.length);y.forEach((t,r)=>{r===y.length-1?e[t]=100-s*(y.length-1):e[t]=s}),t(e)}},[y]);let E=(e,r)=>{if(1===y.length)return;let n={...s,[e]:r},a=y.slice(0,-1).reduce((e,s)=>e+(n[s]||0),0);if(a>100){i.Am.error("投票百分比之和不能超过100%");return}n[y[y.length-1]]=100-a,t(n)},{validGovVotes:k,isPending:C}=(0,x.Ty)(null==e?void 0:e.address,d),{votesNumByAccount:B,isPending:I}=(0,g.VI)(null==e?void 0:e.address,j,d),P=(null==y?void 0:y.map(e=>BigInt(e)))||[],{actionInfos:T,isPending:A,error:M}=(0,m.fT)(null==e?void 0:e.address,P),{vote:Z,isWriting:O,isConfirming:z,isConfirmed:H,writeError:S}=(0,g.rv)(),X=async()=>{if(100!==Object.values(s).reduce((e,s)=>e+s,0)){i.Am.error("百分比之和必须为100");return}let t=y.map(e=>BigInt(e)),r=y.map(e=>BigInt(s[e]||0)*k/100n);try{await Z(null==e?void 0:e.address,t,r)}catch(e){console.error("投票提交失败:",e),i.Am.error("提交失败，请重试")}};return(0,n.useEffect)(()=>{H&&!S&&(i.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{b.push("/gov")},2e3))},[H,S]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{title:"执行投票页"}),(0,r.jsxs)("main",{className:"flex-grow",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-white",children:[(0,r.jsxs)("h1",{className:"text-base text-center",children:["投票轮 （第",(0,r.jsx)("span",{className:"text-red-500",children:N?(0,r.jsx)(p.Z,{}):Number(j)}),"轮）"]}),(0,r.jsxs)("div",{className:"text-base text-gray-500",children:[(0,r.jsx)("span",{children:"我的剩余票数："}),C||I?(0,r.jsx)(p.Z,{}):(0,u.LH)(k-B||BigInt(0))]})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-sm font-bold mb-4 text-gray-600",children:"行动列表 (行动轮)"}),(0,r.jsx)("div",{className:"space-y-4",children:null==T?void 0:T.map((e,t)=>{let n=t===T.length-1,a=100-y.slice(0,-1).reduce((e,t)=>e+(s[t]||0),0);return(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,r.jsxs)(o(),{href:"/action/".concat(e.head.id,"?type=vote"),className:"flex-grow",children:[(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[(0,r.jsx)("span",{className:"text-gray-400 text-base mr-1",children:"No.".concat(e.head.id)}),(0,r.jsx)("span",{className:"text-gray-800 text-lg",children:"".concat(e.body.action)})]}),(0,r.jsx)("p",{className:"leading-tight",children:e.body.consensus})]},e.head.id),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",min:n?a:1,max:"100",value:n?a:s[e.head.id]||"",onChange:s=>E(e.head.id,Number(s.target.value)),className:"p-2 border rounded w-16",disabled:1===y.length||n,placeholder:""}),"%"]})]},e.head.id)})}),(0,r.jsx)("div",{className:"flex justify-center mt-4",children:(0,r.jsx)(c.z,{className:"w-1/2 bg-blue-600 hover:bg-blue-700",onClick:X,disabled:O||z,children:O||z?"提交中...":"提交投票"})}),S?(0,r.jsxs)("div",{className:"text-red-500",children:["Error: ",S.shortMessage||S.message]}):null]})]})]})}},11163:function(e,s,t){e.exports=t(43079)}},function(e){e.O(0,[9215,8424,6789,2077,765,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);