(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return t(21171)}])},91318:function(e,s,t){"use strict";var r=t(85893);s.Z=()=>(0,r.jsx)("span",{className:"flex justify-center items-center",children:(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},21171:function(e,s,t){"use strict";t.r(s);var r=t(85893),n=t(67294),a=t(11163),l=t(92321),i=t(86501),c=t(41664),d=t.n(c),o=t(91529),u=t(93778),m=t(94782),h=t(92180),x=t(7080),f=t(35337),g=t(91318);s.default=()=>{let{token:e}=(0,n.useContext)(u.M)||{},[s,t]=(0,n.useState)({}),{address:c}=(0,l.m)(),{currentRound:p,isPending:j,error:N}=(0,x.Bk)(),v=(0,a.useRouter)(),{ids:b}=v.query,[y,w]=(0,n.useState)([]);(0,n.useEffect)(()=>{b&&w(b.split(",").map(e=>parseInt(e,10)))},[b]),(0,n.useEffect)(()=>{if(1===y.length)t({[y[0]]:100});else{let e={},s=Math.floor(100/y.length);y.forEach((t,r)=>{r===y.length-1?e[t]=100-s*(y.length-1):e[t]=s}),t(e)}},[y]);let _=(e,r)=>{if(1===y.length)return;let n={...s,[e]:r},a=y.slice(0,-1).reduce((e,s)=>e+(n[s]||0),0);if(a>100){i.Am.error("投票百分比之和不能超过100%");return}n[y[y.length-1]]=100-a,t(n)},{validGovVotes:E,isPending:k}=(0,h.Ty)(null==e?void 0:e.address,c),{votesNumByAccount:C,isPending:B}=(0,x.VI)(null==e?void 0:e.address,p,c),I=(null==y?void 0:y.map(e=>BigInt(e)))||[],{actionInfos:P,isPending:T,error:A}=(0,m.fT)(null==e?void 0:e.address,I),{vote:M,isWriting:Z,isConfirming:O,isConfirmed:H,writeError:S}=(0,x.rv)(),X=async()=>{if(100!==Object.values(s).reduce((e,s)=>e+s,0)){i.Am.error("百分比之和必须为100");return}let t=y.map(e=>BigInt(e)),r=y.map(e=>BigInt(s[e]||0)*E/100n);try{await M(null==e?void 0:e.address,t,r)}catch(e){console.error("投票提交失败:",e),i.Am.error("提交失败，请重试")}};return(0,n.useEffect)(()=>{H&&!S&&(i.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{v.push("/gov")},2e3))},[H,S]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{title:"执行投票页"}),(0,r.jsxs)("main",{className:"flex-grow",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-base-100",children:[(0,r.jsxs)("h1",{className:"text-base text-center",children:["投票轮 （第",(0,r.jsx)("span",{className:"text-red-500",children:j?(0,r.jsx)(g.Z,{}):Number(p)}),"轮）"]}),(0,r.jsxs)("div",{className:"text-base text-gray-500",children:[(0,r.jsx)("span",{children:"我的剩余票数："}),k||B?(0,r.jsx)(g.Z,{}):(0,o.LH)(E-C||BigInt(0))]})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-sm font-bold mb-4 text-gray-600",children:"行动列表 (行动轮)"}),(0,r.jsx)("div",{className:"space-y-4",children:null==P?void 0:P.map((e,t)=>{let n=t===P.length-1,a=100-y.slice(0,-1).reduce((e,t)=>e+(s[t]||0),0);return(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,r.jsxs)(d(),{href:"/action/".concat(e.head.id,"?type=vote"),className:"flex-grow",children:[(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[(0,r.jsx)("span",{className:"text-gray-400 text-base mr-1",children:"No.".concat(e.head.id)}),(0,r.jsx)("span",{className:"text-gray-800 text-lg",children:"".concat(e.body.action)})]}),(0,r.jsx)("p",{className:"leading-tight",children:e.body.consensus})]},e.head.id),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",min:n?a:1,max:"100",value:n?a:s[e.head.id]||"",onChange:s=>_(e.head.id,Number(s.target.value)),className:"p-2 border rounded w-16",disabled:1===y.length||n,placeholder:""}),"%"]})]},e.head.id)})}),(0,r.jsx)("div",{className:"flex justify-center mt-4",children:(0,r.jsx)("button",{className:"btn btn-primary w-1/2",onClick:X,disabled:Z||O,children:Z||O?"提交中...":"提交投票"})}),S?(0,r.jsxs)("div",{className:"text-red-500",children:["Error: ",S.shortMessage||S.message]}):null]})]})]})}},11163:function(e,s,t){e.exports=t(43079)}},function(e){e.O(0,[9215,6789,2077,2180,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);