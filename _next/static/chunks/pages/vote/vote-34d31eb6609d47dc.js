(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return n(21171)}])},68655:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(31134).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},23432:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(31134).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},91529:function(e,t,n){"use strict";n.d(t,{LH:function(){return s},Vu:function(){return i},bM:function(){return l},vz:function(){return c}});var r=n(21803),a=n(15229);let i=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",s=e=>{let t=l(e);return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(Number(t))},c=e=>{let t=parseInt("18",10);return(0,r.v)(e,t)},l=e=>{let t=parseInt("18",10);return(0,a.b)(e,t)}},21171:function(e,t,n){"use strict";n.r(t);var r=n(85893),a=n(67294),i=n(11163),s=n(92321),c=n(86501),l=n(27245),o=n(41664),u=n.n(o),d=n(78543),f=n(91529),h=n(93778),m=n(94782),p=n(92180),x=n(7080),y=n(58732),g=n(42083);t.default=()=>{let{token:e}=(0,a.useContext)(h.M)||{},[t,n]=(0,a.useState)({}),{address:o,chain:w}=(0,s.m)(),{currentRound:v,isPending:b,error:N}=(0,x.Bk)(),j=(0,i.useRouter)(),{ids:I}=j.query,[C,T]=(0,a.useState)([]);(0,a.useEffect)(()=>{I&&T(I.split(",").map(e=>parseInt(e,10)))},[I]),(0,a.useEffect)(()=>{if(1===C.length)n({[C[0]]:100});else{let e={},t=Math.floor(100/C.length);C.forEach((n,r)=>{r===C.length-1?e[n]=100-t*(C.length-1):e[n]=t}),n(e)}},[C]);let P=(e,r)=>{if(1===C.length)return;let a={...t,[e]:r},i=C.slice(0,-1).reduce((e,t)=>e+(a[t]||0),0);if(i>100){c.Am.error("投票百分比之和不能超过100%");return}a[C[C.length-1]]=100-i,n(a)},{validGovVotes:k,isPending:$}=(0,p.Ty)(null==e?void 0:e.address,o),{votesNumByAccount:_,isPending:E}=(0,x.VI)(null==e?void 0:e.address,v,o),q=(null==C?void 0:C.map(e=>BigInt(e)))||[],{actionInfos:F,isPending:R,error:B}=(0,m.fT)(null==e?void 0:e.address,q),{vote:Z,isWriting:A,isConfirming:M,isConfirmed:S,writeError:G}=(0,x.rv)(),z=()=>!!(0,d.S)(w)&&(100===Object.values(t).reduce((e,t)=>e+t,0)||(c.Am.error("百分比之和必须为100"),!1)),L=async()=>{if(!z())return;let n=C.map(e=>BigInt(e)),r=C.map(e=>BigInt(t[e]||0)*k/100n);try{await Z(null==e?void 0:e.address,n,r)}catch(e){console.error("投票提交失败:",e),c.Am.error("提交失败，请重试")}};return((0,a.useEffect)(()=>{S&&!G&&(c.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{j.push("/gov?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[S,G]),e)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{title:"执行投票页"}),(0,r.jsxs)("main",{className:"flex-grow",children:[(0,r.jsx)("div",{className:"flex flex-col items-center space-y-4 p-6",children:(0,r.jsxs)("div",{className:"text-base text-greyscale-500",children:[(0,r.jsx)("span",{children:"我的剩余票数："}),(0,r.jsx)("span",{className:"text-secondary",children:$||E?(0,r.jsx)(g.Z,{}):(0,f.LH)(k-_||BigInt(0))})]})}),(0,r.jsxs)("div",{className:"px-4",children:[(0,r.jsx)("div",{className:"space-y-4",children:null==F?void 0:F.map((n,a)=>{let i=a===F.length-1,s=100-C.slice(0,-1).reduce((e,n)=>e+(t[n]||0),0);return(0,r.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,r.jsxs)(u(),{href:"/action/".concat(n.head.id,"?type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:[(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[(0,r.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(n.head.id)}),(0,r.jsx)("span",{className:"text-greyscale-900",children:"".concat(n.body.action)})]}),(0,r.jsx)("p",{className:"text-greyscale-500",children:n.body.consensus})]},n.head.id),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"number",min:i?s:1,max:"100",value:i?s:t[n.head.id]||"",onChange:e=>P(n.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===C.length||i,placeholder:""}),"%"]})]},n.head.id)})}),(0,r.jsx)("div",{className:"flex justify-center mt-4",children:(0,r.jsx)(l.z,{className:"w-1/2",onClick:L,disabled:A||M||S,children:A||M?"提交中...":S?"已提交":"提交投票"})}),G?(0,r.jsxs)("div",{className:"text-red-500",children:["Error: ",G.shortMessage||G.message]}):null]})]})]}):""}},78543:function(e,t,n){"use strict";n.d(t,{S:function(){return a}});var r=n(86501);let a=e=>!!e||(r.Am.error("请先将钱包链接 ".concat("sepolia")),!1)},9008:function(e,t,n){e.exports=n(23867)},13876:function(e,t,n){"use strict";n.d(t,{a:function(){return s}});var r=n(66432),a=n(81946),i=n(87831);async function s(e,t){let n;let{abi:s,chainId:c,connector:l,...o}=t;n=t.account?t.account:(await (0,i.e)(e,{chainId:c,connector:l})).account;let u=e.getClient({chainId:c}),d=(0,a.s)(u,r.a,"simulateContract"),{result:f,request:h}=await d({...o,abi:s,account:n});return{chainId:u.chain.id,result:f,request:{__mode:"prepared",...h,chainId:c}}}},96128:function(e,t,n){"use strict";n.d(t,{T:function(){return x}});var r=n(14503),a=n(8998),i=n(33840),s=n(26445),c=n(33639),l=n(87469),o=n(61163),u=n(74688),d=n(93714),f=n(47531),h=n(79524),m=n(76404),p=n(99238);async function x(e,t){let{account:n=e.account,chain:x=e.chain,accessList:y,blobs:g,data:w,gas:v,gasPrice:b,maxFeePerBlobGas:N,maxFeePerGas:j,maxPriorityFeePerGas:I,nonce:C,to:T,value:P,...k}=t;if(!n)throw new a.o({docsPath:"/docs/actions/wallet/sendTransaction"});let $=(0,r.T)(n);try{let n;if((0,f.F)(t),null!==x&&(n=await (0,d.s)(e,h.L,"getChainId")({}),(0,i.q)({currentChainId:n,chain:x})),"local"===$.type){let t=await (0,d.s)(e,m.Z,"prepareTransactionRequest")({account:$,accessList:y,blobs:g,chain:x,chainId:n,data:w,gas:v,gasPrice:b,maxFeePerBlobGas:N,maxFeePerGas:j,maxPriorityFeePerGas:I,nonce:C,parameters:[...m.Q,"sidecars"],to:T,value:P,...k}),r=x?.serializers?.transaction,a=await $.signTransaction(t,{serializer:r});return await (0,d.s)(e,p.p,"sendRawTransaction")({serializedTransaction:a})}let r=e.chain?.formatters?.transactionRequest?.format,a=(r||u.tG)({...(0,o.K)(k,{format:r}),accessList:y,blobs:g,chainId:n,data:w,from:$.address,gas:v,gasPrice:b,maxFeePerBlobGas:N,maxFeePerGas:j,maxPriorityFeePerGas:I,nonce:C,to:T,value:P});return await e.request({method:"eth_sendTransaction",params:[a]},{retryCount:0})}catch(e){throw function(e,{docsPath:t,...n}){let r=(()=>{let t=(0,l.k)(e,n);return t instanceof s.cj?e:t})();return new c.mk(r,{docsPath:t,...n})}(e,{...t,account:$,chain:t.chain||void 0})}}},61877:function(e,t,n){"use strict";n.d(t,{n:function(){return s}});var r=n(55629),a=n(93714),i=n(96128);async function s(e,t){let{abi:n,address:s,args:c,dataSuffix:l,functionName:o,...u}=t,d=(0,r.R)({abi:n,args:c,functionName:o});return(0,a.s)(e,i.T,"sendTransaction")({data:`${d}${l?l.replace("0x",""):""}`,to:s,...u})}},33840:function(e,t,n){"use strict";n.d(t,{q:function(){return a}});var r=n(80377);function a({chain:e,currentChainId:t}){if(!e)throw new r.Bk;if(t!==e.id)throw new r.Yl({chain:e,currentChainId:t})}},21803:function(e,t,n){"use strict";function r(e,t){let[n,r="0"]=e.split("."),a=n.startsWith("-");if(a&&(n=n.slice(1)),r=r.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${r}`))&&(n=`${BigInt(n)+1n}`),r="";else if(r.length>t){let[e,a,i]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],s=Math.round(Number(`${a}.${i}`));(r=s>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${s}`).length>t&&(r=r.slice(1),n=`${BigInt(n)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${a?"-":""}${n}${r}`)}n.d(t,{v:function(){return r}})},83540:function(e,t,n){"use strict";n.d(t,{A:function(){return h}});var r=n(95946),a=n(51973),i=n(23147),s=n(36083),c=n(81946);async function l(e,t){let{chainId:n,timeout:l=0,...o}=t,u=e.getClient({chainId:n}),d=(0,c.s)(u,a.e,"waitForTransactionReceipt"),f=await d({...o,timeout:l});if("reverted"===f.status){let e=(0,c.s)(u,i.f,"getTransaction"),t=await e({hash:f.transactionHash}),n=(0,c.s)(u,s.R,"call"),a=await n({...t,data:t.input,gasPrice:"eip1559"!==t.type?t.gasPrice:void 0,maxFeePerGas:"eip1559"===t.type?t.maxFeePerGas:void 0,maxPriorityFeePerGas:"eip1559"===t.type?t.maxPriorityFeePerGas:void 0});throw Error(a?.data?(0,r.rR)(`0x${a.data.substring(138)}`):"unknown reason")}return{...f,chainId:u.chain.id}}var o=n(36100),u=n(45631),d=n(82002),f=n(80666);function h(e={}){let{hash:t,query:n={}}=e,r=(0,f.Z)(e),a=(0,d.x)({config:r}),i=function(e,t={}){return{async queryFn({queryKey:n}){let{hash:r,...a}=n[1];if(!r)throw Error("hash is required");return l(e,{...a,onReplaced:t.onReplaced,hash:r})},queryKey:function(e={}){let{onReplaced:t,...n}=e;return["waitForTransactionReceipt",(0,o.OP)(n)]}(t)}}(r,{...e,chainId:e.chainId??a}),s=!!(t&&(n.enabled??!0));return(0,u.aM)({...n,...i,enabled:s})}},71366:function(e,t,n){"use strict";n.d(t,{S:function(){return d}});var r=n(98029),a=n(61877),i=n(81946),s=n(52425),c=n(87831),l=n(13876);async function o(e,t){let n,r;let{account:o,chainId:u,connector:d,__mode:f,...h}=t;n="object"==typeof o&&o?.type==="local"?e.getClient({chainId:u}):await (0,c.e)(e,{account:o??void 0,chainId:u,connector:d});let{connector:m}=(0,s.D)(e);if("prepared"===f||m?.supportsSimulation)r=h;else{let{request:t}=await (0,l.a)(e,{...h,account:o,chainId:u});r=t}let p=(0,i.s)(n,a.n,"writeContract");return await p({...r,...o?{account:o}:{},chain:u?{id:u}:null})}var u=n(80666);function d(e={}){var t;let{mutation:n}=e,a=(t=(0,u.Z)(e),{mutationFn:e=>o(t,e),mutationKey:["writeContract"]}),{mutate:i,mutateAsync:s,...c}=(0,r.D)({...n,...a});return{...c,writeContract:i,writeContractAsync:s}}}},function(e){e.O(0,[1664,1502,2180,7295,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);