(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return n(21171)}])},68655:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(31134).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},23432:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(31134).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},44576:function(e,t,n){"use strict";var s=n(85893);n(67294);var r=n(23432);t.Z=e=>{let{isLoading:t,text:n="Loading"}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(r.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,s.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:n})]})}):null}},91529:function(e,t,n){"use strict";n.d(t,{LH:function(){return l},Vu:function(){return i},bM:function(){return a},cK:function(){return o},vz:function(){return c}});var s=n(21803),r=n(15229);let i=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=a(e);return new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(Number(n))},c=e=>{let t=parseInt("18",10);try{return(0,s.v)(e,t)}catch(e){return console.error("parseUnits error:",e),0n}},a=e=>{let t=parseInt("18",10);return(0,r.b)(e,t)},o=(e,t)=>e&&t?e-BigInt(t.initialStakeRound)+1n:0n},48105:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var s=n(86501);let r=e=>!!e||(s.Am.error("请先将钱包链接 ".concat("sepolia")),!1)},21171:function(e,t,n){"use strict";n.r(t);var s=n(85893),r=n(67294),i=n(11163),l=n(92321),c=n(86501),a=n(27245),o=n(41664),d=n.n(o),u=n(94782),m=n(7080),h=n(92180),f=n(67068),x=n(48105),g=n(91529),v=n(93778),p=n(37436),y=n(42083),N=n(44576);t.default=()=>{let{token:e}=(0,r.useContext)(v.M)||{},[t,n]=(0,r.useState)({}),{address:o,chain:b}=(0,l.m)(),{currentRound:j,isPending:w,error:I}=(0,m.Bk)(),k=(0,i.useRouter)(),{ids:E}=k.query,[$,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{E&&_(E.split(",").map(e=>parseInt(e,10)))},[E]),(0,r.useEffect)(()=>{if(1===$.length)n({[$[0]]:100});else{let e={},t=Math.floor(100/$.length);$.forEach((n,s)=>{s===$.length-1?e[n]=100-t*($.length-1):e[n]=t}),n(e)}},[$]);let B=(e,s)=>{if(1===$.length)return;let r={...t,[e]:s},i=$.slice(0,-1).reduce((e,t)=>e+(r[t]||0),0);if(i>100){c.Am.error("投票百分比之和不能超过100%");return}r[$[$.length-1]]=100-i,n(r)},{validGovVotes:Z,isPending:S,error:A}=(0,h.Ty)(null==e?void 0:e.address,o),{votesNumByAccount:C,isPending:M,error:P}=(0,m.VI)(null==e?void 0:e.address,j,o),L=(null==$?void 0:$.map(e=>BigInt(e)))||[],{actionInfos:T,isPending:z,error:F}=(0,u.fT)(null==e?void 0:e.address,L),{vote:O,isWriting:q,isConfirming:H,isConfirmed:R,writeError:U}=(0,m.rv)(),V=()=>!!(0,x.S)(b)&&(Z-C<2n?(c.Am.error("剩余票数不足，不能投票"),!1):100===Object.values(t).reduce((e,t)=>e+t,0)||(c.Am.error("百分比之和必须为100"),!1)),X=async()=>{if(!V())return;let n=$.map(e=>BigInt(e)),s=$.map(e=>BigInt(t[e]||0)*(Z-C)/100n);try{await O(null==e?void 0:e.address,n,s)}catch(e){console.error("投票提交失败:",e),c.Am.error("提交失败，请重试")}},{handleContractError:D}=(0,f.S)();return((0,r.useEffect)(()=>{I&&D(I,"vote"),U&&D(U,"vote"),P&&D(P,"vote"),F&&D(F,"submit"),A&&D(A,"stake")},[I,U,F,A,P]),(0,r.useEffect)(()=>{R&&!U&&(c.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{k.push("/gov?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[R,U]),e)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{title:"投票"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsx)("div",{className:"stats w-full",children:(0,s.jsxs)("div",{className:"stat place-items-center",children:[(0,s.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,s.jsx)("div",{className:"stat-value text-secondary mt-2",children:S||M?(0,s.jsx)(y.Z,{}):(0,g.LH)(Z-C||BigInt(0))}),(0,s.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,s.jsx)(d(),{href:"/gov/stakelp?symbol=".concat(null==e?void 0:e.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,s.jsxs)("div",{className:"px-4",children:[(0,s.jsx)("div",{className:"space-y-4",children:null==T?void 0:T.map((n,r)=>{let i=r===T.length-1,l=100-$.slice(0,-1).reduce((e,n)=>e+(t[n]||0),0);return(0,s.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,s.jsxs)(d(),{href:"/action/".concat(n.head.id,"?type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:[(0,s.jsxs)("div",{className:"font-semibold mb-2",children:[(0,s.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(n.head.id)}),(0,s.jsx)("span",{className:"text-greyscale-900",children:"".concat(n.body.action)})]}),(0,s.jsx)("p",{className:"text-greyscale-500",children:n.body.consensus})]},n.head.id),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",min:i?l:1,max:"100",value:i?l:t[n.head.id]||"",onChange:e=>B(n.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===$.length||i,placeholder:""}),"%"]})]},n.head.id)})}),(0,s.jsx)("div",{className:"flex justify-center mt-4",children:(0,s.jsx)(a.z,{className:"w-1/2",onClick:X,disabled:q||H||R,children:q?"提交中...":H?"确认中...":R?"已提交":"提交投票"})})]}),(0,s.jsx)(N.Z,{isLoading:q||H,text:q?"提交交易...":"确认交易..."})]})]}):""}},9008:function(e,t,n){e.exports=n(23867)},21803:function(e,t,n){"use strict";function s(e,t){let[n,s="0"]=e.split("."),r=n.startsWith("-");if(r&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${s}`))&&(n=`${BigInt(n)+1n}`),s="";else if(s.length>t){let[e,r,i]=[s.slice(0,t-1),s.slice(t-1,t),s.slice(t)],l=Math.round(Number(`${r}.${i}`));(s=l>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${l}`).length>t&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,t)}else s=s.padEnd(t,"0");return BigInt(`${r?"-":""}${n}${s}`)}n.d(t,{v:function(){return s}})}},function(e){e.O(0,[1664,6714,5263,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);