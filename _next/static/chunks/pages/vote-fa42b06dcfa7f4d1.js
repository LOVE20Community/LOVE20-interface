(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1786],{75125:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote",function(){return r(36968)}])},27245:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var s=r(85893),n=r(67294),i=r(88426),a=r(45139),l=r(98997);let c=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,t)=>{let{className:r,variant:n,size:a,asChild:o=!1,...d}=e,u=o?i.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(c({variant:n,size:a,className:r})),ref:t,...d})});o.displayName="Button"},98997:function(e,t,r){"use strict";r.d(t,{cn:function(){return i}});var s=r(90512),n=r(98388);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}},27460:function(e,t,r){"use strict";var s=r(85893),n=r(86501),i=r(74855),a=r(18289),l=r(91529);t.Z=e=>{let{address:t,showCopyButton:r=!0}=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:(0,l.Vu)(t)}),r&&(0,s.jsx)(i.CopyToClipboard,{text:t,onCopy:(e,t)=>{t?n.ZP.success("复制成功"):n.ZP.error("复制失败")},children:(0,s.jsx)("button",{className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",onClick:e=>{e.preventDefault(),e.stopPropagation()},"aria-label":"复制地址",children:(0,s.jsx)(a.Z,{className:"h-4 w-4 text-gray-500"})})})]})}},74089:function(e,t,r){"use strict";var s=r(85893),n=r(67294),i=r(91529);t.Z=e=>{let{initialTimeLeft:t}=e,[r,a]=(0,n.useState)(t);(0,n.useEffect)(()=>{if(t<=0)return;a(t);let e=setInterval(()=>{a(t=>t<=1?(clearInterval(e),window.location.reload(),0):t-1)},1e3);return()=>{clearInterval(e)}},[t]);let l=(0,i.ZC)(r);return(0,s.jsx)(s.Fragment,{children:l})}},91318:function(e,t,r){"use strict";var s=r(85893);t.Z=()=>(0,s.jsx)("span",{className:"flex justify-center items-center",children:(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},7191:function(e,t,r){"use strict";var s=r(85893);r(67294);var n=r(3125),i=r(74089);t.Z=e=>{let{currentRound:t,roundName:r}=e,{data:a}=(0,n.O)(),l=Number("100")||0,c=Number("12")||0,o=a?l-Number(a)%l:0;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("h1",{className:"text-base text-center font-bold",children:[r,"（第 ",(0,s.jsx)("span",{className:"text-red-500",children:Number(null!=t?t:0n)})," 轮）"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-400 mt-1 pt-0",children:["本轮剩余：",(0,s.jsx)(i.Z,{initialTimeLeft:o>0?o*c:0})]})]})}},36968:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var s=r(85893),n=r(35337),i=r(41664),a=r.n(i),l=r(7080),c=r(67294),o=r(11163),d=r(86501),u=r(27245),x=r(94782),m=r(93778),h=r(91318),f=r(27460),g=e=>{let{currentRound:t}=e,{token:r}=(0,c.useContext)(m.M)||{},n=(0,o.useRouter)(),{votes:i,isPending:g,error:v}=(0,l.$S)((null==r?void 0:r.address)||"",t),{actionSubmits:b,isPending:p,error:j}=(0,x.WZ)((null==r?void 0:r.address)||"",t),N=Array.from(new Set((null==b?void 0:b.map(e=>BigInt(e.actionId)))||[])).sort((e,t)=>Number(e)-Number(t)),{actionInfos:y,isPending:w,error:k}=(0,x.fT)((null==r?void 0:r.address)||"",N),[Z,_]=(0,c.useState)(new Set),C=e=>{_(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},I=(null==i?void 0:i.reduce((e,t)=>e+t,0n))||0n;return g||p||N&&N.length>0&&w?(0,s.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,s.jsx)(h.Z,{})}):j||k?(0,s.jsx)("div",{children:"加载出错，请稍后再试。"}):(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h2",{className:"text-sm font-bold mb-4 text-gray-600",children:"行动列表 (行动轮)"}),(0,s.jsx)("div",{className:"space-y-4",children:N.length>0?(0,s.jsxs)(s.Fragment,{children:[null==y?void 0:y.map((e,t)=>{var r;let n=null==b?void 0:null===(r=b.find(t=>BigInt(t.actionId)===BigInt(e.head.id)))||void 0===r?void 0:r.submitter;return(0,s.jsxs)("div",{className:"flex bg-white p-4 rounded-lg mb-4",children:[(0,s.jsx)("input",{type:"checkbox",className:"checkbox checkbox-warning mr-2",checked:Z.has(BigInt(e.head.id)),onChange:()=>C(BigInt(e.head.id))}),(0,s.jsxs)(a(),{href:"/action/".concat(e.head.id,"?type=vote"),className:"flex-grow block",children:[(0,s.jsxs)("div",{className:"font-semibold mb-2",children:[(0,s.jsx)("span",{className:"text-gray-400 text-base mr-1",children:"No.".concat(e.head.id)}),(0,s.jsx)("span",{className:"text-gray-800 text-lg",children:"".concat(e.body.action)})]}),(0,s.jsx)("p",{className:"leading-tight",children:e.body.consensus}),(0,s.jsxs)("div",{className:"flex justify-between mt-1 text-gray-400",children:[(0,s.jsxs)("span",{className:"text-sm flex-1",children:["推举人 ",(0,s.jsx)(f.Z,{address:n,showCopyButton:!1})]}),(0,s.jsxs)("span",{className:"text-sm flex-1 text-right",children:[(0,s.jsx)("span",{className:"mr-1",children:"投票占比"}),0===Number((null==i?void 0:i[t])||0n)?"0":(100*Number((null==i?void 0:i[t])||0n)/Number(I)).toFixed(1),"%"]})]})]})]},e.head.id)}),(0,s.jsx)("div",{className:"flex justify-center mt-4",children:(0,s.jsx)(u.z,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{let e=Array.from(Z).join(",");if(0===e.length){d.Am.error("请选择行动");return}n.push("/vote/vote?ids=".concat(e))},children:"投票"})})]}):(0,s.jsx)("div",{className:"text-sm text-gray-500 text-center",children:"没有行动"})})]})},v=r(7191),b=()=>{let{currentRound:e,isPending:t,error:r}=(0,l.Bk)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z,{title:"投票首页"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-white",children:[t?(0,s.jsx)(h.Z,{}):(0,s.jsx)(v.Z,{currentRound:e,roundName:"投票轮"}),(0,s.jsx)(a(),{href:"/vote/actions4submit",className:"w-1/2",children:(0,s.jsx)(u.z,{className:"w-full bg-blue-600 hover:bg-blue-700",children:"推举其他行动"})})]}),(0,s.jsx)(g,{currentRound:e})]})]})}}},function(e){e.O(0,[4846,8424,8741,7140,7080,2888,9774,179],function(){return e(e.s=75125)}),_N_E=e.O()}]);