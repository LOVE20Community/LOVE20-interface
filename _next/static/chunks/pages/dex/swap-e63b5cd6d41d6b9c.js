(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{17137:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dex/swap",function(){return t(61322)}])},76929:function(e,s,t){"use strict";t.d(s,{l0:function(){return u},NI:function(){return j},pf:function(){return b},Wi:function(){return f},xJ:function(){return h},lX:function(){return y},zG:function(){return w}});var n=t(85893),a=t(67294),r=t(4222),l=t(87536),i=t(40108),o=t(99489);let d=(0,t(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,n.jsx)(o.f,{ref:s,className:(0,i.cn)(d(),t),...a})});c.displayName=o.f.displayName;let u=l.RV,m=a.createContext({}),f=e=>{let{...s}=e;return(0,n.jsx)(m.Provider,{value:{name:s.name},children:(0,n.jsx)(l.Qr,{...s})})},x=()=>{let e=a.useContext(m),s=a.useContext(p),{getFieldState:t,formState:n}=(0,l.Gc)(),r=t(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=s;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...r}},p=a.createContext({}),h=a.forwardRef((e,s)=>{let{className:t,...r}=e,l=a.useId();return(0,n.jsx)(p.Provider,{value:{id:l},children:(0,n.jsx)("div",{ref:s,className:(0,i.cn)("space-y-2",t),...r})})});h.displayName="FormItem";let y=a.forwardRef((e,s)=>{let{className:t,...a}=e,{error:r,formItemId:l}=x();return(0,n.jsx)(c,{ref:s,className:(0,i.cn)(r&&"text-destructive",t),htmlFor:l,...a})});y.displayName="FormLabel";let j=a.forwardRef((e,s)=>{let{...t}=e,{error:a,formItemId:l,formDescriptionId:i,formMessageId:o}=x();return(0,n.jsx)(r.g7,{ref:s,id:l,"aria-describedby":a?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!a,...t})});j.displayName="FormControl";let b=a.forwardRef((e,s)=>{let{className:t,...a}=e,{formDescriptionId:r}=x();return(0,n.jsx)("p",{ref:s,id:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...a})});b.displayName="FormDescription";let w=a.forwardRef((e,s)=>{let{className:t,children:a,...r}=e,{error:l,formMessageId:o}=x(),d=l?String(null==l?void 0:l.message):a;return d?(0,n.jsx)("p",{ref:s,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",t),...r,children:d}):null});w.displayName="FormMessage"},88659:function(e,s,t){"use strict";t.d(s,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return m},ki:function(){return u}});var n=t(85893),a=t(67294),r=t(86443),l=t(42171),i=t(15432),o=t(78865),d=t(40108);let c=r.fC;r.ZA;let u=r.B4,m=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,n.jsxs)(r.xz,{ref:s,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[a,(0,n.jsx)(r.JO,{asChild:!0,children:(0,n.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.xz.displayName;let f=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,n.jsx)(r.u_,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=r.u_.displayName;let x=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,n.jsx)(r.$G,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=r.$G.displayName;let p=a.forwardRef((e,s)=>{let{className:t,children:a,position:l="popper",...i}=e;return(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{ref:s,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...i,children:[(0,n.jsx)(f,{}),(0,n.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,n.jsx)(x,{})]})})});p.displayName=r.VY.displayName,a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,n.jsx)(r.__,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...a})}).displayName=r.__.displayName;let h=a.forwardRef((e,s)=>{let{className:t,children:a,...l}=e;return(0,n.jsxs)(r.ck,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(r.wU,{children:(0,n.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(r.eT,{children:a})]})});h.displayName=r.ck.displayName,a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,n.jsx)(r.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",t),...a})}).displayName=r.Z0.displayName},44576:function(e,s,t){"use strict";var n=t(85893);t(67294);var a=t(23432);s.Z=e=>{let{isLoading:s,text:t="Loading"}=e;return s?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(a.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:t})]})}):null}},48105:function(e,s,t){"use strict";t.d(s,{S:function(){return a}});var n=t(86501);let a=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},61322:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return I}});var n=t(85893),a=t(67294),r=t(11163),l=t(37436),i=t(86501),o=t(1604),d=t(56312),c=t(92321),u=t(87536);let m=(0,t(31134).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var f=t(27245),x=t(21774),p=t(88659),h=t(76929),y=t(48105),j=t(91529),b=t(67068),w=t(19638),g=t(89810),N=t(71366),v=t(83540);let k=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],T="0x3366ffDA4477dec0f55b2E9b611B1D95D16Cc9df",A=function(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:n,error:a,isLoading:r}=(0,g.u)({address:T,abi:k,functionName:"getAmountsOut",args:[e,s],query:{enabled:!!e&&s.length>=2&&t}});return{data:n,error:a,isLoading:r}};var C=t(93778),E=()=>{let e=(0,a.useContext)(C.M);if(void 0===e)throw Error("useTokenContext must be used within a TokenProvider");return e},S=t(64777),z=t(42083),_=t(44576);let R=e=>o.z.object({fromTokenAmount:o.z.string().nonempty("请输入兑换数量").refine(s=>{if(s.endsWith(".")||"0"===s)return!0;try{let t=(0,j.vz)(s);return t>0n&&t<=e}catch(e){return!1}},{message:"输入数量必须大于0且不超过您的可用余额"}),fromTokenAddress:o.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址"),toTokenAddress:o.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址")});var F=()=>{let e=(0,r.useRouter)(),{address:s,chain:t}=(0,c.m)(),{token:l}=E(),[o,g]=(0,a.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n}),[C,F]=(0,a.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n});(0,a.useEffect)(()=>{l&&(g(e=>({...e,address:l.parentTokenAddress,symbol:l.parentTokenSymbol})),F(e=>({...e,address:l.address,symbol:l.symbol})))},[l]);let I=(0,u.cI)({resolver:(0,d.F)(R(o.balance)),defaultValues:{fromTokenAddress:(null==l?void 0:l.parentTokenAddress)||"0x0",toTokenAddress:(null==l?void 0:l.address)||"0x0",fromTokenAmount:""},mode:"onChange"});(0,a.useEffect)(()=>{I.setValue("fromTokenAddress",o.address),I.setValue("toTokenAddress",C.address)},[o.address,C.address,I]);let Z=I.watch("fromTokenAmount");(0,a.useEffect)(()=>{g(e=>{let s=0n;try{var t;s=null!==(t=(0,j.vz)(Z||"0"))&&void 0!==t?t:0n}catch(e){}return{...e,amount:s,amountShow:Z||"0"}})},[Z]);let{balance:M,error:V,isPending:P}=(0,w.hS)(o.address,s),{balance:D,error:B,isPending:O}=(0,w.hS)(C.address,s);(0,a.useEffect)(()=>{M&&g(e=>({...e,balance:M})),D&&F(e=>({...e,balance:D}))},[M,D]);let{data:W,error:G,isLoading:L}=A(o.amount,[o.address,C.address]);(0,a.useEffect)(()=>{if(W&&W.length>1){let e=BigInt(W[1]);F(s=>({...s,amount:e,amountShow:(0,j.bM)(e)}))}},[W]);let{approve:J,isWriting:Q,isConfirming:$,isConfirmed:X,writeError:q}=(0,w.yA)(null==l?void 0:l.address),{approve:H,isWriting:Y,isConfirming:U,isConfirmed:K,writeError:ee}=(0,w.yA)(null==l?void 0:l.parentTokenAddress),{swap:es,isWriting:et,isConfirming:en,isConfirmed:ea,writeError:er}=function(){let{writeContract:e,isPending:s,data:t,error:n}=(0,N.S)(),a=async(s,t,n,a,r)=>{try{await e({address:T,abi:k,functionName:"swapExactTokensForTokens",args:[s,t,n,a,r]})}catch(e){console.error("Swap failed:",e)}},{isLoading:r,isSuccess:l}=(0,v.A)({hash:t});return{swap:a,writeData:t,isWriting:s,writeError:n,isConfirming:r,isConfirmed:l}}(),el=Q||Y||$||U,ei=X||K,eo=I.handleSubmit(async e=>{if((0,y.S)(t))try{let e=(null==l?void 0:l.symbol)===o.symbol?J:H;await e("0x3366ffDA4477dec0f55b2E9b611B1D95D16Cc9df",o.amount)}catch(e){console.error(e),i.Am.error((null==e?void 0:e.message)||"授权失败")}}),ed=I.handleSubmit(async e=>{if((0,y.S)(t))try{let e=BigInt(Math.floor(Date.now()/1e3)+1200);await es(o.amount,C.amount/1000n*995n,[o.address,C.address],s,e)}catch(e){console.error(e),i.Am.error((null==e?void 0:e.message)||"兑换失败")}});(0,a.useEffect)(()=>{ea&&(i.Am.success("兑换成功"),setTimeout(()=>{e.push("/my/?symbol=".concat(null==l?void 0:l.symbol))},2e3))},[ea,e,null==l?void 0:l.symbol]);let[ec,eu]=(0,a.useState)("0");(0,a.useEffect)(()=>{if(o.amountShow){let e=.3*(parseFloat(o.amountShow)||0)/100;eu(e<1e-4?e.toExponential(2):e.toFixed(6))}else eu("0")},[o.amountShow]);let{handleContractError:em}=(0,b.S)();if((0,a.useEffect)(()=>{q&&em(q,"token"),ee&&em(ee,"token"),G&&em(G,"uniswapV2Router"),er&&em(er,"uniswapV2Router"),B&&em(B,"token"),V&&em(V,"token")},[q,ee,G,er,B,V]),!l)return(0,n.jsx)(z.Z,{});let ef=el||et||en,ex=o.amount>0n&&W&&W.length>1?(0,j.eb)((0,j.bM)(W[1]*10n**18n/o.amount),2,4):"0";return(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)(S.Z,{title:"兑换"}),(0,n.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,n.jsx)(h.l0,{...I,children:(0,n.jsxs)("form",{children:[(0,n.jsxs)("div",{className:"mb-4 flex flex-col",children:[(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(h.Wi,{control:I.control,name:"fromTokenAmount",render:e=>{let{field:s}=e;return(0,n.jsxs)(h.xJ,{className:"w-2/3",children:[(0,n.jsx)(h.NI,{children:(0,n.jsx)(x.I,{placeholder:"请填写数量",type:"number",className:"w-full !ring-secondary-foreground",disabled:P||O||ei,...s})}),(0,n.jsx)(h.zG,{})]})}}),(0,n.jsx)(h.Wi,{control:I.control,name:"fromTokenAddress",render:e=>{let{field:s}=e;return(0,n.jsxs)(h.xJ,{className:"w-1/3",children:[(0,n.jsx)(h.NI,{children:(0,n.jsxs)(p.Ph,{value:s.value,onValueChange:e=>{s.onChange(e),g(s=>({...s,address:e}))},disabled:P||O||ei,children:[(0,n.jsx)(p.i4,{className:"w-full",children:(0,n.jsx)(p.ki,{placeholder:"选择代币"})}),(0,n.jsx)(p.Bw,{children:(0,n.jsx)(p.Ql,{value:o.address,children:o.symbol})})]})}),(0,n.jsx)(h.zG,{})]})}})]}),(0,n.jsxs)("div",{className:"flex items-center text-sm mt-2",children:[(0,n.jsxs)("span",{className:"text-greyscale-400",children:[(0,j.LH)(o.balance||0n)," ",o.symbol]}),(0,n.jsx)(f.z,{variant:"link",type:"button",size:"sm",className:"text-secondary ml-2",onClick:()=>{let e=(0,j.bM)(o.balance);I.setValue("fromTokenAmount",e)},disabled:P||O||ei,children:"最高"})]})]}),(0,n.jsx)("div",{className:"flex justify-center my-4",children:(0,n.jsx)(f.z,{variant:"ghost",type:"button",size:"icon",className:"rounded-full hover:bg-gray-100",onClick:()=>{let e={...o},s={...C};"0x0"!==e.address&&"0x0"!==s.address&&(g(s),F(e),I.setValue("fromTokenAmount","0"))},disabled:P||O||ei,children:(0,n.jsx)(m,{className:"h-6 w-6"})})}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(x.I,{type:"number",disabled:!0,placeholder:"0.0",className:"flex-grow w-2/3 !ring-secondary-foreground",value:C.amountShow,readOnly:!0}),(0,n.jsx)(h.Wi,{control:I.control,name:"toTokenAddress",render:e=>{let{field:s}=e;return(0,n.jsxs)(h.xJ,{className:"w-1/3",children:[(0,n.jsx)(h.NI,{children:(0,n.jsxs)(p.Ph,{value:s.value,onValueChange:e=>{s.onChange(e),F(s=>({...s,address:e}))},disabled:P||O||ei,children:[(0,n.jsx)(p.i4,{className:"w-full",children:(0,n.jsx)(p.ki,{placeholder:"选择代币"})}),(0,n.jsx)(p.Bw,{children:(0,n.jsx)(p.Ql,{value:C.address,children:C.symbol})})]})}),(0,n.jsx)(h.zG,{})]})}})]}),(0,n.jsx)("div",{className:"flex justify-between items-center text-sm mt-2",children:(0,n.jsxs)("span",{className:"text-greyscale-400",children:[(0,j.LH)(C.balance||0n)," ",C.symbol]})})]}),(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)(f.z,{className:"w-1/2",onClick:eo,disabled:el||ei,children:Q||Y?"1.授权中...":$||U?"1.确认中...":ei?"1.已授权":"1.授权"}),(0,n.jsx)(f.z,{className:"w-1/2",onClick:ed,disabled:!ei||el||et||en||ea,children:et?"2.兑换中...":en?"2.确认中...":ea?"2.已兑换":"2.兑换"})]})]})}),o.amount>0n&&(0,n.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-greyscale-400",children:"兑换率: "}),(0,n.jsxs)("span",{children:["1 ",o.symbol," = ",ex," ",C.symbol]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-greyscale-400",children:"手续费 (0.3%)："}),(0,n.jsxs)("span",{children:[ec," ",o.symbol]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-greyscale-400",children:"滑点上限 (自动)："}),(0,n.jsx)("span",{children:"5.5%"})]})]})]}),(0,n.jsx)(_.Z,{isLoading:ef,text:Q||Y||et?"提交交易...":"确认交易..."})]})};function I(){let e=(0,r.useRouter)(),{token:s}=(0,a.useContext)(C.M)||{};return(0,a.useEffect)(()=>{s&&!s.hasEnded?e.push("/launch?symbol=".concat(s.symbol)):s&&!s.initialStakeRound&&e.push("/gov/stakelp/?symbol=".concat(s.symbol,"&first=true"))},[s]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{title:"兑换代币"}),(0,n.jsx)("main",{className:"flex-grow",children:(0,n.jsx)(F,{})})]})}}},function(e){e.O(0,[2624,7569,1250,7380,2888,9774,179],function(){return e(e.s=17137)}),_N_E=e.O()}]);