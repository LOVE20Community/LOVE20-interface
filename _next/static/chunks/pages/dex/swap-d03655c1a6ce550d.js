(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{17137:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dex/swap",function(){return n(62746)}])},301:function(e,s,n){"use strict";n.d(s,{AT:function(){return d},op:function(){return i},oN:function(){return u}});var t=n(89810),a=n(71366),r=n(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],o="0x06b4043b3254150d47c112a637C21cec1eb56840",i=function(e,s){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:a,error:r,isLoading:i}=(0,t.u)({address:o,abi:l,functionName:"getAmountsOut",args:[e,s],query:{enabled:!!e&&s.length>=2&&n}});return{data:a,error:r,isLoading:i}},d=function(e,s){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:a,error:r,isLoading:i}=(0,t.u)({address:o,abi:l,functionName:"getAmountsIn",args:[e,s],query:{enabled:!!e&&s.length>=2&&n}});return{data:a,error:r,isLoading:i}};function u(){let{writeContract:e,isPending:s,data:n,error:t}=(0,a.S)(),i=async(s,n,t,a,r)=>{try{await e({address:o,abi:l,functionName:"swapExactTokensForTokens",args:[s,n,t,a,r]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,r.A)({hash:n});return{swap:i,writeData:n,isWriting:s,writeError:t,isConfirming:d,isConfirmed:u}}},62746:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return C}});var t=n(85893),a=n(67294),r=n(11163),l=n(37436),o=n(86501),i=n(1604),d=n(56312),u=n(92321),c=n(87536);let m=(0,n(31134).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var x=n(27245),h=n(21774),f=n(88659),y=n(76929),p=n(48105),b=n(91529),j=n(67068),g=n(19638),v=n(301),w=n(93778),k=()=>{let e=(0,a.useContext)(w.M);if(void 0===e)throw Error("useTokenContext must be used within a TokenProvider");return e},N=n(64777),T=n(44576);let A=i.z.object({fromTokenAddress:i.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址"),toTokenAddress:i.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址"),fromTokenAmount:i.z.string().nonempty("请输入兑换数量").refine(e=>{try{var s;return(null!==(s=(0,b.vz)(e))&&void 0!==s?s:0n)>0n}catch(e){return!1}},"兑换数量必须大于0")});var S=()=>{let e=(0,r.useRouter)(),{address:s,chain:n}=(0,u.m)(),{token:l}=k(),[i,w]=(0,a.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n}),[S,C]=(0,a.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n});(0,a.useEffect)(()=>{l&&(w(e=>({...e,address:l.parentTokenAddress,symbol:l.parentTokenSymbol})),C(e=>({...e,address:l.address,symbol:l.symbol})))},[l]);let E=(0,c.cI)({resolver:(0,d.F)(A),defaultValues:{fromTokenAddress:(null==l?void 0:l.parentTokenAddress)||"0x0",toTokenAddress:(null==l?void 0:l.address)||"0x0",fromTokenAmount:"0"},mode:"onChange"});(0,a.useEffect)(()=>{E.setValue("fromTokenAddress",i.address),E.setValue("toTokenAddress",S.address)},[i.address,S.address,E]);let z=E.watch("fromTokenAmount");(0,a.useEffect)(()=>{w(e=>{let s=0n;try{var n;s=null!==(n=(0,b.vz)(z||"0"))&&void 0!==n?n:0n}catch(e){}return{...e,amount:s,amountShow:z||"0"}})},[z]);let{balance:I,error:_,isPending:M}=(0,g.hS)(i.address,s),{balance:V,error:F,isPending:P}=(0,g.hS)(S.address,s);(0,a.useEffect)(()=>{I&&w(e=>({...e,balance:I})),V&&C(e=>({...e,balance:V}))},[I,V]);let{data:O,error:L,isLoading:W}=(0,v.op)(i.amount,[i.address,S.address]);(0,a.useEffect)(()=>{if(O&&O.length>1){let e=BigInt(O[1]);C(s=>({...s,amount:e,amountShow:(0,b.bM)(e)}))}},[O]);let{approve:R,isWriting:B,isConfirming:Z,isConfirmed:q,writeError:G}=(0,g.yA)(null==l?void 0:l.address),{approve:J,isWriting:D,isConfirming:H,isConfirmed:Q,writeError:X}=(0,g.yA)(null==l?void 0:l.parentTokenAddress),{swap:$,isWriting:K,isConfirming:U,isConfirmed:Y,writeError:ee}=(0,v.oN)(),es=B||D||Z||H,en=q||Q,et=E.handleSubmit(async e=>{if((0,p.S)(n))try{let e=(null==l?void 0:l.symbol)===i.symbol?R:J;await e("0x06b4043b3254150d47c112a637C21cec1eb56840",i.amount)}catch(e){console.error(e),o.Am.error((null==e?void 0:e.message)||"授权失败")}}),ea=E.handleSubmit(async e=>{if((0,p.S)(n))try{let e=BigInt(Math.floor(Date.now()/1e3)+1200);await $(i.amount,S.amount/1000n*995n,[i.address,S.address],s,e)}catch(e){console.error(e),o.Am.error((null==e?void 0:e.message)||"兑换失败")}});(0,a.useEffect)(()=>{Y&&(o.Am.success("兑换成功"),setTimeout(()=>{e.push("/my/?symbol=".concat(null==l?void 0:l.symbol))},2e3))},[Y,e,null==l?void 0:l.symbol]);let[er,el]=(0,a.useState)("0");(0,a.useEffect)(()=>{if(i.amountShow){let e=.3*(parseFloat(i.amountShow)||0)/100;el(e<1e-4?e.toExponential(2):e.toFixed(6))}else el("0")},[i.amountShow]);let{handleContractError:eo}=(0,j.S)();if((0,a.useEffect)(()=>{G&&eo(G,"token"),X&&eo(X,"token"),L&&eo(L,"uniswapV2Router"),ee&&eo(ee,"uniswapV2Router"),F&&eo(F,"token"),_&&eo(_,"token")},[G,X,L,ee,F,_]),!l)return(0,t.jsx)("div",{children:"Loading..."});let ei=es||K||U;return(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)(N.Z,{title:"兑换"}),(0,t.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,t.jsx)(y.l0,{...E,children:(0,t.jsxs)("form",{children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)(y.Wi,{control:E.control,name:"fromTokenAmount",render:e=>{let{field:s}=e;return(0,t.jsxs)(y.xJ,{className:"w-2/3",children:[(0,t.jsx)(y.NI,{children:(0,t.jsx)(h.I,{placeholder:"0.0",type:"number",className:"w-full !ring-secondary-foreground",disabled:M||P||en,...s})}),(0,t.jsx)(y.zG,{})]})}}),(0,t.jsx)(y.Wi,{control:E.control,name:"fromTokenAddress",render:e=>{let{field:s}=e;return(0,t.jsxs)(y.xJ,{className:"w-1/3",children:[(0,t.jsx)(y.NI,{children:(0,t.jsxs)(f.Ph,{value:s.value,onValueChange:e=>{s.onChange(e),w(s=>({...s,address:e}))},disabled:M||P||en,children:[(0,t.jsx)(f.i4,{className:"w-full",children:(0,t.jsx)(f.ki,{placeholder:"选择代币"})}),(0,t.jsx)(f.Bw,{children:(0,t.jsx)(f.Ql,{value:i.address,children:i.symbol})})]})}),(0,t.jsx)(y.zG,{})]})}})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm mt-2",children:[(0,t.jsxs)("span",{className:"text-greyscale-400",children:[(0,b.LH)(i.balance||0n)," ",i.symbol]}),(0,t.jsx)(x.z,{variant:"link",type:"button",size:"sm",className:"text-secondary ml-2",onClick:()=>{let e=(0,b.bM)(i.balance);E.setValue("fromTokenAmount",e)},disabled:M||P||en,children:"最高"})]})]}),(0,t.jsx)("div",{className:"flex justify-center my-4",children:(0,t.jsx)(x.z,{variant:"ghost",type:"button",size:"icon",className:"rounded-full hover:bg-gray-100",onClick:()=>{let e={...i},s={...S};"0x0"!==e.address&&"0x0"!==s.address&&(w(s),C(e),E.setValue("fromTokenAmount","0"))},disabled:M||P||en,children:(0,t.jsx)(m,{className:"h-6 w-6"})})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)(h.I,{type:"text",disabled:!0,placeholder:"0.0",className:"flex-grow w-2/3 !ring-secondary-foreground",value:S.amountShow,readOnly:!0}),(0,t.jsx)(y.Wi,{control:E.control,name:"toTokenAddress",render:e=>{let{field:s}=e;return(0,t.jsxs)(y.xJ,{className:"w-1/3",children:[(0,t.jsx)(y.NI,{children:(0,t.jsxs)(f.Ph,{value:s.value,onValueChange:e=>{s.onChange(e),C(s=>({...s,address:e}))},disabled:M||P||en,children:[(0,t.jsx)(f.i4,{className:"w-full",children:(0,t.jsx)(f.ki,{placeholder:"选择代币"})}),(0,t.jsx)(f.Bw,{children:(0,t.jsx)(f.Ql,{value:S.address,children:S.symbol})})]})}),(0,t.jsx)(y.zG,{})]})}})]}),(0,t.jsx)("div",{className:"flex justify-between items-center text-sm mt-2",children:(0,t.jsxs)("span",{className:"text-greyscale-400",children:[(0,b.LH)(S.balance||0n)," ",S.symbol]})})]}),(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)(x.z,{className:"w-1/2",onClick:et,disabled:es||en,children:B||D?"1.授权中...":Z||H?"1.确认中...":en?"1.已授权":"1.授权"}),(0,t.jsx)(x.z,{className:"w-1/2",onClick:ea,disabled:!en||es||K||U||Y,children:K?"2.兑换中...":U?"2.确认中...":Y?"2.已兑换":"2.兑换"})]})]})}),i.amount>0n&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-greyscale-400",children:"手续费 (0.3%)："}),(0,t.jsxs)("span",{children:[er," ",i.symbol]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-greyscale-400",children:"滑点上限 (自动)："}),(0,t.jsx)("span",{children:"5.5%"})]})]})]}),(0,t.jsx)(T.Z,{isLoading:ei,text:B||D||K?"提交交易...":"确认交易..."})]})};function C(){let e=(0,r.useRouter)(),{token:s}=(0,a.useContext)(w.M)||{};return(0,a.useEffect)(()=>{s&&!s.initialStakeRound&&"TEST20"!=s.symbol&&e.push("/gov/stakelp?symbol=".concat(s.symbol,"&first=true"))},[s]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{title:"兑换代币"}),(0,t.jsx)("main",{className:"flex-grow",children:(0,t.jsx)(S,{})})]})}}},function(e){e.O(0,[2624,7569,4637,5343,2888,9774,179],function(){return e(e.s=17137)}),_N_E=e.O()}]);