(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{17137:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dex/swap",function(){return s(61322)}])},76929:function(e,t,s){"use strict";s.d(t,{l0:function(){return u},NI:function(){return j},pf:function(){return b},Wi:function(){return f},xJ:function(){return h},lX:function(){return y},zG:function(){return w}});var n=s(85893),a=s(67294),r=s(4222),l=s(87536),i=s(40108),o=s(99489);let d=(0,s(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(o.f,{ref:t,className:(0,i.cn)(d(),s),...a})});c.displayName=o.f.displayName;let u=l.RV,m=a.createContext({}),f=e=>{let{...t}=e;return(0,n.jsx)(m.Provider,{value:{name:t.name},children:(0,n.jsx)(l.Qr,{...t})})},x=()=>{let e=a.useContext(m),t=a.useContext(p),{getFieldState:s,formState:n}=(0,l.Gc)(),r=s(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...r}},p=a.createContext({}),h=a.forwardRef((e,t)=>{let{className:s,...r}=e,l=a.useId();return(0,n.jsx)(p.Provider,{value:{id:l},children:(0,n.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",s),...r})})});h.displayName="FormItem";let y=a.forwardRef((e,t)=>{let{className:s,...a}=e,{error:r,formItemId:l}=x();return(0,n.jsx)(c,{ref:t,className:(0,i.cn)(r&&"text-destructive",s),htmlFor:l,...a})});y.displayName="FormLabel";let j=a.forwardRef((e,t)=>{let{...s}=e,{error:a,formItemId:l,formDescriptionId:i,formMessageId:o}=x();return(0,n.jsx)(r.g7,{ref:t,id:l,"aria-describedby":a?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!a,...s})});j.displayName="FormControl";let b=a.forwardRef((e,t)=>{let{className:s,...a}=e,{formDescriptionId:r}=x();return(0,n.jsx)("p",{ref:t,id:r,className:(0,i.cn)("text-sm text-muted-foreground",s),...a})});b.displayName="FormDescription";let w=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e,{error:l,formMessageId:o}=x(),d=l?String(null==l?void 0:l.message):a;return d?(0,n.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",s),...r,children:d}):null});w.displayName="FormMessage"},88659:function(e,t,s){"use strict";s.d(t,{Bw:function(){return p},Ph:function(){return c},Ql:function(){return h},i4:function(){return m},ki:function(){return u}});var n=s(85893),a=s(67294),r=s(86443),l=s(42171),i=s(15432),o=s(78865),d=s(40108);let c=r.fC;r.ZA;let u=r.B4,m=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,n.jsxs)(r.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[a,(0,n.jsx)(r.JO,{asChild:!0,children:(0,n.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.xz.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(r.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=r.u_.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(r.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=r.$G.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,position:l="popper",...i}=e;return(0,n.jsx)(r.h_,{children:(0,n.jsxs)(r.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...i,children:[(0,n.jsx)(f,{}),(0,n.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,n.jsx)(x,{})]})})});p.displayName=r.VY.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(r.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=r.__.displayName;let h=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,n.jsxs)(r.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(r.wU,{children:(0,n.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(r.eT,{children:a})]})});h.displayName=r.ck.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(r.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=r.Z0.displayName},44576:function(e,t,s){"use strict";var n=s(85893);s(67294);var a=s(23432);t.Z=e=>{let{isLoading:t,text:s="Loading"}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(a.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:s})]})}):null}},48105:function(e,t,s){"use strict";s.d(t,{S:function(){return a}});var n=s(86501);let a=e=>!!e||(n.Am.error("请先将钱包链接 ".concat("thinkium801")),!1)},61322:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return R}});var n=s(85893),a=s(67294),r=s(11163),l=s(37436),i=s(86501),o=s(1604),d=s(56312),c=s(92321),u=s(87536);let m=(0,s(31134).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var f=s(27245),x=s(21774),p=s(88659),h=s(76929),y=s(48105),j=s(91529),b=s(67068),w=s(19638),g=s(89810),N=s(71366),v=s(83540);let k=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],T="0xA150aE2F7F20b110A9Aae5F8DA04D7D347a81e59",A=function(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:n,error:a,isLoading:r}=(0,g.u)({address:T,abi:k,functionName:"getAmountsOut",args:[e,t],query:{enabled:!!e&&t.length>=2&&s}});return{data:n,error:a,isLoading:r}};var C=s(93778),E=()=>{let e=(0,a.useContext)(C.M);if(void 0===e)throw Error("useTokenContext must be used within a TokenProvider");return e},S=s(64777),F=s(44576);let z=e=>o.z.object({fromTokenAmount:o.z.string().nonempty("请输入兑换数量").refine(t=>{if(t.endsWith(".")||"0"===t)return!0;try{let s=(0,j.vz)(t);return s>0n&&s<=e}catch(e){return!1}},{message:"输入数量必须大于0且不超过您的可用余额"}),fromTokenAddress:o.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址"),toTokenAddress:o.z.string().regex(/^0x[0-9a-fA-F]{40}$/,"无效合约地址")});var _=()=>{let e=(0,r.useRouter)(),{address:t,chain:s}=(0,c.m)(),{token:l}=E(),[o,g]=(0,a.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n}),[C,_]=(0,a.useState)({symbol:"",address:"0x0",amount:0n,amountShow:"0",balance:0n});(0,a.useEffect)(()=>{l&&(g(e=>({...e,address:l.parentTokenAddress,symbol:l.parentTokenSymbol})),_(e=>({...e,address:l.address,symbol:l.symbol})))},[l]);let R=(0,u.cI)({resolver:(0,d.F)(z(o.balance)),defaultValues:{fromTokenAddress:(null==l?void 0:l.parentTokenAddress)||"0x0",toTokenAddress:(null==l?void 0:l.address)||"0x0",fromTokenAmount:""},mode:"onChange"});(0,a.useEffect)(()=>{R.setValue("fromTokenAddress",o.address),R.setValue("toTokenAddress",C.address)},[o.address,C.address,R]);let I=R.watch("fromTokenAmount");(0,a.useEffect)(()=>{g(e=>{let t=0n;try{var s;t=null!==(s=(0,j.vz)(I||"0"))&&void 0!==s?s:0n}catch(e){}return{...e,amount:t,amountShow:I||"0"}})},[I]);let{balance:Z,error:M,isPending:V}=(0,w.hS)(o.address,t),{balance:P,error:D,isPending:L}=(0,w.hS)(C.address,t);(0,a.useEffect)(()=>{Z&&g(e=>({...e,balance:Z})),P&&_(e=>({...e,balance:P}))},[Z,P]);let{data:O,error:W,isLoading:G}=A(o.amount,[o.address,C.address]);(0,a.useEffect)(()=>{if(O&&O.length>1){let e=BigInt(O[1]);_(t=>({...t,amount:e,amountShow:(0,j.bM)(e)}))}},[O]);let{approve:B,isWriting:J,isConfirming:Q,isConfirmed:$,writeError:X}=(0,w.yA)(null==l?void 0:l.address),{approve:q,isWriting:H,isConfirming:Y,isConfirmed:U,writeError:K}=(0,w.yA)(null==l?void 0:l.parentTokenAddress),{swap:ee,isWriting:et,isConfirming:es,isConfirmed:en,writeError:ea}=function(){let{writeContract:e,isPending:t,data:s,error:n}=(0,N.S)(),a=async(t,s,n,a,r)=>{try{await e({address:T,abi:k,functionName:"swapExactTokensForTokens",args:[t,s,n,a,r]})}catch(e){console.error("Swap failed:",e)}},{isLoading:r,isSuccess:l}=(0,v.A)({hash:s});return{swap:a,writeData:s,isWriting:t,writeError:n,isConfirming:r,isConfirmed:l}}(),er=J||H||Q||Y,el=$||U,ei=R.handleSubmit(async e=>{if((0,y.S)(s))try{let e=(null==l?void 0:l.symbol)===o.symbol?B:q;await e("0xA150aE2F7F20b110A9Aae5F8DA04D7D347a81e59",o.amount)}catch(e){console.error(e),i.Am.error((null==e?void 0:e.message)||"授权失败")}}),eo=R.handleSubmit(async e=>{if((0,y.S)(s))try{let e=BigInt(Math.floor(Date.now()/1e3)+1200);await ee(o.amount,C.amount/1000n*995n,[o.address,C.address],t,e)}catch(e){console.error(e),i.Am.error((null==e?void 0:e.message)||"兑换失败")}});(0,a.useEffect)(()=>{en&&(i.Am.success("兑换成功"),setTimeout(()=>{e.push("/my/?symbol=".concat(null==l?void 0:l.symbol))},2e3))},[en,e,null==l?void 0:l.symbol]);let[ed,ec]=(0,a.useState)("0");(0,a.useEffect)(()=>{if(o.amountShow){let e=.3*(parseFloat(o.amountShow)||0)/100;ec(e<1e-4?e.toExponential(2):e.toFixed(6))}else ec("0")},[o.amountShow]);let{handleContractError:eu}=(0,b.S)();if((0,a.useEffect)(()=>{X&&eu(X,"token"),K&&eu(K,"token"),W&&eu(W,"uniswapV2Router"),ea&&eu(ea,"uniswapV2Router"),D&&eu(D,"token"),M&&eu(M,"token")},[X,K,W,ea,D,M]),!l)return(0,n.jsx)("div",{children:"Loading..."});let em=er||et||es;return(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)(S.Z,{title:"兑换"}),(0,n.jsxs)("div",{className:"w-full max-w-md mt-4",children:[(0,n.jsx)(h.l0,{...R,children:(0,n.jsxs)("form",{children:[(0,n.jsxs)("div",{className:"mb-4 flex flex-col",children:[(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(h.Wi,{control:R.control,name:"fromTokenAmount",render:e=>{let{field:t}=e;return(0,n.jsxs)(h.xJ,{className:"w-2/3",children:[(0,n.jsx)(h.NI,{children:(0,n.jsx)(x.I,{placeholder:"请填写数量",type:"number",className:"w-full !ring-secondary-foreground",disabled:V||L||el,...t})}),(0,n.jsx)(h.zG,{})]})}}),(0,n.jsx)(h.Wi,{control:R.control,name:"fromTokenAddress",render:e=>{let{field:t}=e;return(0,n.jsxs)(h.xJ,{className:"w-1/3",children:[(0,n.jsx)(h.NI,{children:(0,n.jsxs)(p.Ph,{value:t.value,onValueChange:e=>{t.onChange(e),g(t=>({...t,address:e}))},disabled:V||L||el,children:[(0,n.jsx)(p.i4,{className:"w-full",children:(0,n.jsx)(p.ki,{placeholder:"选择代币"})}),(0,n.jsx)(p.Bw,{children:(0,n.jsx)(p.Ql,{value:o.address,children:o.symbol})})]})}),(0,n.jsx)(h.zG,{})]})}})]}),(0,n.jsxs)("div",{className:"flex items-center text-sm mt-2",children:[(0,n.jsxs)("span",{className:"text-greyscale-400",children:[(0,j.LH)(o.balance||0n)," ",o.symbol]}),(0,n.jsx)(f.z,{variant:"link",type:"button",size:"sm",className:"text-secondary ml-2",onClick:()=>{let e=(0,j.bM)(o.balance);R.setValue("fromTokenAmount",e)},disabled:V||L||el,children:"最高"})]})]}),(0,n.jsx)("div",{className:"flex justify-center my-4",children:(0,n.jsx)(f.z,{variant:"ghost",type:"button",size:"icon",className:"rounded-full hover:bg-gray-100",onClick:()=>{let e={...o},t={...C};"0x0"!==e.address&&"0x0"!==t.address&&(g(t),_(e),R.setValue("fromTokenAmount","0"))},disabled:V||L||el,children:(0,n.jsx)(m,{className:"h-6 w-6"})})}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(x.I,{type:"number",disabled:!0,placeholder:"0.0",className:"flex-grow w-2/3 !ring-secondary-foreground",value:C.amountShow,readOnly:!0}),(0,n.jsx)(h.Wi,{control:R.control,name:"toTokenAddress",render:e=>{let{field:t}=e;return(0,n.jsxs)(h.xJ,{className:"w-1/3",children:[(0,n.jsx)(h.NI,{children:(0,n.jsxs)(p.Ph,{value:t.value,onValueChange:e=>{t.onChange(e),_(t=>({...t,address:e}))},disabled:V||L||el,children:[(0,n.jsx)(p.i4,{className:"w-full",children:(0,n.jsx)(p.ki,{placeholder:"选择代币"})}),(0,n.jsx)(p.Bw,{children:(0,n.jsx)(p.Ql,{value:C.address,children:C.symbol})})]})}),(0,n.jsx)(h.zG,{})]})}})]}),(0,n.jsx)("div",{className:"flex justify-between items-center text-sm mt-2",children:(0,n.jsxs)("span",{className:"text-greyscale-400",children:[(0,j.LH)(C.balance||0n)," ",C.symbol]})})]}),(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)(f.z,{className:"w-1/2",onClick:ei,disabled:er||el,children:J||H?"1.授权中...":Q||Y?"1.确认中...":el?"1.已授权":"1.授权"}),(0,n.jsx)(f.z,{className:"w-1/2",onClick:eo,disabled:!el||er||et||es||en,children:et?"2.兑换中...":es?"2.确认中...":en?"2.已兑换":"2.兑换"})]})]})}),o.amount>0n&&(0,n.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-greyscale-400",children:"手续费 (0.3%)："}),(0,n.jsxs)("span",{children:[ed," ",o.symbol]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-greyscale-400",children:"滑点上限 (自动)："}),(0,n.jsx)("span",{children:"5.5%"})]})]})]}),(0,n.jsx)(F.Z,{isLoading:em,text:J||H||et?"提交交易...":"确认交易..."})]})};function R(){let e=(0,r.useRouter)(),{token:t}=(0,a.useContext)(C.M)||{};return(0,a.useEffect)(()=>{t&&!t.hasEnded?e.push("/launch?symbol=".concat(t.symbol)):t&&!t.initialStakeRound&&e.push("/gov/stakelp?symbol=".concat(t.symbol,"&first=true"))},[t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{title:"兑换代币"}),(0,n.jsx)("main",{className:"flex-grow",children:(0,n.jsx)(_,{})})]})}}},function(e){e.O(0,[2624,7569,8977,7380,2888,9774,179],function(){return e(e.s=17137)}),_N_E=e.O()}]);