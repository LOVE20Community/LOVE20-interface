(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1828],{52340:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stakelp",function(){return t(17792)}])},301:function(e,n,t){"use strict";t.d(n,{AT:function(){return d},op:function(){return o},oN:function(){return u}});var s=t(89810),a=t(71366),r=t(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],i="0xCB54233742E93C680B634DF5aDf33d28b288Dc95",o=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:a,error:r,isLoading:o}=(0,s.u)({address:i,abi:l,functionName:"getAmountsOut",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:a,error:r,isLoading:o}},d=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:a,error:r,isLoading:o}=(0,s.u)({address:i,abi:l,functionName:"getAmountsIn",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:a,error:r,isLoading:o}};function u(){let{writeContract:e,isPending:n,data:t,error:s}=(0,a.S)(),o=async(n,t,s,a,r)=>{try{await e({address:i,abi:l,functionName:"swapExactTokensForTokens",args:[n,t,s,a,r]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,r.A)({hash:t});return{swap:o,writeData:t,isWriting:n,writeError:s,isConfirming:d,isConfirmed:u}}},17792:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var s=t(85893),a=t(67294),r=t(92321),l=t(93778),i=t(19638),o=t(7224),d=t(86501),u=t(27245),c=t(78543),m=t(92180),f=t(91529),p=t(301);let v=function(e,n,t,s){let r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,p.op)(e,n,r&&s),{data:d,error:u,isLoading:c}=(0,a.useMemo)(()=>{if(!r||s)return{data:l,error:i,isLoading:o};{var a,d;let s;let r=0n;return r=(null==t?void 0:t.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),s=n&&n.length>=1&&(null===(a=n[0])||void 0===a?void 0:a.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e/r:e*r,{data:[e,s],error:null,isLoading:!1}}},[s,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}},x=function(e,n,t,s){let r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,p.AT)(e,n,r&&s),{data:d,error:u,isLoading:c}=(0,a.useMemo)(()=>{if(!r||s)return{data:l,error:i,isLoading:o};{var a,d;let s=0n;return s=(null==t?void 0:t.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),{data:[n&&n.length>=1&&(null===(a=n[0])||void 0===a?void 0:a.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e*s:e/s,e],error:null,isLoading:!1}}},[s,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}};var g=t(64777),y=t(44576),h=e=>{let{tokenBalance:n,parentTokenBalance:t,stakedTokenAmountOfLP:o}=e,{address:p,chain:h}=(0,r.m)(),{token:b}=(0,a.useContext)(l.M)||{},[N,A]=(0,a.useState)(""),[T,w]=(0,a.useState)(""),[j,k]=(0,a.useState)("4"),[E,C]=(0,a.useState)(!1),[L,B]=(0,a.useState)(!1),I=o>0n,{data:S,error:_,isLoading:D}=v((0,f.vz)(N),[null==b?void 0:b.parentTokenAddress,null==b?void 0:b.address],b,I,E),{data:F,error:z,isLoading:M}=x((0,f.vz)(T),[null==b?void 0:b.parentTokenAddress,null==b?void 0:b.address],b,I,L),O=e=>/^\d+(\.\d{0,12})?$/.test(e);(0,a.useEffect)(()=>{S&&S.length>1&&(B(!1),C(!1),w(Number((0,f.bM)(BigInt(S[1]))).toFixed(12).replace(/\.?0+$/,"")))},[S]),(0,a.useEffect)(()=>{F&&F.length>1&&(C(!1),B(!1),A(Number((0,f.bM)(BigInt(F[0]))).toFixed(12).replace(/\.?0+$/,"")))},[F]);let{approve:P,isWriting:q,isConfirming:W,isConfirmed:X,writeError:Z}=(0,i.yA)(null==b?void 0:b.address),{approve:$,isWriting:H,isConfirming:G,isConfirmed:J,writeError:K}=(0,i.yA)(null==b?void 0:b.parentTokenAddress),Q=async e=>{if(e.preventDefault(),et())try{let e=(0,f.vz)(T),n=(0,f.vz)(N);if(null===e||null===n){d.Am.error("输入格式错误");return}await P("0xf63D97fA996A57a78bf14839d112dd741Dc27321",e),await $("0xf63D97fA996A57a78bf14839d112dd741Dc27321",n)}catch(e){console.error("Approve failed",e)}};(0,a.useEffect)(()=>{(X||J)&&d.Am.success("授权成功")},[X,J]);let{stakeLiquidity:R,isWriting:U,isConfirming:V,isConfirmed:Y,writeError:ee}=(0,m.Xc)(),en=async e=>{if(e.preventDefault(),et()){if(X&&J){let e=(0,f.vz)(T),n=(0,f.vz)(N);if(null===e||null===n){d.Am.error("转换金额时出错");return}R(null==b?void 0:b.address,e,n,BigInt(j),p).catch(e=>{console.error("Stake failed",e)})}else d.Am.error("请先完成授权")}};(0,a.useEffect)(()=>{Y&&(d.Am.success("质押成功"),setTimeout(()=>{window.location.href="/gov?symbol=".concat(null==b?void 0:b.symbol)},2e3))},[Y]);let et=()=>!!(0,c.S)(h)&&(O(N)&&O(T)?!(0n>=(0,f.vz)(T)||0n>=(0,f.vz)(N))||(d.Am.error("质押数量不能为0"),!1):(d.Am.error("请输入有效的数量，最多支持12位小数"),!1)),es=q||H||W||G,ea=es||X||J;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"w-full flex-col items-center p-6 mt-1",children:[(0,s.jsx)(g.Z,{title:"质押获取治理票"}),(0,s.jsxs)("form",{onSubmit:en,className:"w-full max-w-md mt-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["质押父币数 (当前持有：",(0,s.jsxs)("span",{className:"text-secondary-400",children:[(0,f.LH)(t)," ",null==b?void 0:b.parentTokenSymbol]}),")"]}),(0,s.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==b?void 0:b.parentTokenSymbol," 数量"),value:N,onChange:e=>{let n=e.target.value;C(!0),(""===n||O(n))&&A(n),n||w("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0,disabled:ea})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["质押token数 (当前持有：",(0,s.jsxs)("span",{className:"text-secondary-400",children:[(0,f.LH)(n)," ",null==b?void 0:b.symbol]}),")"]}),(0,s.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==b?void 0:b.symbol," 数量"),value:T,onChange:e=>{let n=e.target.value;B(!0),(""===n||O(n))&&w(n),n||A("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0,disabled:ea})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"释放期"}),(0,s.jsx)("select",{value:j,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring ",required:!0,disabled:ea,children:Array.from({length:9},(e,n)=>(0,s.jsx)("option",{value:n+4,children:n+4},n+4))})]}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)(u.z,{className:"w-1/2 ",disabled:ea,onClick:Q,children:es?"1.授权中...":X?"1.已授权":"1.授权"}),(0,s.jsx)(u.z,{type:"submit",className:"w-1/2",disabled:!X||!J||U||V||Y,children:U||V?"2.质押中...":Y?"2.已质押":"2.质押"})]})]}),ee&&(0,s.jsx)("div",{className:"text-red-500",children:ee.message}),Z&&(0,s.jsx)("div",{className:"text-red-500",children:Z.message}),K&&(0,s.jsx)("div",{className:"text-red-500",children:K.message}),(0,s.jsx)(y.Z,{isLoading:es||U||V})]})})},b=t(58732),N=()=>{let{token:e}=(0,a.useContext)(l.M)||{},{address:n}=(0,r.m)(),{balance:t}=(0,i.hS)(null==e?void 0:e.address,n),{balance:d}=(0,i.hS)(null==e?void 0:e.parentTokenAddress,n),{tokenAmount:u,parentTokenAmount:c,feeTokenAmount:m,feeParentTokenAmount:f,isPending:p}=(0,o.tT)(null==e?void 0:e.slTokenAddress);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z,{title:"质押"}),(0,s.jsxs)("main",{className:"flex-grow",children:[u&&(0,s.jsx)(h,{tokenBalance:t||0n,parentTokenBalance:d||0n,stakedTokenAmountOfLP:u||0n}),(0,s.jsxs)("div",{className:"flex flex-col w-full p-6 mt-4",children:[(0,s.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,s.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,s.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}}},function(e){e.O(0,[4637,2180,6625,2888,9774,179],function(){return e(e.s=52340)}),_N_E=e.O()}]);