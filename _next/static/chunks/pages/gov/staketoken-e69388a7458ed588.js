(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7809],{51906:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/staketoken",function(){return n(10703)}])},10703:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return A}});var l=n(85893),r=n(67294),t=n(92321),i=n(93778),a=n(19638),o=n(67068),c=n(7224),d=n(37436),u=n(42083),m=n(86501),f=n(56312),x=n(87536),h=n(1604),j=n(76929),v=n(21774),g=n(27245),b=n(88659),k=n(23432),y=n(48105),w=n(91529),N=n(92180),p=n(64777),E=n(44576),C=e=>{let{tokenBalance:s}=e,{address:n,chain:c}=(0,t.m)(),{token:d}=(0,r.useContext)(i.M)||{},[u,C]=(0,r.useState)(!1),{approve:A,isWriting:P,isConfirming:S,isConfirmed:T,writeError:_}=(0,a.yA)(null==d?void 0:d.address),{stakeToken:z,isWriting:F,isConfirming:B,isConfirmed:I,writeError:Z}=(0,N.aE)(),{promisedWaitingRounds:L,isPending:W,error:X}=(0,N.L)(null==d?void 0:d.address,n),{allowance:D,isPending:G,error:V}=(0,a.yG)(null==d?void 0:d.address,n,"0x6F41E0C52501Ec0333f6eb8C7Fb7142e1b3B8DAc"),J=(0,r.useRef)(null),M=(0,r.useRef)(G);(0,r.useEffect)(()=>{if(M.current&&!G){var e;null===(e=J.current)||void 0===e||e.blur()}M.current=G},[G]);let O=(0,x.cI)({resolver:(0,f.F)(h.z.object({stakeTokenAmount:h.z.string().refine(e=>""!==e.trim(),{message:"请输入质押数量"}).refine(e=>Number(e)>0,{message:"质押代币数不能为0"}).refine(e=>(0,w.vz)(e)<=s,{message:"质押代币数不能大于持有代币数"}),releasePeriod:h.z.string().default("4")})),defaultValues:{stakeTokenAmount:"",releasePeriod:"4"},mode:"onChange"}),R=async e=>{if((0,y.S)(c))try{await A("0x6F41E0C52501Ec0333f6eb8C7Fb7142e1b3B8DAc",(0,w.vz)(e.stakeTokenAmount))}catch(e){m.Am.error((null==e?void 0:e.message)||"授权失败"),console.error("Approve failed",e)}};(0,r.useEffect)(()=>{T&&(C(!0),m.Am.success("授权".concat(null==d?void 0:d.symbol,"成功")))},[T,null==d?void 0:d.symbol]);let H=async e=>{if((0,y.S)(c))try{await z(null==d?void 0:d.address,(0,w.vz)(e.stakeTokenAmount),BigInt(e.releasePeriod),n)}catch(e){console.error("Stake failed",e)}};(0,r.useEffect)(()=>{I&&(m.Am.success("质押成功"),O.reset(),setTimeout(()=>{window.location.href="/gov?symbol=".concat(null==d?void 0:d.symbol)},2e3))},[I,O,null==d?void 0:d.symbol]),(0,r.useEffect)(()=>{void 0!==L&&L>0&&O.setValue("releasePeriod",String(L))},[L]);let Q=O.watch("stakeTokenAmount");(0,r.useEffect)(()=>{let e=0n;try{e=(0,w.vz)(Q||"0")}catch(s){e=0n}e>0n&&D&&D>0n&&D>=e?C(!0):C(!1)},[Q,D,G]);let{handleContractError:q}=(0,o.S)();return(0,r.useEffect)(()=>{Z&&q(Z,"stake"),_&&q(_,"token"),V&&q(V,"token")},[Z,_,V]),(0,l.jsxs)("div",{className:"w-full flex flex-col items-center p-6 mt-1",children:[(0,l.jsx)("div",{className:"w-full text-left mb-4",children:(0,l.jsx)(p.Z,{title:"质押增加治理收益"})}),(0,l.jsx)(j.l0,{...O,children:(0,l.jsxs)("form",{onSubmit:e=>e.preventDefault(),className:"w-full max-w-md space-y-4",children:[(0,l.jsx)(j.Wi,{control:O.control,name:"stakeTokenAmount",render:e=>{let{field:n}=e;return(0,l.jsxs)(j.xJ,{children:[(0,l.jsxs)(j.lX,{className:"text-sm text-greyscale-500",children:["质押数 (当前持有数量：",(0,l.jsxs)("span",{className:"text-secondary",children:[(0,w.LH)(s)," ",null==d?void 0:d.symbol]}),")"]}),(0,l.jsx)(j.NI,{children:(0,l.jsx)(v.I,{type:"number",placeholder:"输入 ".concat(null==d?void 0:d.symbol," 数量"),className:"!ring-secondary-foreground",...n})}),(0,l.jsx)(j.pf,{}),(0,l.jsx)(j.zG,{})]})}}),(0,l.jsx)(j.Wi,{control:O.control,name:"releasePeriod",render:e=>{let{field:s}=e;return(0,l.jsxs)(j.xJ,{children:[(0,l.jsx)(j.lX,{children:"释放期"}),(0,l.jsx)(j.NI,{children:(0,l.jsxs)(b.Ph,{onValueChange:e=>s.onChange(e),value:s.value,children:[(0,l.jsx)(b.i4,{className:"w-full !ring-secondary-foreground",children:(0,l.jsx)(b.ki,{placeholder:"选择释放期"})}),(0,l.jsx)(b.Bw,{children:Array.from({length:9},(e,s)=>s+4).filter(e=>e>=L).map(e=>(0,l.jsx)(b.Ql,{value:String(e),children:e},e))})]})}),(0,l.jsx)(j.pf,{children:"释放期：申请解锁后，几轮之后可以领取。"}),(0,l.jsx)(j.zG,{})]})}}),(0,l.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,l.jsx)(g.z,{ref:J,className:"w-1/2",disabled:G||P||S||u,onClick:()=>O.handleSubmit(R)(),children:G?(0,l.jsx)(k.Z,{className:"animate-spin h-4 w-4"}):P?"1.授权中...":S?"1.确认中...":u?"1.".concat(null==d?void 0:d.symbol,"已授权"):"1.授权".concat(null==d?void 0:d.symbol)}),(0,l.jsx)(g.z,{className:"w-1/2",disabled:!u||F||B||I,onClick:()=>O.handleSubmit(H)(),children:F?"2.质押中...":B?"2.确认中...":I?"2.已质押":"2.质押"})]})]})}),(0,l.jsx)(E.Z,{isLoading:P||S||F||B,text:P||F?"提交交易...":"确认交易..."})]})},A=()=>{let{token:e}=(0,r.useContext)(i.M)||{},{address:s}=(0,t.m)(),{balance:n}=(0,a.hS)(null==e?void 0:e.address,s),{tokenAmount:m,isPending:f,error:x}=(0,c.tT)(null==e?void 0:e.slTokenAddress),{handleContractError:h}=(0,o.S)();return(0,r.useEffect)(()=>{x&&h(x,"slToken")},[x]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"质押代币"}),(0,l.jsxs)("main",{className:"flex-grow",children:[f&&(0,l.jsx)(u.Z,{}),!f&&!m&&(0,l.jsx)("div",{className:"flex justify-center items-center mt-10",children:"需要先质押流动性LP，才可以质押代币"}),m&&(0,l.jsx)(C,{tokenBalance:n||0n}),(0,l.jsxs)("div",{className:"flex flex-col w-full p-6 mt-4",children:[(0,l.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,l.jsx)("div",{className:"text-sm text-greyscale-500 mb-2",children:"1、单独质押代币可获得激励提升（最高不超过 2 倍的验证激励），同时获得 st类代币作为质押的凭证；"}),(0,l.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮；"})]})]})]})}}},function(e){e.O(0,[2624,7569,4637,5263,7224,5343,2888,9774,179],function(){return e(e.s=51906)}),_N_E=e.O()}]);