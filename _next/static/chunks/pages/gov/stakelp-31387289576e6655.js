(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1828],{52340:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stakelp",function(){return t(27982)}])},301:function(e,n,t){"use strict";t.d(n,{AT:function(){return d},op:function(){return o},oN:function(){return u}});var r=t(89810),s=t(71366),a=t(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],i="0x06b4043b3254150d47c112a637C21cec1eb56840",o=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:i,abi:l,functionName:"getAmountsOut",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:s,error:a,isLoading:o}},d=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:i,abi:l,functionName:"getAmountsIn",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:s,error:a,isLoading:o}};function u(){let{writeContract:e,isPending:n,data:t,error:r}=(0,s.S)(),o=async(n,t,r,s,a)=>{try{await e({address:i,abi:l,functionName:"swapExactTokensForTokens",args:[n,t,r,s,a]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,a.A)({hash:t});return{swap:o,writeData:t,isWriting:n,writeError:r,isConfirming:d,isConfirmed:u}}},27982:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return F}});var r=t(85893),s=t(67294),a=t(92321),l=t(93778),i=t(19638),o=t(7224),d=t(67068),u=t(37436),c=t(42083),m=t(11163),f=t(86501),p=t(1604),g=t(56312),x=t(87536),v=t(41664),h=t.n(v),y=t(27245),k=t(76929),T=t(88659),b=t(21774),j=t(48105);let w=e=>{var n;return(null==e?void 0:e.reason)?e.reason:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.message)?e.data.message:(null==e?void 0:e.message)?e.message:"发生未知错误"};var A=t(91529),E=t(95049),N=t(301);let S=function(e,n,t,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,N.op)(e,n,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:l,error:i,isLoading:o};{var s,d;let r;let a=0n;return a=(null==t?void 0:t.address)==="0x4d120BfaFfEFe9DF3AAE24771c2c62d0a5d2A3bf"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),r=n&&n.length>=1&&(null===(s=n[0])||void 0===s?void 0:s.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e/a:e*a,{data:[e,r],error:null,isLoading:!1}}},[r,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}},C=function(e,n,t,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,N.AT)(e,n,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:l,error:i,isLoading:o};{var s,d;let r=0n;return r=(null==t?void 0:t.address)==="0x4d120BfaFfEFe9DF3AAE24771c2c62d0a5d2A3bf"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),{data:[n&&n.length>=1&&(null===(s=n[0])||void 0===s?void 0:s.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e*r:e/r,e],error:null,isLoading:!1}}},[r,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}};var z=t(92180),I=t(64777),L=t(44576),B=e=>{let{tokenBalance:n,parentTokenBalance:t,stakedTokenAmountOfLP:o}=e,{address:u,chain:c}=(0,a.m)(),v=(0,s.useContext)(l.M);if(!v)throw Error("TokenContext 必须在 TokenProvider 内使用");let{token:N,setToken:B}=v,{setError:F}=(0,E.V)(),{first:P}=(0,m.useRouter)().query,[_,M]=(0,s.useState)(!1),{initialStakeRound:W,isPending:O,error:R}=(0,z.VL)(null==N?void 0:N.address,_),V=(0,x.cI)({resolver:(0,g.F)(p.z.object({parentToken:p.z.preprocess(e=>{if("string"!=typeof e)return e;let n=e.replace(/。/g,".");return n.startsWith(".")&&(n="0"+n),n},p.z.string().regex(/^\d+(\.\d{1,12})?$/,"请输入合法数值，最多支持12位小数").refine(e=>{let n=(0,A.vz)(e);return null!==n&&n>0n},"质押父币数不能为 0").refine(e=>{let n=(0,A.vz)(e);return null!==n&&n<=t},"质押父币数不能超过当前持有")),stakeToken:p.z.preprocess(e=>{if("string"!=typeof e)return e;let n=e.replace(/。/g,".");return n.startsWith(".")&&(n="0"+n),n},p.z.string().regex(/^\d+(\.\d{1,12})?$/,"请输入合法数值，最多支持12位小数").refine(e=>{let n=(0,A.vz)(e);return null!==n&&n>0n},"质押 token 数不能为 0").refine(e=>{let t=(0,A.vz)(e);return null!==t&&t<=n},"质押 token 数不能超过当前持有")),releasePeriod:p.z.string()})),defaultValues:{parentToken:"",stakeToken:"",releasePeriod:"4"},mode:"onChange"}),[X,Z]=(0,s.useState)(!1),[$,q]=(0,s.useState)(!1),G=o>0n,J=V.watch("parentToken"),D=V.watch("stakeToken"),H=(0,A.vz)(J),Q=(0,A.vz)(D),{data:K,error:U,isLoading:Y}=S(null!==H?H:0n,[null==N?void 0:N.parentTokenAddress,null==N?void 0:N.address],N,G,X),{data:ee,error:en,isLoading:et}=C(null!==Q?Q:0n,[null==N?void 0:N.parentTokenAddress,null==N?void 0:N.address],N,G,$);(0,s.useEffect)(()=>{if(K&&K.length>1){let e=Number((0,A.bM)(BigInt(K[1]))).toFixed(12).replace(/\.?0+$/,"");V.setValue("stakeToken",e),Z(!1),q(!1)}},[K]),(0,s.useEffect)(()=>{if(ee&&ee.length>1){let e=Number((0,A.bM)(BigInt(ee[0]))).toFixed(12).replace(/\.?0+$/,"");V.setValue("parentToken",e),Z(!1),q(!1)}},[ee]);let{approve:er,isWriting:es,isConfirming:ea,isConfirmed:el,writeError:ei}=(0,i.yA)(null==N?void 0:N.address),{approve:eo,isWriting:ed,isConfirming:eu,isConfirmed:ec,writeError:em}=(0,i.yA)(null==N?void 0:N.parentTokenAddress);async function ef(e){if((0,j.S)(c))try{let n=(0,A.vz)(e.stakeToken),t=(0,A.vz)(e.parentToken);if(null===n||null===t)throw Error("无效的输入格式");await er("0x937cb7ae20B59531085F285F5161e22c4567715f",n),await eo("0x937cb7ae20B59531085F285F5161e22c4567715f",t)}catch(e){console.error("Approve failed",e),f.Am.error("授权失败，请检查输入格式")}}(0,s.useEffect)(()=>{(el||ec)&&f.Am.success("授权成功")},[el,ec]);let{stakeLiquidity:ep,isWriting:eg,isConfirming:ex,isConfirmed:ev,writeError:eh}=(0,z.Xc)();async function ey(e){if(!(0,j.S)(c))return;if(!(el&&ec)){f.Am.error("请先完成授权");return}let n=(0,A.vz)(e.stakeToken),t=(0,A.vz)(e.parentToken);if(null===n||null===t){f.Am.error("转换金额时出错，请检查输入格式");return}ep(null==N?void 0:N.address,n,t,BigInt(e.releasePeriod),u).catch(e=>{let n=w(e);f.Am.error(n||"质押失败，请重试"),console.error("Stake failed",e)})}function ek(){f.Am.success("质押成功"),setTimeout(()=>{window.location.href="/gov/?symbol=".concat(null==N?void 0:N.symbol)},2e3)}(0,s.useEffect)(()=>{ev&&((null==N?void 0:N.initialStakeRound)&&N.initialStakeRound>0?ek():M(!0))},[ev]),(0,s.useEffect)(()=>{_&&!O&&W&&W>0&&(B({...N,initialStakeRound:Number(W)}),ek())},[_,O,W]);let{handleContractError:eT}=(0,d.S)();(0,s.useEffect)(()=>{ei&&eT(ei,"stake"),em&&eT(em,"stake"),eh&&eT(eh,"stake"),R&&eT(R,"stake"),U&&eT(U,"uniswap"),en&&eT(en,"uniswap")},[ei,em,eh,R,U,en]);let eb=es||ed,ej=ea||eu,ew=el&&ec,eA=eb||ej||ew;return(0,s.useEffect)(()=>{"true"!==P||eA||F({name:"首次质押",message:"部署新代币后，先质押获取治理票，才能进行后续操作"})},[P,eA,F]),(0,s.useEffect)(()=>{!n&&!eA&&N&&N.symbol&&F({name:"余额不足",message:"您当前".concat(N.symbol,"数量为0，请先获取").concat(N.symbol)}),!t&&!eA&&N&&N.parentTokenSymbol&&F({name:"余额不足",message:"您当前".concat(N.parentTokenSymbol,"数量为0，请先获取").concat(N.parentTokenSymbol)})},[n,t,N]),(0,r.jsxs)("div",{className:"w-full flex-col items-center p-6 mt-1",children:[(0,r.jsx)("div",{className:"w-full flex justify-between items-center",children:(0,r.jsx)(I.Z,{title:"质押获取治理票"})}),(0,r.jsx)(k.l0,{...V,children:(0,r.jsxs)("form",{onSubmit:V.handleSubmit(ey),className:"w-full max-w-md mt-4 space-y-4",children:[(0,r.jsx)(k.Wi,{control:V.control,name:"parentToken",render:e=>{let{field:n}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsxs)(k.lX,{children:["质押父币数 (当前持有：",(0,r.jsx)("span",{className:"text-secondary-400 mr-2",children:(0,A.LH)(t)}),null==N?void 0:N.parentTokenSymbol,")",(0,r.jsxs)(h(),{href:"/launch/deposit/",className:"text-secondary-400 ml-2",children:["去获取",null==N?void 0:N.parentTokenSymbol]})]}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(b.I,{placeholder:"输入 ".concat(null==N?void 0:N.parentTokenSymbol," 数量"),...n,disabled:eA,onChange:e=>{n.onChange(e),Z(!0)},className:"!ring-secondary-foreground"})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:V.control,name:"stakeToken",render:e=>{let{field:t}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsxs)(k.lX,{children:["质押 token 数 (当前持有：",(0,r.jsx)("span",{className:"text-secondary-400 mr-2",children:(0,A.LH)(n)}),null==N?void 0:N.symbol,")"]}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(b.I,{placeholder:"输入 ".concat(null==N?void 0:N.symbol," 数量"),...t,disabled:eA,onChange:e=>{t.onChange(e),q(!0)},className:"!ring-secondary-foreground"})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:V.control,name:"releasePeriod",render:e=>{let{field:n}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"释放期"}),(0,r.jsx)(k.NI,{children:(0,r.jsxs)(T.Ph,{disabled:eA,onValueChange:e=>n.onChange(e),value:n.value,children:[(0,r.jsx)(T.i4,{className:"w-full !ring-secondary-foreground",children:(0,r.jsx)(T.ki,{placeholder:"选择释放期"})}),(0,r.jsx)(T.Bw,{children:Array.from({length:9},(e,n)=>(0,r.jsx)(T.Ql,{value:String(n+4),children:n+4},n+4))})]})}),(0,r.jsx)(k.pf,{children:"释放期：申请解锁后，几轮之后可以领取。"}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 mt-4",children:[(0,r.jsx)(y.z,{type:"button",className:"w-1/2",disabled:eA,onClick:V.handleSubmit(ef),children:eb?"1.授权中...":ej?"1.确认中...":ew?"1.已授权":"1.授权"}),(0,r.jsx)(y.z,{type:"submit",className:"w-1/2",disabled:!ew||eg||ex||ev,children:eg?"2.质押中...":ex?"2.确认中...":ev?"2.已质押":"2.质押"})]})]})}),(0,r.jsx)(L.Z,{isLoading:eb||ej||eg||ex||O&&_,text:eb||eg?"提交交易...":"确认交易..."})]})},F=()=>{let{token:e}=(0,s.useContext)(l.M)||{},{address:n}=(0,a.m)(),{balance:t,error:m}=(0,i.hS)(null==e?void 0:e.address,n),{balance:f,error:p}=(0,i.hS)(null==e?void 0:e.parentTokenAddress,n),g=!!(null==e?void 0:e.initialStakeRound)&&(null==e?void 0:e.initialStakeRound)>0,{tokenAmount:x,parentTokenAmount:v,feeTokenAmount:h,feeParentTokenAmount:y,isPending:k,error:T}=(0,o.tT)(null==e?void 0:e.slTokenAddress,g),{handleContractError:b}=(0,d.S)();return(0,s.useEffect)(()=>{T&&b(T,"slToken"),m&&b(m,"token"),p&&b(p,"token")},[T,m,p]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{title:"质押LP"}),(0,r.jsxs)("main",{className:"flex-grow",children:[k&&g&&(0,r.jsx)("div",{className:"flex justify-center items-center mt-10",children:(0,r.jsx)(c.Z,{})}),(!k||!g)&&(0,r.jsx)(B,{tokenBalance:t||0n,parentTokenBalance:f||0n,stakedTokenAmountOfLP:x||0n}),(0,r.jsxs)("div",{className:"flex flex-col w-full p-4 mt-4",children:[(0,r.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}}},function(e){e.O(0,[1664,2624,7569,4637,5263,7224,5343,2888,9774,179],function(){return e(e.s=52340)}),_N_E=e.O()}]);