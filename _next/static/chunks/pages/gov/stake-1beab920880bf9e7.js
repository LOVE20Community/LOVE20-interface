(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4246],{28673:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stake",function(){return n(1136)}])},301:function(e,t,n){"use strict";n.d(t,{AT:function(){return d},op:function(){return i},oN:function(){return u}});var s=n(89810),r=n(82016),a=n(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],o="0xCB54233742E93C680B634DF5aDf33d28b288Dc95",i=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:r,error:a,isLoading:i}=(0,s.u)({address:o,abi:l,functionName:"getAmountsOut",args:[e,t],query:{enabled:!!e&&t.length>=2&&n}});return{data:r,error:a,isLoading:i}},d=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:r,error:a,isLoading:i}=(0,s.u)({address:o,abi:l,functionName:"getAmountsIn",args:[e,t],query:{enabled:!!e&&t.length>=2&&n}});return{data:r,error:a,isLoading:i}};function u(){let{writeContract:e,isPending:t,data:n,error:s}=(0,r.S)(),i=async(t,n,s,r,a)=>{try{await e({address:o,abi:l,functionName:"swapExactTokensForTokens",args:[t,n,s,r,a]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,a.A)({hash:n});return{swap:i,writeData:n,isWriting:t,writeError:s,isConfirming:d,isConfirmed:u}}},1136:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var s=n(85893),r=n(67294),a=n(92321),l=n(19638),o=n(93778),i=n(35337),d=n(86501),u=n(27245),c=n(92180),m=n(91529),f=n(301);let g=function(e,t,n,s){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:o,isLoading:i}=(0,f.op)(e,t,a&&s),{data:d,error:u,isLoading:c}=(0,r.useMemo)(()=>{if(console.log("------------useGetAmountsOut-------------"),console.log("amountIn",e),console.log("path",t),console.log("token",n),console.log("pairExists",s),console.log("isEnabled",a),console.log("_data",l),!a||s)return{data:l,error:o,isLoading:i};{var r,d;let s;let a=0n;return a=(null==n?void 0:n.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),s=t&&t.length>=1&&(null===(r=t[0])||void 0===r?void 0:r.toLowerCase())===(null==n?void 0:null===(d=n.address)||void 0===d?void 0:d.toLowerCase())?e/a:e*a,{data:[e,s],error:null,isLoading:!1}}},[s,l,o,i,e,t,null==n?void 0:n.address]);return{data:d,error:u,isLoading:c}},x=function(e,t,n,s){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:o,isLoading:i}=(0,f.AT)(e,t,a&&s),{data:d,error:u,isLoading:c}=(0,r.useMemo)(()=>{if(console.log("------------useGetAmountsIn-------------"),console.log("amountOut",e),console.log("path",t),console.log("token",n),console.log("pairExists",s),console.log("isEnabled",a),console.log("_data",l),!a||s)return{data:l,error:o,isLoading:i};{var r,d;let s=0n;return s=(null==n?void 0:n.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),{data:[t&&t.length>=1&&(null===(r=t[0])||void 0===r?void 0:r.toLowerCase())===(null==n?void 0:null===(d=n.address)||void 0===d?void 0:d.toLowerCase())?e*s:e/s,e],error:null,isLoading:!1}}},[s,l,o,i,e,t,null==n?void 0:n.address]);return{data:d,error:u,isLoading:c}};var b=e=>{let{tokenBalance:t,parentTokenBalance:n,stakedTokenAmountOfLP:i}=e,{address:f}=(0,a.m)(),{token:b}=(0,r.useContext)(o.M)||{},{approve:p,isWriting:h,isConfirmed:v,writeError:y}=(0,l.yA)(null==b?void 0:b.address),{approve:w,isWriting:j,isConfirmed:N,writeError:k}=(0,l.yA)(null==b?void 0:b.parentTokenAddress),{stakeLiquidity:A,isWriting:E,isConfirming:T,isConfirmed:C,writeError:S}=(0,c.Xc)(),[I,B]=(0,r.useState)(""),[L,_]=(0,r.useState)(""),[D,F]=(0,r.useState)("4"),[q,M]=(0,r.useState)(!1),[z,O]=(0,r.useState)(!1),P=i>0n,{data:W,error:H,isLoading:Z}=g((0,m.vz)(I),[null==b?void 0:b.parentTokenAddress,null==b?void 0:b.address],b,P,q),{data:X,error:$,isLoading:G}=x((0,m.vz)(L),[null==b?void 0:b.parentTokenAddress,null==b?void 0:b.address],b,P,z),[K,J]=(0,r.useState)(!1),Q=async e=>{if(e.preventDefault(),!R(I)||!R(L)){d.Am.error("请输入有效的数量，最多支持12位小数");return}try{J(!0);let e=(0,m.vz)(L),t=(0,m.vz)(I);if(null===e||null===t){d.Am.error("输入格式错误"),J(!1);return}await p("0xf63D97fA996A57a78bf14839d112dd741Dc27321",e),await w("0xf63D97fA996A57a78bf14839d112dd741Dc27321",t)}catch(e){console.error("Approve failed",e),J(!1)}},R=e=>/^\d+(\.\d{0,12})?$/.test(e);return(0,r.useEffect)(()=>{if(v&&N&&K){let e=(0,m.vz)(L),t=(0,m.vz)(I);if(null===e||null===t){d.Am.error("转换金额时出错"),J(!1);return}A(null==b?void 0:b.address,e,t,BigInt(D),f).then(()=>{J(!1)}).catch(e=>{console.error("Stake failed",e),J(!1)})}},[v,N,K,A,b,D,f,I,L]),(0,r.useEffect)(()=>{C&&(d.Am.success("质押成功"),B(""),_(""),F("4"),setTimeout(()=>{window.location.reload()},2e3))},[C]),(0,r.useEffect)(()=>{W&&W.length>1&&(O(!1),M(!1),_(Number((0,m.bM)(BigInt(W[1]))).toFixed(12).replace(/\.?0+$/,"")))},[W]),(0,r.useEffect)(()=>{X&&X.length>1&&(M(!1),O(!1),B(Number((0,m.bM)(BigInt(X[0]))).toFixed(12).replace(/\.?0+$/,"")))},[X]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"w-full flex flex-col items-center rounded p-4 bg-white mt-1",children:[(0,s.jsx)("div",{className:"w-full text-left mb-4",children:(0,s.jsx)("h2",{className:"relative pl-4 text-gray-700 text-base font-medium before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-1 before:bg-red-500",children:"质押获取治理票："})}),(0,s.jsxs)("form",{onSubmit:Q,className:"w-full max-w-md",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:["质押父币数 (当前持有：",(0,m.LH)(n)," ",null==b?void 0:b.parentTokenSymbol,")"]}),(0,s.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==b?void 0:b.parentTokenSymbol," 数量"),value:I,onChange:e=>{let t=e.target.value;M(!0),(""===t||R(t))&&B(t),t||_("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring bg-white",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:["质押token数 (当前持有：",(0,m.LH)(t)," ",null==b?void 0:b.symbol,")"]}),(0,s.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==b?void 0:b.symbol," 数量"),value:L,onChange:e=>{let t=e.target.value;O(!0),(""===t||R(t))&&_(t),t||B("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring bg-white",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:"释放期"}),(0,s.jsx)("select",{value:D,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring  bg-white",required:!0,children:Array.from({length:9},(e,t)=>(0,s.jsx)("option",{value:t+4,children:t+4},t+4))})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(u.z,{type:"submit",className:"w-1/2 bg-blue-500 text-white py-2 rounded hover:bg-blue-600",disabled:E||T,children:E||T?"质押中...":"质押"})})]}),S&&(0,s.jsx)("div",{className:"text-red-500",children:S.message}),y&&(0,s.jsx)("div",{className:"text-red-500",children:y.message}),k&&(0,s.jsx)("div",{className:"text-red-500",children:k.message})]})})},p=n(77156),h=n(91318),v=e=>{let{tokenBalance:t}=e,{address:n}=(0,a.m)(),{token:i}=(0,r.useContext)(o.M)||{},{totalSupply:f,isPending:g}=(0,p.A5)(null==i?void 0:i.stTokenAddress),{approve:x,isWriting:b,isConfirming:v,isConfirmed:y,writeError:w}=(0,l.yA)(null==i?void 0:i.address);console.log("---isPendingApproveToken",b),console.log("---isConfirmedApproveToken",y),console.log("---errApproveToken",w);let{stakeToken:j,isWriting:N,isConfirming:k,isConfirmed:A,writeError:E}=(0,c.aE)();console.log("---isPendingStakeToken",N),console.log("---isConfirmingStakeToken",k),console.log("---isConfirmedStakeToken",A),console.log("---errStakeToken",E);let[T,C]=(0,r.useState)(""),[S,I]=(0,r.useState)("4"),B=async()=>{if(0n===BigInt(T)){d.Am.error("请输入正确的数量");return}try{await x("0xf63D97fA996A57a78bf14839d112dd741Dc27321",(0,m.vz)(T))}catch(e){d.Am.error((null==e?void 0:e.message)||"授权失败"),console.error("Approve failed",e)}};(0,r.useEffect)(()=>{y&&d.Am.success("授权成功")},[y]);let L=async()=>{if(0n===BigInt(T)){d.Am.error("请输入正确的数量");return}try{await j(null==i?void 0:i.address,(0,m.vz)(T),BigInt(S),n)}catch(e){console.error("Stake failed",e)}};return(0,r.useEffect)(()=>{A&&(d.Am.success("质押成功"),C(""),I(""),setTimeout(()=>{window.location.reload()},2e3))},[A]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex justify-center w-full items-center rounded p-4 bg-white mt-4",children:(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 mr-2",children:"代币质押总量"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:N?(0,s.jsx)(h.Z,{}):(0,m.LH)(f||BigInt(0))})]})}),(0,s.jsxs)("div",{className:"w-full flex flex-col items-center rounded p-4 bg-white mt-1",children:[(0,s.jsx)("div",{className:"w-full text-left mb-4",children:(0,s.jsxs)("h2",{className:"relative pl-4 text-gray-700 text-base font-medium before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-1 before:bg-red-500",children:["质押增加治理收益：",(0,s.jsx)("span",{className:"text-gray-500 text-sm font-normal",children:"(最多两倍)"})]})}),(0,s.jsxs)("form",{className:"w-full max-w-md",onSubmit:e=>e.preventDefault(),children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:["质押token数 (当前持有：",(0,m.LH)(t)," ",null==i?void 0:i.symbol,")"]}),(0,s.jsx)("input",{type:"number",placeholder:"输入 ".concat(null==i?void 0:i.symbol," 数量"),value:T,onChange:e=>{C(e.target.value)},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring bg-white",required:!0})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:"释放期"}),(0,s.jsx)("select",{value:S,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring bg-white",required:!0,children:Array.from({length:9},(e,t)=>(0,s.jsx)("option",{value:t+4,children:t+4},t+4))})]}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)(u.z,{className:"w-1/2 ".concat(y?"bg-gray-600 hover:bg-gray-700":"bg-blue-600 hover:bg-blue-700"),disabled:b||v||y,onClick:B,children:b||v?"授权中...":y?"1.已授权":"1.授权"}),(0,s.jsx)(u.z,{className:"w-1/2 ".concat(y?"bg-blue-600 hover:bg-blue-700":"bg-gray-600 hover:bg-gray-700"),disabled:!y||N||k,onClick:L,children:N||k?"质押中...":"2.质押"})]})]}),E&&(0,s.jsx)("div",{className:"text-red-500",children:E.message}),w&&(0,s.jsx)("div",{className:"text-red-500",children:w.message})]})]})},y=n(18303),w=()=>{let{token:e}=(0,r.useContext)(o.M)||{},{address:t}=(0,a.m)(),{balance:n}=(0,l.hS)(null==e?void 0:e.address,t),{balance:d}=(0,l.hS)(null==e?void 0:e.parentTokenAddress,t),[u,c]=(0,r.useState)(BigInt(-1));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{title:"质押"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsx)("div",{className:"w-full flex flex-col items-center rounded p-4 bg-white  space-y-4",children:(0,s.jsx)(y.Z,{showStakeToken:!1,onTokenAmountChange:c})}),u!==BigInt(-1)&&(0,s.jsx)(b,{tokenBalance:n||0n,parentTokenBalance:d||0n,stakedTokenAmountOfLP:u}),u!==BigInt(-1)&&(0,s.jsx)(v,{tokenBalance:n||0n}),(0,s.jsxs)("div",{className:"flex flex-col w-full rounded p-4 bg-white mt-4",children:[(0,s.jsx)("div",{className:"text-base font-bold text-gray-700 pb-2",children:"规则说明："}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}},89810:function(e,t,n){"use strict";n.d(t,{u:function(){return i}});var s=n(37003),r=n(36100),a=n(82451),l=n(82002),o=n(37122);function i(e={}){let{abi:t,address:n,functionName:i,query:d={}}=e,u=e.code,c=(0,o.Z)(e),m=(0,l.x)({config:c}),f=function(e,t={}){return{async queryFn({queryKey:n}){let r=t.abi;if(!r)throw Error("abi is required");let{functionName:a,scopeKey:l,...o}=n[1],i=(()=>{let e=n[1];if(e.address)return{address:e.address};if(e.code)return{code:e.code};throw Error("address or code is required")})();if(!a)throw Error("functionName is required");return(0,s.L)(e,{abi:r,functionName:a,args:o.args,...i,...o})},queryKey:function(e={}){let{abi:t,...n}=e;return["readContract",(0,r.OP)(n)]}(t)}}(c,{...e,chainId:e.chainId??m}),g=!!((n||u)&&t&&i&&(d.enabled??!0));return(0,a.aM)({...d,...f,enabled:g,structuralSharing:d.structuralSharing??r.if})}}},function(e){e.O(0,[4784,8424,9638,765,7716,2888,9774,179],function(){return e(e.s=28673)}),_N_E=e.O()}]);