(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1828],{52340:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stakelp",function(){return t(17792)}])},301:function(e,n,t){"use strict";t.d(n,{AT:function(){return d},op:function(){return o},oN:function(){return u}});var s=t(89810),a=t(71366),r=t(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],i="0xCB54233742E93C680B634DF5aDf33d28b288Dc95",o=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:a,error:r,isLoading:o}=(0,s.u)({address:i,abi:l,functionName:"getAmountsOut",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:a,error:r,isLoading:o}},d=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:a,error:r,isLoading:o}=(0,s.u)({address:i,abi:l,functionName:"getAmountsIn",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:a,error:r,isLoading:o}};function u(){let{writeContract:e,isPending:n,data:t,error:s}=(0,a.S)(),o=async(n,t,s,a,r)=>{try{await e({address:i,abi:l,functionName:"swapExactTokensForTokens",args:[n,t,s,a,r]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,r.A)({hash:t});return{swap:o,writeData:t,isWriting:n,writeError:s,isConfirming:d,isConfirmed:u}}},17792:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var s=t(85893),a=t(67294),r=t(92321),l=t(93778),i=t(19638),o=t(7224),d=t(86501),u=t(27245),c=t(92180),m=t(91529),f=t(301);let p=function(e,n,t,s){let r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,f.op)(e,n,r&&s),{data:d,error:u,isLoading:c}=(0,a.useMemo)(()=>{if(!r||s)return{data:l,error:i,isLoading:o};{var a,d;let s;let r=0n;return r=(null==t?void 0:t.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),s=n&&n.length>=1&&(null===(a=n[0])||void 0===a?void 0:a.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e/r:e*r,{data:[e,s],error:null,isLoading:!1}}},[s,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}},x=function(e,n,t,s){let r=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,f.AT)(e,n,r&&s),{data:d,error:u,isLoading:c}=(0,a.useMemo)(()=>{if(!r||s)return{data:l,error:i,isLoading:o};{var a,d;let s=0n;return s=(null==t?void 0:t.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),{data:[n&&n.length>=1&&(null===(a=n[0])||void 0===a?void 0:a.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e*s:e/s,e],error:null,isLoading:!1}}},[s,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}};var v=t(64777),g=t(44576),y=e=>{let{tokenBalance:n,parentTokenBalance:t,stakedTokenAmountOfLP:o}=e,{address:f}=(0,r.m)(),{token:y}=(0,a.useContext)(l.M)||{},[h,b]=(0,a.useState)(""),[N,T]=(0,a.useState)(""),[w,A]=(0,a.useState)("4"),[j,k]=(0,a.useState)(!1),[E,C]=(0,a.useState)(!1),L=o>0n,{data:B,error:I,isLoading:S}=p((0,m.vz)(h),[null==y?void 0:y.parentTokenAddress,null==y?void 0:y.address],y,L,j),{data:_,error:D,isLoading:F}=x((0,m.vz)(N),[null==y?void 0:y.parentTokenAddress,null==y?void 0:y.address],y,L,E),M=e=>/^\d+(\.\d{0,12})?$/.test(e);(0,a.useEffect)(()=>{B&&B.length>1&&(C(!1),k(!1),T(Number((0,m.bM)(BigInt(B[1]))).toFixed(12).replace(/\.?0+$/,"")))},[B]),(0,a.useEffect)(()=>{_&&_.length>1&&(k(!1),C(!1),b(Number((0,m.bM)(BigInt(_[0]))).toFixed(12).replace(/\.?0+$/,"")))},[_]);let{approve:z,isWriting:O,isConfirming:P,isConfirmed:q,writeError:W}=(0,i.yA)(null==y?void 0:y.address),{approve:X,isWriting:Z,isConfirming:$,isConfirmed:H,writeError:G}=(0,i.yA)(null==y?void 0:y.parentTokenAddress),J=async e=>{if(e.preventDefault(),!M(h)||!M(N)){d.Am.error("请输入有效的数量，最多支持12位小数");return}try{let e=(0,m.vz)(N),n=(0,m.vz)(h);if(null===e||null===n){d.Am.error("输入格式错误");return}await z("0xf63D97fA996A57a78bf14839d112dd741Dc27321",e),await X("0xf63D97fA996A57a78bf14839d112dd741Dc27321",n)}catch(e){console.error("Approve failed",e)}};(0,a.useEffect)(()=>{(q||H)&&d.Am.success("授权成功")},[q,H]);let{stakeLiquidity:K,isWriting:Q,isConfirming:R,isConfirmed:U,writeError:V}=(0,c.Xc)(),Y=async e=>{if(e.preventDefault(),q&&H){let e=(0,m.vz)(N),n=(0,m.vz)(h);if(null===e||null===n){d.Am.error("转换金额时出错");return}K(null==y?void 0:y.address,e,n,BigInt(w),f).catch(e=>{console.error("Stake failed",e)})}else d.Am.error("请先完成授权")};(0,a.useEffect)(()=>{U&&(d.Am.success("质押成功"),setTimeout(()=>{window.location.href="/gov?symbol=".concat(null==y?void 0:y.symbol)},2e3))},[U]);let ee=O||Z||P||$,en=ee||q||H;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"w-full flex-col items-center p-6 mt-1",children:[(0,s.jsx)(v.Z,{title:"质押获取治理票"}),(0,s.jsxs)("form",{onSubmit:Y,className:"w-full max-w-md mt-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["质押父币数 (当前持有：",(0,s.jsxs)("span",{className:"text-secondary-400",children:[(0,m.LH)(t)," ",null==y?void 0:y.parentTokenSymbol]}),")"]}),(0,s.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==y?void 0:y.parentTokenSymbol," 数量"),value:h,onChange:e=>{let n=e.target.value;k(!0),(""===n||M(n))&&b(n),n||T("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0,disabled:en})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["质押token数 (当前持有：",(0,s.jsxs)("span",{className:"text-secondary-400",children:[(0,m.LH)(n)," ",null==y?void 0:y.symbol]}),")"]}),(0,s.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==y?void 0:y.symbol," 数量"),value:N,onChange:e=>{let n=e.target.value;C(!0),(""===n||M(n))&&T(n),n||b("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0,disabled:en})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"释放期"}),(0,s.jsx)("select",{value:w,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring ",required:!0,disabled:en,children:Array.from({length:9},(e,n)=>(0,s.jsx)("option",{value:n+4,children:n+4},n+4))})]}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)(u.z,{className:"w-1/2 ",disabled:en,onClick:J,children:ee?"1.授权中...":q?"1.已授权":"1.授权"}),(0,s.jsx)(u.z,{type:"submit",className:"w-1/2",disabled:!q||!H||Q||R||U,children:Q||R?"2.质押中...":U?"2.已质押":"2.质押"})]})]}),V&&(0,s.jsx)("div",{className:"text-red-500",children:V.message}),W&&(0,s.jsx)("div",{className:"text-red-500",children:W.message}),G&&(0,s.jsx)("div",{className:"text-red-500",children:G.message}),(0,s.jsx)(g.Z,{isLoading:ee||Q||R})]})})},h=t(58732),b=()=>{let{token:e}=(0,a.useContext)(l.M)||{},{address:n}=(0,r.m)(),{balance:t}=(0,i.hS)(null==e?void 0:e.address,n),{balance:d}=(0,i.hS)(null==e?void 0:e.parentTokenAddress,n),{tokenAmount:u,parentTokenAmount:c,feeTokenAmount:m,feeParentTokenAmount:f,isPending:p}=(0,o.tT)(null==e?void 0:e.slTokenAddress);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{title:"质押"}),(0,s.jsxs)("main",{className:"flex-grow",children:[u&&(0,s.jsx)(y,{tokenBalance:t||0n,parentTokenBalance:d||0n,stakedTokenAmountOfLP:u||0n}),(0,s.jsxs)("div",{className:"flex flex-col w-full p-6 mt-4",children:[(0,s.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,s.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,s.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}}},function(e){e.O(0,[4637,2180,372,2888,9774,179],function(){return e(e.s=52340)}),_N_E=e.O()}]);