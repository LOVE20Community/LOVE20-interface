(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1828],{52340:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stakelp",function(){return t(27982)}])},301:function(e,n,t){"use strict";t.d(n,{AT:function(){return d},op:function(){return o},oN:function(){return u}});var r=t(89810),s=t(71366),a=t(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],i="0xd5495bdc48d99FF3255Ad59389Ff8cE0d6cb163d",o=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:i,abi:l,functionName:"getAmountsOut",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:s,error:a,isLoading:o}},d=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:i,abi:l,functionName:"getAmountsIn",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:s,error:a,isLoading:o}};function u(){let{writeContract:e,isPending:n,data:t,error:r}=(0,s.S)(),o=async(n,t,r,s,a)=>{try{await e({address:i,abi:l,functionName:"swapExactTokensForTokens",args:[n,t,r,s,a]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,a.A)({hash:t});return{swap:o,writeData:t,isWriting:n,writeError:r,isConfirming:d,isConfirmed:u}}},27982:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return F}});var r=t(85893),s=t(67294),a=t(93778),l=t(7224),i=t(67068),o=t(37436),d=t(42083),u=t(92321),c=t(11163),m=t(86501),f=t(1604),p=t(56312),v=t(87536),g=t(27245),x=t(76929),h=t(88659),y=t(21774),k=t(23432),b=t(41664),T=t.n(b),j=t(48105);let E=e=>{var n;return(null==e?void 0:e.reason)?e.reason:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.message)?e.data.message:(null==e?void 0:e.message)?e.message:"发生未知错误"};var w=t(91529),N=t(95049),C=t(19638),S=t(301);let A=function(e,n,t,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,S.op)(e,n,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:l,error:i,isLoading:o};{var s,d;let r;let a=0n;return a=(null==t?void 0:t.address)==="0x8eE76E8B4aDB0Ed61eaeCB83DBdEA0cD8432C5B7"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),r=n&&n.length>=1&&(null===(s=n[0])||void 0===s?void 0:s.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e/a:e*a,{data:[e,r],error:null,isLoading:!1}}},[r,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}},B=function(e,n,t,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,S.AT)(e,n,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:l,error:i,isLoading:o};{var s,d;let r=0n;return r=(null==t?void 0:t.address)==="0x8eE76E8B4aDB0Ed61eaeCB83DBdEA0cD8432C5B7"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),{data:[n&&n.length>=1&&(null===(s=n[0])||void 0===s?void 0:s.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e*r:e/r,e],error:null,isLoading:!1}}},[r,l,i,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}};var z=t(92180),I=t(64777),L=t(44576),P=e=>{var n,t;let{stakedTokenAmountOfLP:l}=e,{address:o,chain:b}=(0,u.m)(),S=(0,s.useContext)(a.M);if(!S)throw Error("TokenContext 必须在 TokenProvider 内使用");let{token:P,setToken:F}=S,{setError:_}=(0,N.V)(),{first:D}=(0,c.useRouter)().query,{balance:M,isPending:R,error:W}=(0,C.hS)(null==P?void 0:P.address,o),{balance:O,isPending:V,error:Z}=(0,C.hS)(null==P?void 0:P.parentTokenAddress,o),[X,G]=(0,s.useState)(!1),{initialStakeRound:$,isPending:q,error:J}=(0,z.VL)(null==P?void 0:P.address,X),H=(0,v.cI)({resolver:(0,p.F)((n=O||0n,t=M||0n,f.z.object({parentToken:f.z.preprocess(e=>{if("string"!=typeof e)return e;let n=e.replace(/。/g,".");return n.startsWith(".")&&(n="0"+n),n},f.z.string().regex(/^\d+(\.\d{1,12})?$/,"请输入合法数值，最多支持12位小数").refine(e=>{let n=(0,w.vz)(e);return null!==n&&n>0n},"质押父币数不能为 0").refine(e=>{let t=(0,w.vz)(e);return null!==t&&t<=n},"质押父币数不能超过当前持有")),stakeToken:f.z.preprocess(e=>{if("string"!=typeof e)return e;let n=e.replace(/。/g,".");return n.startsWith(".")&&(n="0"+n),n},f.z.string().regex(/^\d+(\.\d{1,12})?$/,"请输入合法数值，最多支持12位小数").refine(e=>{let n=(0,w.vz)(e);return null!==n&&n>0n},"质押 token 数不能为 0").refine(e=>{let n=(0,w.vz)(e);return null!==n&&n<=t},"质押 token 数不能超过当前持有")),releasePeriod:f.z.string()}))),defaultValues:{parentToken:"",stakeToken:"",releasePeriod:"4"},mode:"onChange"}),{slAmount:Q,stAmount:K,promisedWaitingRounds:U,requestedUnstakeRound:Y,govVotes:ee,isPending:en,error:et}=(0,z.L)(null==P?void 0:P.address,o),[er,es]=(0,s.useState)(!1),[ea,el]=(0,s.useState)(!1),{allowance:ei,isPending:eo,error:ed}=(0,C.yG)(null==P?void 0:P.address,o,"0x6F41E0C52501Ec0333f6eb8C7Fb7142e1b3B8DAc"),{allowance:eu,isPending:ec,error:em}=(0,C.yG)(null==P?void 0:P.parentTokenAddress,o,"0x6F41E0C52501Ec0333f6eb8C7Fb7142e1b3B8DAc"),{approve:ef,isWriting:ep,isConfirming:ev,isConfirmed:eg,writeError:ex}=(0,C.yA)(null==P?void 0:P.address),{approve:eh,isWriting:ey,isConfirming:ek,isConfirmed:eb,writeError:eT}=(0,C.yA)(null==P?void 0:P.parentTokenAddress);async function ej(e){if((0,j.S)(b))try{let n=(0,w.vz)(e.stakeToken);if(null===n)throw Error("无效的输入格式");await ef("0x6F41E0C52501Ec0333f6eb8C7Fb7142e1b3B8DAc",n)}catch(e){console.error("Token 授权失败",e),m.Am.error("token 授权失败，请检查输入格式")}}async function eE(e){if((0,j.S)(b))try{let n=(0,w.vz)(e.parentToken);if(null===n)throw Error("无效的输入格式");await eh("0x6F41E0C52501Ec0333f6eb8C7Fb7142e1b3B8DAc",n)}catch(e){console.error("父币授权失败",e),m.Am.error("父币授权失败，请检查输入格式")}}(0,s.useEffect)(()=>{eg&&(es(!0),m.Am.success("授权".concat(null==P?void 0:P.symbol,"成功"))),eb&&(el(!0),m.Am.success("授权".concat(null==P?void 0:P.parentTokenSymbol,"成功")))},[eg,eb]);let[ew,eN]=(0,s.useState)(!1),[eC,eS]=(0,s.useState)(!1),eA=l>0n,eB=H.watch("parentToken"),ez=H.watch("stakeToken"),eI=(0,w.vz)(eB),eL=(0,w.vz)(ez),{data:eP,error:eF,isLoading:e_}=A(null!==eI?eI:0n,[null==P?void 0:P.parentTokenAddress,null==P?void 0:P.address],P,eA,ew),{data:eD,error:eM,isLoading:eR}=B(null!==eL?eL:0n,[null==P?void 0:P.parentTokenAddress,null==P?void 0:P.address],P,eA,eC);(0,s.useEffect)(()=>{if(eP&&eP.length>1){let e=Number((0,w.bM)(BigInt(eP[1]))).toFixed(12).replace(/\.?0+$/,"");H.setValue("stakeToken",e),eN(!1),eS(!1)}},[eP]),(0,s.useEffect)(()=>{if(eD&&eD.length>1){let e=Number((0,w.bM)(BigInt(eD[0]))).toFixed(12).replace(/\.?0+$/,"");H.setValue("parentToken",e),eN(!1),eS(!1)}},[eD]),(0,s.useEffect)(()=>{eI>0n&&eu&&eu>0n&&eu>=eI?el(!0):el(!1)},[eI,ec]),(0,s.useEffect)(()=>{eL>0n&&ei&&ei>0n&&ei>=eL?es(!0):es(!1)},[eL,eo]);let{stakeLiquidity:eW,isWriting:eO,isConfirming:eV,isConfirmed:eZ,writeError:eX}=(0,z.Xc)();async function eG(e){if(!(0,j.S)(b))return;if(!(er&&ea)){m.Am.error("请先完成授权");return}let n=(0,w.vz)(e.stakeToken),t=(0,w.vz)(e.parentToken);if(null===n||null===t){m.Am.error("转换金额时出错，请检查输入格式");return}eW(null==P?void 0:P.address,n,t,BigInt(e.releasePeriod),o).catch(e=>{let n=E(e);m.Am.error(n||"质押失败，请重试"),console.error("Stake failed",e)})}function e$(){m.Am.success("质押成功"),setTimeout(()=>{window.location.href="/gov/?symbol=".concat(null==P?void 0:P.symbol)},2e3)}(0,s.useEffect)(()=>{eZ&&((null==P?void 0:P.initialStakeRound)&&P.initialStakeRound>0?e$():G(!0))},[eZ]),(0,s.useEffect)(()=>{X&&!q&&$&&$>0&&(F({...P,initialStakeRound:Number($)}),e$())},[X,q,$]);let{handleContractError:eq}=(0,i.S)();(0,s.useEffect)(()=>{Z&&eq(Z,"token"),W&&eq(W,"token"),em&&eq(em,"token"),ed&&eq(ed,"token"),ex&&eq(ex,"stake"),eT&&eq(eT,"stake"),eX&&eq(eX,"stake"),J&&eq(J,"stake"),eF&&eq(eF,"uniswap"),eM&&eq(eM,"uniswap"),et&&eq(et,"stake")},[Z,W,em,ed,ex,eT,eX,J,eF,eM,et]);let eJ=ep||ey,eH=ev||ek,eQ=eJ||eH||er&&ea;(0,s.useEffect)(()=>{"true"!==D||eQ||_({name:"提示：",message:"新部署的代币，需先质押获取治理票，才能后续操作"})},[D,eQ,_]),(0,s.useEffect)(()=>{R||M||eQ||!P||!P.symbol||_({name:"余额不足",message:"您当前".concat(P.symbol,"数量为0，请先获取").concat(P.symbol)}),V||O||eQ||!P||!P.parentTokenSymbol||_({name:"余额不足",message:"您当前".concat(P.parentTokenSymbol,"数量为0，请先获取").concat(P.parentTokenSymbol)})},[M,O,P]),(0,s.useEffect)(()=>{void 0!==U&&U>0&&H.setValue("releasePeriod",String(U))},[U]);let eK=(0,s.useRef)(null),eU=(0,s.useRef)(eo);return((0,s.useEffect)(()=>{if(eU.current&&!eo){var e;null===(e=eK.current)||void 0===e||e.blur()}eU.current=eo},[eo]),en)?(0,r.jsx)(d.Z,{}):(0,r.jsxs)("div",{className:"w-full flex-col items-center p-6 mt-1",children:[(0,r.jsx)("div",{className:"w-full flex justify-between items-center",children:(0,r.jsx)(I.Z,{title:"质押获取治理票"})}),(0,r.jsx)(x.l0,{...H,children:(0,r.jsxs)("form",{onSubmit:H.handleSubmit(eG),className:"w-full max-w-md mt-4 space-y-4",children:[(0,r.jsx)(x.Wi,{control:H.control,name:"parentToken",render:e=>{let{field:n}=e;return(0,r.jsxs)(x.xJ,{children:[(0,r.jsxs)(x.lX,{children:["质押父币数 (当前持有：",(0,r.jsx)("span",{className:"text-secondary-400 mr-2",children:(0,w.LH)(O||0n)}),null==P?void 0:P.parentTokenSymbol,")",(0,r.jsxs)(T(),{href:"/launch/deposit/",className:"text-secondary-400 ml-2",children:["去获取",null==P?void 0:P.parentTokenSymbol]})]}),(0,r.jsx)(x.NI,{children:(0,r.jsx)(y.I,{placeholder:"输入 ".concat(null==P?void 0:P.parentTokenSymbol," 数量"),...n,disabled:eQ,onChange:e=>{n.onChange(e),eN(!0)},className:"!ring-secondary-foreground"})}),(0,r.jsx)(x.zG,{})]})}}),(0,r.jsx)(x.Wi,{control:H.control,name:"stakeToken",render:e=>{let{field:n}=e;return(0,r.jsxs)(x.xJ,{children:[(0,r.jsxs)(x.lX,{children:["质押 token 数 (当前持有：",(0,r.jsx)("span",{className:"text-secondary-400 mr-2",children:(0,w.LH)(M||0n)}),null==P?void 0:P.symbol,")",!!M&&M<=10n&&(0,r.jsxs)(T(),{href:"/dex/swap/",className:"text-secondary-400 ml-2",children:["去获取",null==P?void 0:P.symbol]})]}),(0,r.jsx)(x.NI,{children:(0,r.jsx)(y.I,{placeholder:"输入 ".concat(null==P?void 0:P.symbol," 数量"),...n,disabled:eQ,onChange:e=>{n.onChange(e),eS(!0)},className:"!ring-secondary-foreground"})}),(0,r.jsx)(x.zG,{})]})}}),(0,r.jsx)(x.Wi,{control:H.control,name:"releasePeriod",render:e=>{let{field:n}=e;return(0,r.jsxs)(x.xJ,{children:[(0,r.jsx)(x.lX,{children:"释放期"}),(0,r.jsx)(x.NI,{children:(0,r.jsxs)(h.Ph,{disabled:eQ,onValueChange:e=>n.onChange(e),value:n.value,children:[(0,r.jsx)(h.i4,{className:"w-full !ring-secondary-foreground",children:(0,r.jsx)(h.ki,{placeholder:"选择释放期"})}),(0,r.jsx)(h.Bw,{children:Array.from({length:9},(e,n)=>n+4).filter(e=>e>=U).map(e=>(0,r.jsx)(h.Ql,{value:String(e),children:e},e))})]})}),(0,r.jsx)(x.pf,{children:"释放期：申请解锁后，几轮之后可以领取。"}),(0,r.jsx)(x.zG,{})]})}}),(0,r.jsxs)("div",{className:"flex justify-center space-x-2 mt-4",children:[(0,r.jsx)(g.z,{type:"button",className:"w-1/3",ref:eK,disabled:eo||ep||ev||er,onClick:H.handleSubmit(ej),children:eo?(0,r.jsx)(k.Z,{className:"animate-spin"}):ep?"1.提交中...":ev?"1.确认中...":er?"1.".concat(null==P?void 0:P.symbol,"已授权"):"1.授权".concat(null==P?void 0:P.symbol)}),(0,r.jsx)(g.z,{type:"button",className:"w-1/3",disabled:!er||ec||ey||ek||ea,onClick:H.handleSubmit(eE),children:ec?(0,r.jsx)(k.Z,{className:"animate-spin"}):ey?"2.提交中...":ek?"2.确认中...":ea?"2.".concat(null==P?void 0:P.parentTokenSymbol,"已授权"):"2.授权".concat(null==P?void 0:P.parentTokenSymbol)}),(0,r.jsx)(g.z,{type:"submit",className:"w-1/3",disabled:!er||!ea||eO||eV||eZ,children:eO?"3.质押中...":eV?"3.确认中...":eZ?"3.已质押":"3.质押"})]})]})}),(0,r.jsx)(L.Z,{isLoading:eJ||eH||eO||eV||q&&X,text:eJ||eO?"提交交易...":"确认交易..."})]})},F=()=>{let{token:e}=(0,s.useContext)(a.M)||{},n=!!(null==e?void 0:e.initialStakeRound)&&(null==e?void 0:e.initialStakeRound)>0,{tokenAmount:t,isPending:u,error:c}=(0,l.tT)(null==e?void 0:e.slTokenAddress,n),{handleContractError:m}=(0,i.S)();return(0,s.useEffect)(()=>{c&&m(c,"slToken")},[c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{title:"质押LP"}),(0,r.jsxs)("main",{className:"flex-grow",children:[u&&n&&(0,r.jsx)("div",{className:"flex justify-center items-center mt-10",children:(0,r.jsx)(d.Z,{})}),(!u||!n)&&(0,r.jsx)(P,{stakedTokenAmountOfLP:t||0n}),(0,r.jsxs)("div",{className:"flex flex-col w-full p-4 mt-4",children:[(0,r.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}}},function(e){e.O(0,[1664,2624,7569,4637,5263,7224,5343,2888,9774,179],function(){return e(e.s=52340)}),_N_E=e.O()}]);