(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4246],{28673:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stake",function(){return n(1136)}])},301:function(e,t,n){"use strict";n.d(t,{AT:function(){return d},op:function(){return o},oN:function(){return u}});var r=n(89810),s=n(82016),a=n(83540);let l=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],i=n(34155).env.NEXT_PUBLIC_CONTRACT_ADDRESS_UNISWAP_V2_ROUTER,o=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:i,abi:l,functionName:"getAmountsOut",args:[e,t],query:{enabled:!!e&&t.length>=2&&n}});return{data:s,error:a,isLoading:o}},d=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:i,abi:l,functionName:"getAmountsIn",args:[e,t],query:{enabled:!!e&&t.length>=2&&n}});return{data:s,error:a,isLoading:o}};function u(){let{writeContract:e,isPending:t,data:n,error:r}=(0,s.S)(),o=async(t,n,r,s,a)=>{try{await e({address:i,abi:l,functionName:"swapExactTokensForTokens",args:[t,n,r,s,a]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,a.A)({hash:n});return{swap:o,writeData:n,isWriting:t,writeError:r,isConfirming:d,isConfirmed:u}}},1136:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(85893),s=n(67294),a=n(92321),l=n(19638),i=n(93778),o=n(35337),d=n(86501),u=n(92180),c=n(91529),m=n(301),f=n(34155);let x=function(e,t,n,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,m.op)(e,t,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:l,error:i,isLoading:o};{var s,d;let r;let a=0n;return a=(null==n?void 0:n.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt(f.env.NEXT_PUBLIC_LAUNCH_AMOUNT||"0")/BigInt(f.env.NEXT_PUBLIC_FIRST_PARENT_TOKEN_FUNDRAISING_GOAL||"1"):BigInt(f.env.NEXT_PUBLIC_LAUNCH_AMOUNT||"0")/BigInt(f.env.NEXT_PUBLIC_PARENT_TOKEN_FUNDRAISING_GOAL||"1"),r=t&&t.length>=1&&(null===(s=t[0])||void 0===s?void 0:s.toLowerCase())===(null==n?void 0:null===(d=n.address)||void 0===d?void 0:d.toLowerCase())?e/a:e*a,{data:[e,r],error:null,isLoading:!1}}},[r,l,i,o,e,t,null==n?void 0:n.address]);return{data:d,error:u,isLoading:c}},g=function(e,t,n,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:l,error:i,isLoading:o}=(0,m.AT)(e,t,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:l,error:i,isLoading:o};{var s,d;let r=0n;return r=(null==n?void 0:n.address)==="0x52961E46a166c999b14066E76CD67a1A5FE4F3f6"?BigInt(f.env.NEXT_PUBLIC_LAUNCH_AMOUNT||"0")/BigInt(f.env.NEXT_PUBLIC_FIRST_PARENT_TOKEN_FUNDRAISING_GOAL||"1"):BigInt(f.env.NEXT_PUBLIC_LAUNCH_AMOUNT||"0")/BigInt(f.env.NEXT_PUBLIC_PARENT_TOKEN_FUNDRAISING_GOAL||"1"),{data:[t&&t.length>=1&&(null===(s=t[0])||void 0===s?void 0:s.toLowerCase())===(null==n?void 0:null===(d=n.address)||void 0===d?void 0:d.toLowerCase())?e*r:e/r,e],error:null,isLoading:!1}}},[r,l,i,o,e,t,null==n?void 0:n.address]);return{data:d,error:u,isLoading:c}};var b=e=>{let{tokenBalance:t,parentTokenBalance:n,stakedTokenAmountOfLP:o}=e,{address:m}=(0,a.m)(),{token:f}=(0,s.useContext)(i.M)||{},{approve:b,isWriting:p,isConfirmed:v,writeError:h}=(0,l.yA)(null==f?void 0:f.address),{approve:N,isWriting:y,isConfirmed:A,writeError:T}=(0,l.yA)(null==f?void 0:f.parentTokenAddress),{stakeLiquidity:j,isWriting:w,isConfirming:_,isConfirmed:E,writeError:I}=(0,u.Xc)(),[C,L]=(0,s.useState)(""),[k,S]=(0,s.useState)(""),[B,U]=(0,s.useState)("4"),[O,P]=(0,s.useState)(!1),[F,M]=(0,s.useState)(!1),D=o>0n,{data:$,error:R,isLoading:q}=x((0,c.vz)(C),[null==f?void 0:f.parentTokenAddress,null==f?void 0:f.address],f,D,O),{data:X,error:z,isLoading:G}=g((0,c.vz)(k),[null==f?void 0:f.parentTokenAddress,null==f?void 0:f.address],f,D,F),[H,W]=(0,s.useState)(!1),K=async e=>{if(e.preventDefault(),!Z(C)||!Z(k)){d.Am.error("请输入有效的数量，最多支持9位小数");return}try{W(!0);let e=(0,c.vz)(k),t=(0,c.vz)(C);if(null===e||null===t){d.Am.error("输入格式错误"),W(!1);return}await b("0xf63D97fA996A57a78bf14839d112dd741Dc27321",e),await N("0xf63D97fA996A57a78bf14839d112dd741Dc27321",t)}catch(e){console.error("Approve failed",e),W(!1)}},Z=e=>/^\d+(\.\d{0,9})?$/.test(e);return(0,s.useEffect)(()=>{if(v&&A&&H){let e=(0,c.vz)(k),t=(0,c.vz)(C);if(null===e||null===t){d.Am.error("转换金额时出错"),W(!1);return}j(null==f?void 0:f.address,e,t,BigInt(B),m).then(()=>{W(!1)}).catch(e=>{console.error("Stake failed",e),W(!1)})}},[v,A,H,j,f,B,m,C,k]),(0,s.useEffect)(()=>{E&&(d.Am.success("质押成功"),L(""),S(""),U("4"),setTimeout(()=>{window.location.reload()},2e3))},[E]),(0,s.useEffect)(()=>{$&&$.length>1&&(M(!1),P(!1),S(Number((0,c.bM)(BigInt($[1]))).toFixed(12).replace(/\.?0+$/,"")))},[$]),(0,s.useEffect)(()=>{X&&X.length>1&&(P(!1),M(!1),L(Number((0,c.bM)(BigInt(X[0]))).toFixed(12).replace(/\.?0+$/,"")))},[X]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"w-full flex flex-col items-center rounded p-4 bg-base-100 mt-1",children:[(0,r.jsx)("div",{className:"w-full text-left mb-4",children:(0,r.jsx)("h2",{className:"relative pl-4 text-gray-700 text-base font-medium before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-1 before:bg-red-500",children:"质押获取治理票："})}),(0,r.jsxs)("form",{onSubmit:K,className:"w-full max-w-md",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:["质押父币数 (当前持有：",(0,c.LH)(n)," ",null==f?void 0:f.parentTokenSymbol,")"]}),(0,r.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==f?void 0:f.parentTokenSymbol," 数量"),value:C,onChange:e=>{let t=e.target.value;P(!0),(""===t||Z(t))&&L(t),t||S("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:["质押token数 (当前持有：",(0,c.LH)(t)," ",null==f?void 0:f.symbol,")"]}),(0,r.jsx)("input",{type:"text",placeholder:"输入 ".concat(null==f?void 0:f.symbol," 数量"),value:k,onChange:e=>{let t=e.target.value;M(!0),(""===t||Z(t))&&S(t),t||L("0")},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:"释放期"}),(0,r.jsx)("select",{value:B,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0,children:Array.from({length:9},(e,t)=>(0,r.jsx)("option",{value:t+4,children:t+4},t+4))})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{type:"submit",className:"w-1/2 bg-blue-500 text-white py-2 rounded hover:bg-blue-600",disabled:w||_,children:w||_?"质押中...":"质押"})})]}),I&&(0,r.jsx)("div",{className:"text-red-500",children:I.message}),h&&(0,r.jsx)("div",{className:"text-red-500",children:h.message}),T&&(0,r.jsx)("div",{className:"text-red-500",children:T.message})]})})},p=n(77156),v=n(91318),h=e=>{let{tokenBalance:t}=e,{address:n}=(0,a.m)(),{token:o}=(0,s.useContext)(i.M)||{},{totalSupply:m,isPending:f}=(0,p.A5)(null==o?void 0:o.stTokenAddress),{approve:x,isWriting:g,isConfirmed:b,writeError:h}=(0,l.yA)(null==o?void 0:o.address),{stakeToken:N,isWriting:y,isConfirming:A,isConfirmed:T,writeError:j}=(0,u.aE)(),[w,_]=(0,s.useState)(""),[E,I]=(0,s.useState)("4"),[C,L]=(0,s.useState)(!1),k=async()=>{if(0n===BigInt(w)){d.Am.error("请输入正确的数量");return}console.log("stakeTokenAmount",w,"releasePeriod",E);try{L(!0),await x("0xf63D97fA996A57a78bf14839d112dd741Dc27321",(0,c.vz)(w))}catch(e){console.error("Approve failed",e),L(!1)}};return(0,s.useEffect)(()=>{b&&C&&N(null==o?void 0:o.address,(0,c.vz)(w),BigInt(E),n).then(()=>{L(!1)}).catch(e=>{console.error("Stake failed",e),L(!1)})},[b,C]),(0,s.useEffect)(()=>{T&&(d.Am.success("质押成功"),_(""),I(""),setTimeout(()=>{window.location.reload()},2e3))},[T]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center w-full items-center rounded p-4 bg-base-100 mt-4",children:(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-500 mr-2",children:"代币质押总量"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:y?(0,r.jsx)(v.Z,{}):(0,c.LH)(m||BigInt(0))})]})}),(0,r.jsxs)("div",{className:"w-full flex flex-col items-center rounded p-4 bg-base-100 mt-1",children:[(0,r.jsx)("div",{className:"w-full text-left mb-4",children:(0,r.jsxs)("h2",{className:"relative pl-4 text-gray-700 text-base font-medium before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-1 before:bg-red-500",children:["质押增加治理收益：",(0,r.jsx)("span",{className:"text-gray-500 text-sm font-normal",children:"(最多两倍)"})]})}),(0,r.jsxs)("form",{onSubmit:k,className:"w-full max-w-md",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:["质押token数 (当前持有：",(0,c.LH)(t)," ",null==o?void 0:o.symbol,")"]}),(0,r.jsx)("input",{type:"number",placeholder:"输入 ".concat(null==o?void 0:o.symbol," 数量"),value:w,onChange:e=>{_(e.target.value)},className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-left mb-1 text-sm text-gray-500",children:"释放期"}),(0,r.jsx)("select",{value:E,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 border rounded focus:outline-none focus:ring",required:!0,children:Array.from({length:9},(e,t)=>(0,r.jsx)("option",{value:t+4,children:t+4},t+4))})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{type:"button",className:"w-1/2 bg-blue-500 text-white py-2 rounded hover:bg-blue-600",disabled:y||A,onClick:k,children:y||A?"质押中...":"质押"})})]}),j&&(0,r.jsx)("div",{className:"text-red-500",children:j.message}),h&&(0,r.jsx)("div",{className:"text-red-500",children:h.message})]})]})},N=n(18303),y=()=>{let{token:e}=(0,s.useContext)(i.M)||{},{address:t}=(0,a.m)(),{balance:n}=(0,l.hS)(null==e?void 0:e.address,t),{balance:d}=(0,l.hS)(null==e?void 0:e.parentTokenAddress,t),[u,c]=(0,s.useState)(BigInt(-1));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{title:"质押"}),(0,r.jsxs)("main",{className:"flex-grow",children:[(0,r.jsx)("div",{className:"w-full flex flex-col items-center rounded p-4 bg-base-100 border-t border-gray-100",children:(0,r.jsx)(N.Z,{showStakeToken:!1,onTokenAmountChange:c})}),u!==BigInt(-1)&&(0,r.jsx)(b,{tokenBalance:n||0n,parentTokenBalance:d||0n,stakedTokenAmountOfLP:u}),u!==BigInt(-1)&&(0,r.jsx)(h,{tokenBalance:n||0n}),(0,r.jsxs)("div",{className:"flex flex-col w-full rounded p-4 bg-base-100 mt-4",children:[(0,r.jsx)("div",{className:"text-base font-bold text-gray-700 pb-2",children:"规则说明："}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}},21803:function(e,t,n){"use strict";function r(e,t){let[n,r="0"]=e.split("."),s=n.startsWith("-");if(s&&(n=n.slice(1)),r=r.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${r}`))&&(n=`${BigInt(n)+1n}`),r="";else if(r.length>t){let[e,s,a]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],l=Math.round(Number(`${s}.${a}`));(r=l>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${l}`).length>t&&(r=r.slice(1),n=`${BigInt(n)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${s?"-":""}${n}${r}`)}n.d(t,{v:function(){return r}})},89810:function(e,t,n){"use strict";n.d(t,{u:function(){return o}});var r=n(37003),s=n(36100),a=n(82451),l=n(82002),i=n(37122);function o(e={}){let{abi:t,address:n,functionName:o,query:d={}}=e,u=e.code,c=(0,i.Z)(e),m=(0,l.x)({config:c}),f=function(e,t={}){return{async queryFn({queryKey:n}){let s=t.abi;if(!s)throw Error("abi is required");let{functionName:a,scopeKey:l,...i}=n[1],o=(()=>{let e=n[1];if(e.address)return{address:e.address};if(e.code)return{code:e.code};throw Error("address or code is required")})();if(!a)throw Error("functionName is required");return(0,r.L)(e,{abi:s,functionName:a,args:i.args,...o,...i})},queryKey:function(e={}){let{abi:t,...n}=e;return["readContract",(0,s.OP)(n)]}(t)}}(c,{...e,chainId:e.chainId??m}),x=!!((n||u)&&t&&o&&(d.enabled??!0));return(0,a.aM)({...d,...f,enabled:x,structuralSharing:d.structuralSharing??s.if})}}},function(e){e.O(0,[9215,2432,2180,7716,2888,9774,179],function(){return e(e.s=28673)}),_N_E=e.O()}]);