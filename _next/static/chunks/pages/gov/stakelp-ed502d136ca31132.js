(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1828],{52340:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gov/stakelp",function(){return t(27982)}])},301:function(e,n,t){"use strict";t.d(n,{AT:function(){return d},op:function(){return o},oN:function(){return u}});var r=t(89810),s=t(71366),a=t(83540);let i=[{type:"function",name:"swapExactTokensForTokens",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"amountOutMin",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"},{name:"to",type:"address",internalType:"address"},{name:"deadline",type:"uint256",internalType:"uint256"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"nonpayable"},{type:"function",name:"getAmountsOut",inputs:[{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getAmountsIn",inputs:[{name:"amountOut",type:"uint256",internalType:"uint256"},{name:"path",type:"address[]",internalType:"address[]"}],outputs:[{name:"amounts",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"}],l="0x06b4043b3254150d47c112a637C21cec1eb56840",o=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:l,abi:i,functionName:"getAmountsOut",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:s,error:a,isLoading:o}},d=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{data:s,error:a,isLoading:o}=(0,r.u)({address:l,abi:i,functionName:"getAmountsIn",args:[e,n],query:{enabled:!!e&&n.length>=2&&t}});return{data:s,error:a,isLoading:o}};function u(){let{writeContract:e,isPending:n,data:t,error:r}=(0,s.S)(),o=async(n,t,r,s,a)=>{try{await e({address:l,abi:i,functionName:"swapExactTokensForTokens",args:[n,t,r,s,a]})}catch(e){console.error("Swap failed:",e)}},{isLoading:d,isSuccess:u}=(0,a.A)({hash:t});return{swap:o,writeData:t,isWriting:n,writeError:r,isConfirming:d,isConfirmed:u}}},27982:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return F}});var r=t(85893),s=t(67294),a=t(93778),i=t(7224),l=t(67068),o=t(37436),d=t(42083),u=t(92321),c=t(11163),m=t(86501),f=t(1604),p=t(56312),g=t(87536),v=t(41664),x=t.n(v),h=t(27245),y=t(76929),k=t(88659),b=t(21774),T=t(48105);let j=e=>{var n;return(null==e?void 0:e.reason)?e.reason:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.message)?e.data.message:(null==e?void 0:e.message)?e.message:"发生未知错误"};var w=t(91529),N=t(95049),A=t(19638),E=t(301);let C=function(e,n,t,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:i,error:l,isLoading:o}=(0,E.op)(e,n,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:i,error:l,isLoading:o};{var s,d;let r;let a=0n;return a=(null==t?void 0:t.address)==="0xB491aBAF0F43BFF23A1F7c8414433D55ac2859A3"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),r=n&&n.length>=1&&(null===(s=n[0])||void 0===s?void 0:s.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e/a:e*a,{data:[e,r],error:null,isLoading:!1}}},[r,i,l,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}},S=function(e,n,t,r){let a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],{data:i,error:l,isLoading:o}=(0,E.AT)(e,n,a&&r),{data:d,error:u,isLoading:c}=(0,s.useMemo)(()=>{if(!a||r)return{data:i,error:l,isLoading:o};{var s,d;let r=0n;return r=(null==t?void 0:t.address)==="0xB491aBAF0F43BFF23A1F7c8414433D55ac2859A3"?BigInt("1E+27")/BigInt("1E+17"):BigInt("1E+27")/BigInt("2E+25"),{data:[n&&n.length>=1&&(null===(s=n[0])||void 0===s?void 0:s.toLowerCase())===(null==t?void 0:null===(d=t.address)||void 0===d?void 0:d.toLowerCase())?e*r:e/r,e],error:null,isLoading:!1}}},[r,i,l,o,e,n,null==t?void 0:t.address]);return{data:d,error:u,isLoading:c}};var z=t(92180),I=t(64777),L=t(44576),B=e=>{var n,t;let{stakedTokenAmountOfLP:i}=e,{address:o,chain:d}=(0,u.m)(),v=(0,s.useContext)(a.M);if(!v)throw Error("TokenContext 必须在 TokenProvider 内使用");let{token:E,setToken:B}=v,{setError:F}=(0,N.V)(),{first:P}=(0,c.useRouter)().query,{balance:_,isPending:M,error:W}=(0,A.hS)(null==E?void 0:E.address,o),{balance:O,isPending:R,error:V}=(0,A.hS)(null==E?void 0:E.parentTokenAddress,o),[X,Z]=(0,s.useState)(!1),{initialStakeRound:$,isPending:q,error:G}=(0,z.VL)(null==E?void 0:E.address,X),J=(0,g.cI)({resolver:(0,p.F)((n=O||0n,t=_||0n,f.z.object({parentToken:f.z.preprocess(e=>{if("string"!=typeof e)return e;let n=e.replace(/。/g,".");return n.startsWith(".")&&(n="0"+n),n},f.z.string().regex(/^\d+(\.\d{1,12})?$/,"请输入合法数值，最多支持12位小数").refine(e=>{let n=(0,w.vz)(e);return null!==n&&n>0n},"质押父币数不能为 0").refine(e=>{let t=(0,w.vz)(e);return null!==t&&t<=n},"质押父币数不能超过当前持有")),stakeToken:f.z.preprocess(e=>{if("string"!=typeof e)return e;let n=e.replace(/。/g,".");return n.startsWith(".")&&(n="0"+n),n},f.z.string().regex(/^\d+(\.\d{1,12})?$/,"请输入合法数值，最多支持12位小数").refine(e=>{let n=(0,w.vz)(e);return null!==n&&n>0n},"质押 token 数不能为 0").refine(e=>{let n=(0,w.vz)(e);return null!==n&&n<=t},"质押 token 数不能超过当前持有")),releasePeriod:f.z.string()}))),defaultValues:{parentToken:"",stakeToken:"",releasePeriod:"4"},mode:"onChange"}),[D,H]=(0,s.useState)(!1),[Q,K]=(0,s.useState)(!1),U=i>0n,Y=J.watch("parentToken"),ee=J.watch("stakeToken"),en=(0,w.vz)(Y),et=(0,w.vz)(ee),{data:er,error:es,isLoading:ea}=C(null!==en?en:0n,[null==E?void 0:E.parentTokenAddress,null==E?void 0:E.address],E,U,D),{data:ei,error:el,isLoading:eo}=S(null!==et?et:0n,[null==E?void 0:E.parentTokenAddress,null==E?void 0:E.address],E,U,Q);(0,s.useEffect)(()=>{if(er&&er.length>1){let e=Number((0,w.bM)(BigInt(er[1]))).toFixed(12).replace(/\.?0+$/,"");J.setValue("stakeToken",e),H(!1),K(!1)}},[er]),(0,s.useEffect)(()=>{if(ei&&ei.length>1){let e=Number((0,w.bM)(BigInt(ei[0]))).toFixed(12).replace(/\.?0+$/,"");J.setValue("parentToken",e),H(!1),K(!1)}},[ei]);let{approve:ed,isWriting:eu,isConfirming:ec,isConfirmed:em,writeError:ef}=(0,A.yA)(null==E?void 0:E.address),{approve:ep,isWriting:eg,isConfirming:ev,isConfirmed:ex,writeError:eh}=(0,A.yA)(null==E?void 0:E.parentTokenAddress);async function ey(e){if((0,T.S)(d))try{let n=(0,w.vz)(e.stakeToken),t=(0,w.vz)(e.parentToken);if(null===n||null===t)throw Error("无效的输入格式");await ed("0xad07a574eeC41371b3618Cd5896E0F1A108e7942",n),await ep("0xad07a574eeC41371b3618Cd5896E0F1A108e7942",t)}catch(e){console.error("Approve failed",e),m.Am.error("授权失败，请检查输入格式")}}(0,s.useEffect)(()=>{(em||ex)&&m.Am.success("授权成功")},[em,ex]);let{stakeLiquidity:ek,isWriting:eb,isConfirming:eT,isConfirmed:ej,writeError:ew}=(0,z.Xc)();async function eN(e){if(!(0,T.S)(d))return;if(!(em&&ex)){m.Am.error("请先完成授权");return}let n=(0,w.vz)(e.stakeToken),t=(0,w.vz)(e.parentToken);if(null===n||null===t){m.Am.error("转换金额时出错，请检查输入格式");return}ek(null==E?void 0:E.address,n,t,BigInt(e.releasePeriod),o).catch(e=>{let n=j(e);m.Am.error(n||"质押失败，请重试"),console.error("Stake failed",e)})}function eA(){m.Am.success("质押成功"),setTimeout(()=>{window.location.href="/gov/?symbol=".concat(null==E?void 0:E.symbol)},2e3)}(0,s.useEffect)(()=>{ej&&((null==E?void 0:E.initialStakeRound)&&E.initialStakeRound>0?eA():Z(!0))},[ej]),(0,s.useEffect)(()=>{X&&!q&&$&&$>0&&(B({...E,initialStakeRound:Number($)}),eA())},[X,q,$]);let{handleContractError:eE}=(0,l.S)();(0,s.useEffect)(()=>{V&&eE(V,"token"),W&&eE(W,"token"),ef&&eE(ef,"stake"),eh&&eE(eh,"stake"),ew&&eE(ew,"stake"),G&&eE(G,"stake"),es&&eE(es,"uniswap"),el&&eE(el,"uniswap")},[V,W,ef,eh,ew,G,es,el]);let eC=eu||eg,eS=ec||ev,ez=em&&ex,eI=eC||eS||ez;return(0,s.useEffect)(()=>{"true"!==P||eI||F({name:"首次质押",message:"部署新代币后，先质押获取治理票，才能进行后续操作"})},[P,eI,F]),(0,s.useEffect)(()=>{M||_||eI||!E||!E.symbol||F({name:"余额不足",message:"您当前".concat(E.symbol,"数量为0，请先获取").concat(E.symbol)}),R||O||eI||!E||!E.parentTokenSymbol||F({name:"余额不足",message:"您当前".concat(E.parentTokenSymbol,"数量为0，请先获取").concat(E.parentTokenSymbol)})},[_,O,E]),(0,r.jsxs)("div",{className:"w-full flex-col items-center p-6 mt-1",children:[(0,r.jsx)("div",{className:"w-full flex justify-between items-center",children:(0,r.jsx)(I.Z,{title:"质押获取治理票"})}),(0,r.jsx)(y.l0,{...J,children:(0,r.jsxs)("form",{onSubmit:J.handleSubmit(eN),className:"w-full max-w-md mt-4 space-y-4",children:[(0,r.jsx)(y.Wi,{control:J.control,name:"parentToken",render:e=>{let{field:n}=e;return(0,r.jsxs)(y.xJ,{children:[(0,r.jsxs)(y.lX,{children:["质押父币数 (当前持有：",(0,r.jsx)("span",{className:"text-secondary-400 mr-2",children:(0,w.LH)(O||0n)}),null==E?void 0:E.parentTokenSymbol,")",(0,r.jsxs)(x(),{href:"/launch/deposit/",className:"text-secondary-400 ml-2",children:["去获取",null==E?void 0:E.parentTokenSymbol]})]}),(0,r.jsx)(y.NI,{children:(0,r.jsx)(b.I,{placeholder:"输入 ".concat(null==E?void 0:E.parentTokenSymbol," 数量"),...n,disabled:eI,onChange:e=>{n.onChange(e),H(!0)},className:"!ring-secondary-foreground"})}),(0,r.jsx)(y.zG,{})]})}}),(0,r.jsx)(y.Wi,{control:J.control,name:"stakeToken",render:e=>{let{field:n}=e;return(0,r.jsxs)(y.xJ,{children:[(0,r.jsxs)(y.lX,{children:["质押 token 数 (当前持有：",(0,r.jsx)("span",{className:"text-secondary-400 mr-2",children:(0,w.LH)(_||0n)}),null==E?void 0:E.symbol,")"]}),(0,r.jsx)(y.NI,{children:(0,r.jsx)(b.I,{placeholder:"输入 ".concat(null==E?void 0:E.symbol," 数量"),...n,disabled:eI,onChange:e=>{n.onChange(e),K(!0)},className:"!ring-secondary-foreground"})}),(0,r.jsx)(y.zG,{})]})}}),(0,r.jsx)(y.Wi,{control:J.control,name:"releasePeriod",render:e=>{let{field:n}=e;return(0,r.jsxs)(y.xJ,{children:[(0,r.jsx)(y.lX,{children:"释放期"}),(0,r.jsx)(y.NI,{children:(0,r.jsxs)(k.Ph,{disabled:eI,onValueChange:e=>n.onChange(e),value:n.value,children:[(0,r.jsx)(k.i4,{className:"w-full !ring-secondary-foreground",children:(0,r.jsx)(k.ki,{placeholder:"选择释放期"})}),(0,r.jsx)(k.Bw,{children:Array.from({length:9},(e,n)=>(0,r.jsx)(k.Ql,{value:String(n+4),children:n+4},n+4))})]})}),(0,r.jsx)(y.pf,{children:"释放期：申请解锁后，几轮之后可以领取。"}),(0,r.jsx)(y.zG,{})]})}}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 mt-4",children:[(0,r.jsx)(h.z,{type:"button",className:"w-1/2",disabled:eI,onClick:J.handleSubmit(ey),children:eC?"1.授权中...":eS?"1.确认中...":ez?"1.已授权":"1.授权"}),(0,r.jsx)(h.z,{type:"submit",className:"w-1/2",disabled:!ez||eb||eT||ej,children:eb?"2.质押中...":eT?"2.确认中...":ej?"2.已质押":"2.质押"})]})]})}),(0,r.jsx)(L.Z,{isLoading:eC||eS||eb||eT||q&&X,text:eC||eb?"提交交易...":"确认交易..."})]})},F=()=>{let{token:e}=(0,s.useContext)(a.M)||{},n=!!(null==e?void 0:e.initialStakeRound)&&(null==e?void 0:e.initialStakeRound)>0,{tokenAmount:t,isPending:u,error:c}=(0,i.tT)(null==e?void 0:e.slTokenAddress,n),{handleContractError:m}=(0,l.S)();return(0,s.useEffect)(()=>{c&&m(c,"slToken")},[c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{title:"质押LP"}),(0,r.jsxs)("main",{className:"flex-grow",children:[u&&n&&(0,r.jsx)("div",{className:"flex justify-center items-center mt-10",children:(0,r.jsx)(d.Z,{})}),(!u||!n)&&(0,r.jsx)(B,{stakedTokenAmountOfLP:t||0n}),(0,r.jsxs)("div",{className:"flex flex-col w-full p-4 mt-4",children:[(0,r.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、所得治理票数 = LP 数量 * 释放期轮次"}),(0,r.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、释放期指：申请解锁后，几轮之后可以领取。最小为4轮，最大为12轮。"})]})]})]})}}},function(e){e.O(0,[1664,2624,7569,4637,5263,7224,5343,2888,9774,179],function(){return e(e.s=52340)}),_N_E=e.O()}]);