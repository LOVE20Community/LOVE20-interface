(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8285],{7054:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[symbol]/vote/vote",function(){return n(14623)}])},74089:function(e,t,n){"use strict";var s=n(85893),r=n(67294),l=n(91529);t.Z=e=>{let{initialTimeLeft:t}=e,[n,i]=(0,r.useState)(t);(0,r.useEffect)(()=>{if(t<=0)return;i(t);let e=setInterval(()=>{i(t=>t<=1?(clearInterval(e),window.location.reload(),0):t-1)},1e3);return()=>{clearInterval(e)}},[t]);let a=(0,l.ZC)(n);return(0,s.jsx)(s.Fragment,{children:a})}},91318:function(e,t,n){"use strict";var s=n(85893);t.Z=()=>(0,s.jsx)("span",{className:"flex justify-center items-center",children:(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},7191:function(e,t,n){"use strict";var s=n(85893);n(67294);var r=n(3125),l=n(74089);t.Z=e=>{let{currentRound:t,roundName:n}=e,{data:i}=(0,r.O)(),a=Number("100")||0,c=Number("12")||0,d=i?a-Number(i)%a:0;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("h1",{className:"text-base text-center font-bold",children:[n,"（第 ",(0,s.jsx)("span",{className:"text-red-500",children:Number(null!=t?t:0n)})," 轮）"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-400 mt-1 pt-0",children:["本轮剩余：",(0,s.jsx)(l.Z,{initialTimeLeft:d>0?d*c:0})]})]})}},14623:function(e,t,n){"use strict";n.r(t);var s=n(85893),r=n(67294),l=n(11163),i=n(92321),a=n(86501),c=n(27245),d=n(41664),o=n.n(d),u=n(91529),m=n(93778),h=n(94782),f=n(92180),x=n(7080),g=n(35337),b=n(91318),p=n(7191);t.default=()=>{let{token:e}=(0,r.useContext)(m.M)||{},[t,n]=(0,r.useState)({}),{address:d}=(0,i.m)(),{currentRound:N,isPending:v,error:j}=(0,x.Bk)(),y=(0,l.useRouter)(),{ids:w}=y.query,[I,B]=(0,r.useState)([]);(0,r.useEffect)(()=>{w&&B(w.split(",").map(e=>parseInt(e,10)))},[w]),(0,r.useEffect)(()=>{if(1===I.length)n({[I[0]]:100});else{let e={},t=Math.floor(100/I.length);I.forEach((n,s)=>{s===I.length-1?e[n]=100-t*(I.length-1):e[n]=t}),n(e)}},[I]);let E=(e,s)=>{if(1===I.length)return;let r={...t,[e]:s},l=I.slice(0,-1).reduce((e,t)=>e+(r[t]||0),0);if(l>100){a.Am.error("投票百分比之和不能超过100%");return}r[I[I.length-1]]=100-l,n(r)},{validGovVotes:C,isPending:_}=(0,f.Ty)(null==e?void 0:e.address,d),{votesNumByAccount:k,isPending:$}=(0,x.VI)(null==e?void 0:e.address,N,d),Z=(null==I?void 0:I.map(e=>BigInt(e)))||[],{actionInfos:M,isPending:O,error:P}=(0,h.fT)(null==e?void 0:e.address,Z),{vote:T,isWriting:q,isConfirming:A,isConfirmed:F,writeError:S}=(0,x.rv)(),z=async()=>{if(100!==Object.values(t).reduce((e,t)=>e+t,0)){a.Am.error("百分比之和必须为100");return}let n=I.map(e=>BigInt(e)),s=I.map(e=>BigInt(t[e]||0)*C/100n);try{await T(null==e?void 0:e.address,n,s)}catch(e){console.error("投票提交失败:",e),a.Am.error("提交失败，请重试")}};return((0,r.useEffect)(()=>{F&&!S&&(a.Am.success("提交成功",{duration:2e3}),setTimeout(()=>{y.push("/".concat(null==e?void 0:e.symbol,"/gov"))},2e3))},[F,S]),e)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{title:"执行投票页"}),(0,s.jsxs)("main",{className:"flex-grow",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4 p-6 bg-white",children:[v?(0,s.jsx)(b.Z,{}):(0,s.jsx)(p.Z,{currentRound:N,roundName:"投票轮"}),(0,s.jsxs)("div",{className:"text-base text-gray-500",children:[(0,s.jsx)("span",{children:"我的剩余票数："}),_||$?(0,s.jsx)(b.Z,{}):(0,u.LH)(C-k||BigInt(0))]})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h2",{className:"text-sm font-bold mb-4 text-gray-600",children:"行动列表 (行动轮)"}),(0,s.jsx)("div",{className:"space-y-4",children:null==M?void 0:M.map((n,r)=>{let l=r===M.length-1,i=100-I.slice(0,-1).reduce((e,n)=>e+(t[n]||0),0);return(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,s.jsxs)(o(),{href:"/".concat(e.symbol,"/action/").concat(n.head.id,"?type=vote"),className:"flex-grow",children:[(0,s.jsxs)("div",{className:"font-semibold mb-2",children:[(0,s.jsx)("span",{className:"text-gray-400 text-base mr-1",children:"No.".concat(n.head.id)}),(0,s.jsx)("span",{className:"text-gray-800 text-lg",children:"".concat(n.body.action)})]}),(0,s.jsx)("p",{className:"leading-tight",children:n.body.consensus})]},n.head.id),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",min:l?i:1,max:"100",value:l?i:t[n.head.id]||"",onChange:e=>E(n.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===I.length||l,placeholder:""}),"%"]})]},n.head.id)})}),(0,s.jsx)("div",{className:"flex justify-center mt-4",children:(0,s.jsx)(c.z,{className:"w-1/2 bg-blue-600 hover:bg-blue-700",onClick:z,disabled:q||A,children:q||A?"提交中...":"提交投票"})}),S?(0,s.jsxs)("div",{className:"text-red-500",children:["Error: ",S.shortMessage||S.message]}):null]})]})]}):""}},21803:function(e,t,n){"use strict";function s(e,t){let[n,s="0"]=e.split("."),r=n.startsWith("-");if(r&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${s}`))&&(n=`${BigInt(n)+1n}`),s="";else if(s.length>t){let[e,r,l]=[s.slice(0,t-1),s.slice(t-1,t),s.slice(t)],i=Math.round(Number(`${r}.${l}`));(s=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>t&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,t)}else s=s.padEnd(t,"0");return BigInt(`${r?"-":""}${n}${s}`)}n.d(t,{v:function(){return s}})},3125:function(e,t,n){"use strict";n.d(t,{O:function(){return m}});var s=n(30202),r=n(97712),l=n(81946),i=n(36100),a=n(82451),c=n(82002),d=n(37122),o=n(65185),u=n(67294);function m(e={}){let{query:t={},watch:n}=e,m=(0,d.Z)(e),h=(0,s.NL)(),f=(0,c.x)({config:m}),x=e.chainId??f,g=function(e,t={}){return{gcTime:0,async queryFn({queryKey:t}){let{scopeKey:n,...s}=t[1];return await function(e,t={}){let{chainId:n,...s}=t,i=e.getClient({chainId:n});return(0,l.s)(i,r.z,"getBlockNumber")(s)}(e,s)??null},queryKey:function(e={}){return["blockNumber",(0,i.OP)(e)]}(t)}}(m,{...e,chainId:x});return!function(e={}){let{enabled:t=!0,onBlockNumber:n,config:s,...r}=e,i=(0,d.Z)(e),a=(0,c.x)({config:i}),m=e.chainId??a;(0,u.useEffect)(()=>{if(t&&n)return function(e,t){let n,s;let{syncConnectedChain:r=e._internal.syncConnectedChain,...i}=t,a=t=>{n&&n();let s=e.getClient({chainId:t});return n=(0,l.s)(s,o.q,"watchBlockNumber")(i)},c=a(t.chainId);return r&&!t.chainId&&(s=e.subscribe(({chainId:e})=>e,async e=>a(e))),()=>{c?.(),s?.()}}(i,{...r,chainId:m,onBlockNumber:n})},[m,i,t,n,r.onError,r.emitMissed,r.emitOnBegin,r.poll,r.pollingInterval,r.syncConnectedChain])}({...{config:e.config,chainId:e.chainId,..."object"==typeof n?n:{}},enabled:!!((t.enabled??!0)&&("object"==typeof n?n.enabled:n)),onBlockNumber(e){h.setQueryData(g.queryKey,e)}}),(0,a.aM)({...t,...g})}}},function(e){e.O(0,[9689,8424,7140,5714,2180,2888,9774,179],function(){return e(e.s=7054)}),_N_E=e.O()}]);