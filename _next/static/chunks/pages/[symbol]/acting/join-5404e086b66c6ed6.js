(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1983],{37158:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[symbol]/acting/join",function(){return l(28722)}])},20725:function(e,s,l){"use strict";var t=l(85893),a=l(67294),n=l(94782),d=l(93778),r=l(91529),i=l(27460),c=l(42083);s.Z=e=>{var s;let{actionId:l,round:o,showSubmitter:x}=e,{token:m}=(0,a.useContext)(d.M)||{},{actionInfo:u,isPending:h,error:v}=(0,n.dI)(null==m?void 0:m.address,l),{actionSubmits:j,isPending:b,error:f}=(0,n.WZ)(null==m?void 0:m.address,x?o:0n),g=(null==j?void 0:null===(s=j.find(e=>e.actionId==Number(l)))||void 0===s?void 0:s.submitter)||"N/A";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2 border-t border-greyscale-100",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==u?void 0:u.head.id.toString()]}),(0,t.jsx)("span",{className:"text-xl font-bold text-black",children:null==u?void 0:u.body.action})]}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("span",{className:"text-greyscale-600",children:null==u?void 0:u.body.consensus})}),(0,t.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,t.jsx)(i.Z,{address:null==u?void 0:u.head.author})]}),x&&(0,t.jsxs)("div",{className:"flex items-center",children:["推举人 ",(0,t.jsx)(i.Z,{address:g})]})]})]}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"参与资产上限"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(0,r.LH)((null==u?void 0:u.body.maxStake)||BigInt(0))})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.maxRandomAccounts.toString())||"-"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationRule)||"-"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"验证信息填写指引"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationInfoGuide)||"-"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,t.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==u?void 0:u.body.whiteList.length)?u.body.whiteList.map((e,s)=>(0,t.jsx)("span",{className:"flex items-center mr-2",children:(0,t.jsx)(i.Z,{address:e})},s)):"无限制"})]})]}),(h||x&&b)&&(0,t.jsx)(c.Z,{}),(v||x&&f)&&(0,t.jsx)("div",{className:"text-center text-sm text-red-500",children:(null==v?void 0:v.message)||(null==f?void 0:f.message)})]})]})}},28722:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return N}});var t=l(85893),a=l(67294),n=l(11163),d=l(94782),r=l(5028),i=l(93778),c=l(58732),o=l(92321),x=l(91529),m=l(64777),u=l(42083),h=e=>{let{actionId:s,onStakedAmountChange:l}=e,{address:n}=(0,o.m)(),{token:d}=(0,a.useContext)(i.M)||{},{stakedAmountByAccountByActionId:c,isPending:h,error:v}=(0,r.um)((null==d?void 0:d.address)||"",n||"",s);return((0,a.useEffect)(()=>{h||null==l||l(c||BigInt(0))},[c,h]),v)?(console.error(v),(0,t.jsx)("div",{children:"加载失败"})):(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)(m.Z,{title:"以往参与"}),(0,t.jsx)("div",{className:"stats w-full border divide-x-0 mt-4",children:(0,t.jsxs)("div",{className:"stat place-items-center",children:[(0,t.jsx)("div",{className:"stat-title",children:"未取回代币"}),(0,t.jsx)("div",{className:"stat-value text-2xl",children:h?(0,t.jsx)(u.Z,{}):(0,x.LH)(c||BigInt(0))}),(0,t.jsx)("div",{className:"stat-desc text-xs text-greyscale-400",children:"之前未取回的代币，再次加入时默认直接参与"})]})})]})},v=l(86501),j=l(27245),b=l(19638),f=e=>{let{actionInfo:s,stakedAmount:l}=e,d=(0,n.useRouter)(),{token:c}=(0,a.useContext)(i.M)||{},{address:u}=(0,o.m)(),[h,f]=(0,a.useState)(""),[g,N]=(0,a.useState)(""),[y,p]=(0,a.useState)(""),{balance:w,error:k}=(0,b.hS)(null==c?void 0:c.address,u),{approve:I,isWriting:S,isConfirmed:C,writeError:B}=(0,b.yA)(null==c?void 0:c.address),{join:A,isPending:Z,isConfirming:_,isConfirmed:E,error:P}=(0,r.z7)(),[L,z]=(0,a.useState)(!1),F=async()=>{if(l&&(0,x.vz)(h)+l>BigInt(s.body.maxStake)){v.Am.error("增加的代币数不能超过最大参与代币数");return}if(!l&&!h){v.Am.error("请输入增加的代币数");return}try{z(!0),await I("0x34Aa27F8d9f85d36d797402BD672Fc9977417f1a",(0,x.vz)(h))}catch(e){console.error("Approve failed",e),z(!1)}};(0,a.useEffect)(()=>{C&&L&&A(null==c?void 0:c.address,BigInt(s.head.id),(0,x.vz)(h),y,BigInt(g)).then(()=>{z(!1)}).catch(e=>{console.error("Stake failed",e),z(!1)})},[C,L]),(0,a.useEffect)(()=>{E&&(v.Am.success("加入成功"),f(""),N(""),p(""),setTimeout(()=>{d.push("/".concat(null==c?void 0:c.symbol,"/action/").concat(s.head.id,"?type=join"))},2e3))},[E]);let H=BigInt(s.body.maxStake)-(l||0n);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"px-6 pt-0 pb-2",children:[(0,t.jsx)(m.Z,{title:"加入行动"}),(0,t.jsxs)("div",{className:"my-4",children:[(0,t.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["增加参与代币: (当前持有：",(0,x.LH)(w||0n)," ",null==c?void 0:c.symbol,")"]}),(0,t.jsx)("input",{type:"number",disabled:H<=0n,placeholder:H>0n?"".concat(null==c?void 0:c.symbol," 数量，不能超过 ").concat((0,x.LH)(H)):"已到最大".concat((0,x.LH)(BigInt(s.body.maxStake)),"，不能再追加"),value:h,onChange:e=>f(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"参与轮数:"}),(0,t.jsx)("input",{type:"number",placeholder:"输入参数轮数",value:g,onChange:e=>N(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"验证信息:"}),(0,t.jsx)("textarea",{placeholder:"".concat(null==s?void 0:s.body.verificationInfoGuide),value:y,onChange:e=>p(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsx)("div",{className:"flex justify-center",children:E?(0,t.jsx)(j.z,{className:"mt-4 w-1/2",children:"提交成功"}):(0,t.jsx)(j.z,{onClick:F,disabled:Z||_,className:"mt-4 w-1/2",children:Z||_?"提交中...":"提交"})}),k&&(0,t.jsx)("div",{className:"text-red-500 text-center",children:k.message}),B&&(0,t.jsx)("div",{className:"text-red-500 text-center",children:B.message}),P&&(0,t.jsx)("div",{className:"text-red-500 text-center",children:P.message})]})})},g=l(20725),N=()=>{let{id:e}=(0,n.useRouter)().query,[s,l]=(0,a.useState)(void 0),{token:o}=(0,a.useContext)(i.M)||{},{currentRound:x,isPending:m,error:v}=(0,r.Bk)(),{actionInfo:j,isPending:b,error:N}=(0,d.dI)(null==o?void 0:o.address,void 0===e?void 0:BigInt(e));return!e||Array.isArray(e)||b||m?(0,t.jsx)(u.Z,{}):N||v?(console.error(N,v),(0,t.jsx)("div",{children:"加载失败"})):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{title:"加入行动"}),(0,t.jsxs)("main",{className:"flex-grow",children:[(0,t.jsx)(h,{actionId:BigInt(e),onStakedAmountChange:function(e){l(e)}}),(0,t.jsx)(f,{actionInfo:j,stakedAmount:s}),(0,t.jsxs)("div",{className:"flex flex-col w-full rounded p-4",children:[(0,t.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,t.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,t.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、轮次结束后，可随时在我的页面取回参与的代币，或者继续参与此行动的之后轮次"})]}),(0,t.jsx)(g.Z,{actionId:BigInt(e),round:x,showSubmitter:!1})]})]})}}},function(e){e.O(0,[7221,1502,4637,6697,2888,9774,179],function(){return e(e.s=37158)}),_N_E=e.O()}]);