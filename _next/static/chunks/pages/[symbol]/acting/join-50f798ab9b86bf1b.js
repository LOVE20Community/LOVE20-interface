(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1983],{37158:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[symbol]/acting/join",function(){return l(28722)}])},20725:function(e,s,l){"use strict";var t=l(85893),a=l(67294),d=l(94782),n=l(93778),r=l(91529),i=l(27460),c=l(42083);s.Z=e=>{var s;let{actionId:l,round:o,showSubmitter:x}=e,{token:m}=(0,a.useContext)(n.M)||{},{actionInfo:u,isPending:h,error:v}=(0,d.dI)(null==m?void 0:m.address,l),{actionSubmits:f,isPending:j,error:b}=(0,d.WZ)(null==m?void 0:m.address,x?o:0n),g=(null==f?void 0:null===(s=f.find(e=>e.actionId==Number(l)))||void 0===s?void 0:s.submitter)||"N/A";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2 border-t border-greyscale-100",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==u?void 0:u.head.id.toString()]}),(0,t.jsx)("span",{className:"text-xl font-bold text-black",children:null==u?void 0:u.body.action})]}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("span",{className:"text-greyscale-600",children:null==u?void 0:u.body.consensus})}),(0,t.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,t.jsx)(i.Z,{address:null==u?void 0:u.head.author})]}),x&&(0,t.jsxs)("div",{className:"flex items-center",children:["推举人 ",(0,t.jsx)(i.Z,{address:g})]})]})]}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"参与资产上限"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(0,r.LH)((null==u?void 0:u.body.maxStake)||BigInt(0))})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.maxRandomAccounts.toString())||"-"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationRule)||"-"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"验证信息填写指引"}),(0,t.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationInfoGuide)||"-"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,t.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==u?void 0:u.body.whiteList.length)?u.body.whiteList.map((e,s)=>(0,t.jsx)("span",{className:"flex items-center mr-2",children:(0,t.jsx)(i.Z,{address:e})},s)):"无限制"})]})]}),(h||x&&j)&&(0,t.jsx)(c.Z,{}),(v||x&&b)&&(0,t.jsx)("div",{className:"text-center text-sm text-red-500",children:(null==v?void 0:v.message)||(null==b?void 0:b.message)})]})]})}},28722:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return g}});var t=l(85893),a=l(67294),d=l(11163),n=l(94782),r=l(5028),i=l(93778),c=l(58732),o=l(92321),x=l(42083),m=l(91529),u=e=>{let{actionId:s,onStakedAmountChange:l}=e,{address:d}=(0,o.m)(),{token:n}=(0,a.useContext)(i.M)||{},{stakedAmountByAccountByActionId:c,isPending:u,error:h}=(0,r.um)((null==n?void 0:n.address)||"",d||"",s);return((0,a.useEffect)(()=>{u||null==l||l(c||BigInt(0))},[c,u]),h)?(console.error(h),(0,t.jsx)("div",{children:"加载失败"})):(0,t.jsx)("div",{className:"flex items-end w-full p-4",children:(0,t.jsx)("div",{className:"stats w-full border divide-x-0",children:(0,t.jsxs)("div",{className:"stat place-items-center",children:[(0,t.jsx)("div",{className:"stat-title",children:"待参与代币数"}),(0,t.jsx)("div",{className:"stat-value text-2xl",children:u?(0,t.jsx)(x.Z,{}):(0,m.LH)(c||BigInt(0))}),(0,t.jsx)("div",{className:"stat-desc text-xs text-greyscale-400",children:"参与之前的轮次，未取回的代币"})]})})})},h=l(86501),v=l(27245),f=l(19638),j=e=>{let{actionInfo:s,stakedAmount:l}=e,n=(0,d.useRouter)(),{token:c}=(0,a.useContext)(i.M)||{},{address:x}=(0,o.m)(),[u,j]=(0,a.useState)(""),[b,g]=(0,a.useState)(""),[N,y]=(0,a.useState)(""),{balance:p,error:w}=(0,f.hS)(null==c?void 0:c.address,x),{approve:k,isWriting:I,isConfirmed:S,writeError:C}=(0,f.yA)(null==c?void 0:c.address),{join:B,isPending:A,isConfirming:_,isConfirmed:Z,error:E}=(0,r.z7)(),[P,L]=(0,a.useState)(!1),z=async()=>{if(l&&(0,m.vz)(u)+l>BigInt(s.body.maxStake)){h.Am.error("增加的代币数不能超过最大参与代币数");return}if(!l&&!u){h.Am.error("请输入增加的代币数");return}try{L(!0),await k("0x34Aa27F8d9f85d36d797402BD672Fc9977417f1a",(0,m.vz)(u))}catch(e){console.error("Approve failed",e),L(!1)}};(0,a.useEffect)(()=>{S&&P&&B(null==c?void 0:c.address,BigInt(s.head.id),(0,m.vz)(u),N,BigInt(b)).then(()=>{L(!1)}).catch(e=>{console.error("Stake failed",e),L(!1)})},[S,P]),(0,a.useEffect)(()=>{Z&&(h.Am.success("加入成功"),j(""),g(""),y(""),setTimeout(()=>{n.push("/".concat(null==c?void 0:c.symbol,"/action/").concat(s.head.id,"?type=join"))},2e3))},[Z]);let F=BigInt(s.body.maxStake)-(l||0n);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"w-full flex flex-col rounded px-6 pt-0 pb-2",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["增加参与代币: (当前持有：",(0,m.LH)(p||0n)," ",null==c?void 0:c.symbol,")"]}),(0,t.jsx)("input",{type:"number",disabled:F<=0n,placeholder:F>0n?"".concat(null==c?void 0:c.symbol," 数量，不能超过 ").concat((0,m.LH)(F)):"已到最大".concat((0,m.LH)(BigInt(s.body.maxStake)),"，不能再追加"),value:u,onChange:e=>j(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"参与轮数:"}),(0,t.jsx)("input",{type:"number",placeholder:"输入参数轮数",value:b,onChange:e=>g(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"验证信息:"}),(0,t.jsx)("textarea",{placeholder:"".concat(null==s?void 0:s.body.verificationInfoGuide),value:N,onChange:e=>y(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsx)("div",{className:"flex justify-center",children:Z?(0,t.jsx)(v.z,{className:"mt-4 w-1/2",children:"加入成功"}):(0,t.jsx)(v.z,{onClick:z,disabled:A||_,className:"mt-4 w-1/2",children:A||_?"加入中...":"加入行动"})}),w&&(0,t.jsx)("div",{className:"text-red-500 text-center",children:w.message}),C&&(0,t.jsx)("div",{className:"text-red-500 text-center",children:C.message}),E&&(0,t.jsx)("div",{className:"text-red-500 text-center",children:E.message})]})})},b=l(20725),g=()=>{let{id:e}=(0,d.useRouter)().query,[s,l]=(0,a.useState)(void 0),{token:o}=(0,a.useContext)(i.M)||{},{currentRound:m,isPending:h,error:v}=(0,r.Bk)(),{actionInfo:f,isPending:g,error:N}=(0,n.dI)(null==o?void 0:o.address,void 0===e?void 0:BigInt(e));return!e||Array.isArray(e)||g||h?(0,t.jsx)(x.Z,{}):N||v?(console.error(N,v),(0,t.jsx)("div",{children:"加载失败"})):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{title:"加入行动"}),(0,t.jsxs)("main",{className:"flex-grow",children:[(0,t.jsx)(u,{actionId:BigInt(e),onStakedAmountChange:function(e){l(e)}}),(0,t.jsx)(j,{actionInfo:f,stakedAmount:s}),(0,t.jsxs)("div",{className:"flex flex-col w-full rounded p-4",children:[(0,t.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,t.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,t.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、轮次结束后，可随时在我的页面取回参与的代币，或者继续参与此行动的之后轮次"})]}),(0,t.jsx)(b.Z,{actionId:BigInt(e),round:m,showSubmitter:!1})]})]})}}},function(e){e.O(0,[7221,1502,2432,6697,2888,9774,179],function(){return e(e.s=37158)}),_N_E=e.O()}]);