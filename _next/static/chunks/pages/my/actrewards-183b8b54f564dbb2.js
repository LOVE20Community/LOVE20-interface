(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9178],{94515:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return t(72510)}])},72510:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var r=t(85893),n=t(67294),l=t(11163),a=t(35337),i=t(87250),c=t(20725),d=t(91318),x=t(92321),o=t(86501),m=t(5028),u=t(93778),h=t(22877),b=e=>{let{actionId:s,currentRound:t}=e,{address:l}=(0,x.m)(),{token:a}=(0,n.useContext)(u.M)||{},{stakedAmountByAccountByActionId:i,isPending:c,error:b}=(0,m.um)((null==a?void 0:a.address)||"",l||"",s),{lastJoinedRound:j,isPending:g,error:f}=(0,m.NP)((null==a?void 0:a.address)||"",l||"",s),{withdraw:N,isPending:p,isConfirming:w,isConfirmed:v,error:y}=(0,m.Qc)(),C=async()=>{await N((null==a?void 0:a.address)||"",s)};return((0,n.useEffect)(()=>{v&&(o.Am.success("取回成功"),setTimeout(()=>{window.location.reload()},2e3))},[v]),c||g)?(0,r.jsx)(d.Z,{}):b||f?(console.error(b,f),(0,r.jsx)("div",{className:"text-red-500",children:"加载失败"})):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6 pb-8 bg-base-100 mb-4",children:[(0,r.jsxs)("div",{className:"flex w-full justify-center space-x-20",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"我参与的代币数"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:(0,h.L)(i||BigInt(0))})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"参加到第几轮"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:null==j?void 0:j.toString()})]})]}),i<=0?(0,r.jsx)("button",{className:"text-gray-500 btn btn-disabled",disabled:!0,children:"已取回"}):j&&Number(j)+1<Number(t)?(0,r.jsx)("button",{className:"btn-primary btn w-1/2",onClick:C,disabled:p||w,children:p||w?(0,r.jsx)(d.Z,{}):"取回代币"}):(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["提示：到第 ",(1+Number(j)).toString()," 轮后可取回"]})]}),b&&(0,r.jsx)("div",{className:"text-red-500",children:b.message}),f&&(0,r.jsx)("div",{className:"text-red-500",children:f.message}),y&&(0,r.jsx)("div",{className:"text-red-500",children:y.message})]})},j=t(45551),g=t(7399),f=t(27460),N=e=>{let{round:s,actionId:t}=e,{token:l}=(0,n.useContext)(u.M)||{},{address:a}=(0,x.m)(),{verifiedAddresses:i,isPending:c,error:o}=(0,j.pK)(null==l?void 0:l.address,s,t),[m,b]=(0,n.useState)([]);(0,n.useEffect)(()=>{i&&b(i)},[i]);let{mintActionReward:N,isWriting:p,isConfirming:w,isConfirmed:v,writeError:y}=(0,g.Rb)(),C=async e=>{a&&e.reward>0&&(await N(null==l?void 0:l.address,s,t),v&&b(s=>s.map(s=>s.account===e.account?{...s,reward:0n}:s)))};return c?(0,r.jsx)(d.Z,{}):o?(0,r.jsxs)("div",{children:["发生错误: ",o.message]}):(0,r.jsxs)("div",{className:"relative pt-4 pl-4 bg-base-100 mb-4",children:[(0,r.jsx)("h2",{className:"relative pl-4 text-gray-700 text-base font-medium before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-1 before:bg-red-500",children:"验证地址结果"}),0===m.length?(0,r.jsx)("div",{className:"text-center text-sm text-gray-500",children:"没有验证地址"}):(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"地址"}),(0,r.jsx)("th",{children:"得分"}),(0,r.jsx)("th",{children:"奖励"}),(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:m.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)(f.Z,{address:e.account,showCopyButton:!1})}),(0,r.jsx)("td",{children:(0,h.L)(e.score)}),(0,r.jsx)("td",{children:(0,h.L)(e.reward)}),(0,r.jsx)("td",{children:e.account===a?e.reward>0?(0,r.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>C(e),disabled:p||w,children:"领取"}):e.score>0?(0,r.jsx)("span",{className:"text-gray-500",children:"已领取"}):"":""})]},e.account))})]}),y&&(0,r.jsx)("div",{className:"text-red-500",children:y.message}),(p||w)&&(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-500 bg-opacity-50 flex items-center justify-center z-20",children:(0,r.jsxs)("div",{className:"text-white text-lg flex items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),"正在提交中..."]})})]})},p=()=>{let{id:e}=(0,l.useRouter)().query,{currentRound:s,isPending:t,error:x}=(0,i.Bk)(),[o,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),j=()=>m(!o),g=e=>{h(e),m(!1)};return(0,n.useEffect)(()=>{h(s>0?Number(s)-1:null)},[s]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{title:"行动详情"}),(0,r.jsxs)("main",{className:"flex-grow",children:[(0,r.jsx)("div",{className:"flex flex-col items-center space-y-6 p-4 bg-base-100 border-t border-gray-100",children:(0,r.jsx)("h1",{className:"text-base text-center",children:t?(0,r.jsx)(d.Z,{}):s>0?(0,r.jsxs)(r.Fragment,{children:["已完成 (第",(0,r.jsx)("span",{className:"text-red-500",children:Number(u)}),"轮)",(0,r.jsx)("button",{onClick:j,className:"ml-4 px-2 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"切换轮次"})]}):"没有完成的轮次"})}),(0,r.jsx)(b,{actionId:BigInt(e||0),currentRound:s}),(0,r.jsx)(N,{round:null!==u?BigInt(u):0n,actionId:BigInt(e||0)}),t?(0,r.jsx)(d.Z,{}):(0,r.jsx)(c.Z,{actionId:BigInt(e||0),round:null!==u?BigInt(u):0n,showSubmitter:s>0}),o&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-72",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-center mb-4",children:"选择轮次"}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,t)=>{let n=Number(s)-1-t;return(0,r.jsxs)("div",{className:"p-2 text-center cursor-pointer hover:bg-gray-100",onClick:()=>g(n),children:["第 ",n," 轮"]},n)})}),(0,r.jsx)("button",{onClick:j,className:"mt-4 px-4 py-2 bg-gray-300 text-gray-700 rounded-md w-full hover:bg-gray-400",children:"取消"})]})})]})]})}}},function(e){e.O(0,[8554,6789,8205,5551,7250,7399,379,2888,9774,179],function(){return e(e.s=94515)}),_N_E=e.O()}]);