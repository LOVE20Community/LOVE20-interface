(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9178],{94515:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return s(72510)}])},91529:function(e,t,s){"use strict";s.d(t,{LH:function(){return l},Vu:function(){return i},bM:function(){return c},vz:function(){return a}});var r=s(21803),n=s(15229);let i=e=>e?"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"",l=e=>{let t=c(e);return new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(Number(t))},a=e=>{let t=parseInt("18",10);return(0,r.v)(e,t)},c=e=>{let t=parseInt("18",10);return(0,n.b)(e,t)}},72510:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var r=s(85893),n=s(67294),i=s(11163),l=s(35337),a=s(87250),c=s(20725),d=s(91318),o=s(92321),u=s(86501),x=s(5028),m=s(93778),h=s(91529),b=e=>{let{actionId:t,currentRound:s}=e,{address:i}=(0,o.m)(),{token:l}=(0,n.useContext)(m.M)||{},{stakedAmountByAccountByActionId:a,isPending:c,error:b}=(0,x.um)((null==l?void 0:l.address)||"",i||"",t),{lastJoinedRound:f,isPending:g,error:j}=(0,x.NP)((null==l?void 0:l.address)||"",i||"",t),{withdraw:N,isPending:p,isConfirming:v,isConfirmed:w,error:y}=(0,x.Qc)(),I=async()=>{await N((null==l?void 0:l.address)||"",t)};return((0,n.useEffect)(()=>{w&&(u.Am.success("取回成功"),setTimeout(()=>{window.location.reload()},2e3))},[w]),c||g)?(0,r.jsx)(d.Z,{}):b||j?(console.error(b,j),(0,r.jsx)("div",{className:"text-red-500",children:"加载失败"})):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6 pb-8 bg-base-100 mb-4",children:[(0,r.jsxs)("div",{className:"flex w-full justify-center space-x-20",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"我参与的代币数"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:(0,h.LH)(a||BigInt(0))})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"参加到第几轮"}),(0,r.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:null==f?void 0:f.toString()})]})]}),a<=0?(0,r.jsx)("button",{className:"text-gray-500 btn btn-disabled",disabled:!0,children:"已取回"}):f&&Number(f)+1<Number(s)?(0,r.jsx)("button",{className:"btn-primary btn w-1/2",onClick:I,disabled:p||v,children:p||v?(0,r.jsx)(d.Z,{}):"取回代币"}):(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["提示：到第 ",(1+Number(f)).toString()," 轮后可取回"]})]}),b&&(0,r.jsx)("div",{className:"text-red-500",children:b.message}),j&&(0,r.jsx)("div",{className:"text-red-500",children:j.message}),y&&(0,r.jsx)("div",{className:"text-red-500",children:y.message})]})},f=s(45551),g=s(7399),j=s(27460),N=e=>{let{round:t,actionId:s}=e,{token:i}=(0,n.useContext)(m.M)||{},{address:l}=(0,o.m)(),{verifiedAddresses:a,isPending:c,error:u}=(0,f.pK)(null==i?void 0:i.address,t,s),[x,b]=(0,n.useState)([]);(0,n.useEffect)(()=>{a&&b(a)},[a]);let{mintActionReward:N,isWriting:p,isConfirming:v,isConfirmed:w,writeError:y}=(0,g.Rb)(),I=async e=>{l&&e.reward>0&&(await N(null==i?void 0:i.address,t,s),w&&b(t=>t.map(t=>t.account===e.account?{...t,reward:0n}:t)))};return c?(0,r.jsx)(d.Z,{}):u?(0,r.jsxs)("div",{children:["发生错误: ",u.message]}):(0,r.jsxs)("div",{className:"relative pt-4 pl-4 bg-base-100 mb-4",children:[(0,r.jsx)("h2",{className:"relative pl-4 text-gray-700 text-base font-medium before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-1 before:bg-red-500",children:"验证地址结果"}),0===x.length?(0,r.jsx)("div",{className:"text-center text-sm text-gray-500",children:"没有验证地址"}):(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"地址"}),(0,r.jsx)("th",{children:"得分"}),(0,r.jsx)("th",{children:"奖励"}),(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:x.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)(j.Z,{address:e.account,showCopyButton:!1})}),(0,r.jsx)("td",{children:(0,h.LH)(e.score)}),(0,r.jsx)("td",{children:(0,h.LH)(e.reward)}),(0,r.jsx)("td",{children:e.account===l?e.reward>0?(0,r.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>I(e),disabled:p||v,children:"领取"}):e.score>0?(0,r.jsx)("span",{className:"text-gray-500",children:"已领取"}):"":""})]},e.account))})]}),y&&(0,r.jsx)("div",{className:"text-red-500",children:y.message}),(p||v)&&(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-500 bg-opacity-50 flex items-center justify-center z-20",children:(0,r.jsxs)("div",{className:"text-white text-lg flex items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),"正在提交中..."]})})]})},p=()=>{let{id:e}=(0,i.useRouter)().query,{currentRound:t,isPending:s,error:o}=(0,a.Bk)(),[u,x]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),f=()=>x(!u),g=e=>{h(e),x(!1)};return(0,n.useEffect)(()=>{h(t>0?Number(t)-1:null)},[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Z,{title:"行动详情"}),(0,r.jsxs)("main",{className:"flex-grow",children:[(0,r.jsx)("div",{className:"flex flex-col items-center space-y-6 p-4 bg-base-100 border-t border-gray-100",children:(0,r.jsx)("h1",{className:"text-base text-center",children:s?(0,r.jsx)(d.Z,{}):t>0?(0,r.jsxs)(r.Fragment,{children:["已完成 (第",(0,r.jsx)("span",{className:"text-red-500",children:Number(m)}),"轮)",(0,r.jsx)("button",{onClick:f,className:"ml-4 px-2 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"切换轮次"})]}):"没有完成的轮次"})}),(0,r.jsx)(b,{actionId:BigInt(e||0),currentRound:t}),(0,r.jsx)(N,{round:null!==m?BigInt(m):0n,actionId:BigInt(e||0)}),s?(0,r.jsx)(d.Z,{}):(0,r.jsx)(c.Z,{actionId:BigInt(e||0),round:null!==m?BigInt(m):0n,showSubmitter:t>0}),u&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-72",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-center mb-4",children:"选择轮次"}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(t)},(e,s)=>{let n=Number(t)-1-s;return(0,r.jsxs)("div",{className:"p-2 text-center cursor-pointer hover:bg-gray-100",onClick:()=>g(n),children:["第 ",n," 轮"]},n)})}),(0,r.jsx)("button",{onClick:f,className:"mt-4 px-4 py-2 bg-gray-300 text-gray-700 rounded-md w-full hover:bg-gray-400",children:"取消"})]})})]})]})}},21803:function(e,t,s){"use strict";function r(e,t){let[s,r="0"]=e.split("."),n=s.startsWith("-");if(n&&(s=s.slice(1)),r=r.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${r}`))&&(s=`${BigInt(s)+1n}`),r="";else if(r.length>t){let[e,n,i]=[r.slice(0,t-1),r.slice(t-1,t),r.slice(t)],l=Math.round(Number(`${n}.${i}`));(r=l>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${l}`).length>t&&(r=r.slice(1),s=`${BigInt(s)+1n}`),r=r.slice(0,t)}else r=r.padEnd(t,"0");return BigInt(`${n?"-":""}${s}${r}`)}s.d(t,{v:function(){return r}})},89810:function(e,t,s){"use strict";s.d(t,{u:function(){return c}});var r=s(37003),n=s(36100),i=s(82451),l=s(82002),a=s(37122);function c(e={}){let{abi:t,address:s,functionName:c,query:d={}}=e,o=e.code,u=(0,a.Z)(e),x=(0,l.x)({config:u}),m=function(e,t={}){return{async queryFn({queryKey:s}){let n=t.abi;if(!n)throw Error("abi is required");let{functionName:i,scopeKey:l,...a}=s[1],c=(()=>{let e=s[1];if(e.address)return{address:e.address};if(e.code)return{code:e.code};throw Error("address or code is required")})();if(!i)throw Error("functionName is required");return(0,r.L)(e,{abi:n,functionName:i,args:a.args,...c,...a})},queryKey:function(e={}){let{abi:t,...s}=e;return["readContract",(0,n.OP)(s)]}(t)}}(u,{...e,chainId:e.chainId??x}),h=!!((s||o)&&t&&c&&(d.enabled??!0));return(0,i.aM)({...d,...m,enabled:h,structuralSharing:d.structuralSharing??n.if})}}},function(e){e.O(0,[9215,6789,3601,5551,7250,7399,379,2888,9774,179],function(){return e(e.s=94515)}),_N_E=e.O()}]);