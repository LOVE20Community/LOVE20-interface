(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3487],{66030:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(11989)}])},20725:function(e,s,t){"use strict";var l=t(85893),a=t(67294),n=t(94782),i=t(93778),r=t(91529),d=t(27460),c=t(42083);s.Z=e=>{var s;let{actionId:t,round:o,showSubmitter:x}=e,{token:m}=(0,a.useContext)(i.M)||{},{actionInfo:u,isPending:h,error:v}=(0,n.dI)(null==m?void 0:m.address,t),{actionSubmits:j,isPending:f,error:g}=(0,n.WZ)(null==m?void 0:m.address,x?o:0n),b=(null==j?void 0:null===(s=j.find(e=>e.actionId==Number(t)))||void 0===s?void 0:s.submitter)||"N/A";return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2 border-t border-greyscale-100",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==u?void 0:u.head.id.toString()]}),(0,l.jsx)("span",{className:"text-xl font-bold text-black",children:null==u?void 0:u.body.action})]}),(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)("span",{className:"text-greyscale-600",children:null==u?void 0:u.body.consensus})}),(0,l.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,l.jsx)(d.Z,{address:null==u?void 0:u.head.author})]}),x&&(0,l.jsxs)("div",{className:"flex items-center",children:["推举人 ",(0,l.jsx)(d.Z,{address:b})]})]})]}),(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"参与资产上限"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(0,r.LH)((null==u?void 0:u.body.maxStake)||BigInt(0))})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.maxRandomAccounts.toString())||"-"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationRule)||"-"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"验证信息填写指引"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationInfoGuide)||"-"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,l.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==u?void 0:u.body.whiteList.length)?u.body.whiteList.map((e,s)=>(0,l.jsx)("span",{className:"flex items-center mr-2",children:(0,l.jsx)(d.Z,{address:e})},s)):"无限制"})]})]}),(h||x&&f)&&(0,l.jsx)(c.Z,{}),(v||x&&g)&&(0,l.jsx)("div",{className:"text-center text-sm text-red-500",children:(null==v?void 0:v.message)||(null==g?void 0:g.message)})]})]})}},42083:function(e,s,t){"use strict";var l=t(85893),a=t(23432);s.Z=()=>(0,l.jsx)(a.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},44576:function(e,s,t){"use strict";var l=t(85893);t(67294);var a=t(23432);s.Z=e=>{let{isLoading:s}=e;return s?(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(a.Z,{className:"mx-auto h-8 w-8 animate-spin text-white"}),(0,l.jsx)("p",{className:"mt-2 text-sm font-medium text-white",children:"Loading"})]})}):null}},11989:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var l=t(85893),a=t(67294),n=t(11163),i=t(94782),r=t(5028),d=t(93778),c=t(58732),o=t(92321),x=t(91529),m=t(42083),u=e=>{let{actionId:s,onStakedAmountChange:t}=e,{address:n}=(0,o.m)(),{token:i}=(0,a.useContext)(d.M)||{},{stakedAmountByAccountByActionId:c,isPending:u,error:h}=(0,r.um)((null==i?void 0:i.address)||"",n||"",s);return((0,a.useEffect)(()=>{u||null==t||t(c||BigInt(0))},[c,u]),h)?(console.error(h),(0,l.jsx)("div",{children:"加载失败"})):(0,l.jsx)("div",{className:"px-6 pt-1 pb-4",children:(0,l.jsx)("div",{className:"stats w-full divide-x-0",children:(0,l.jsxs)("div",{className:"stat place-items-center",children:[(0,l.jsx)("div",{className:"stat-title",children:"未取回代币"}),(0,l.jsx)("div",{className:"stat-value text-2xl text-secondary",children:u?(0,l.jsx)(m.Z,{}):(0,x.LH)(c||BigInt(0))}),(0,l.jsx)("div",{className:"stat-desc text-xs text-greyscale-400",children:"之前未取回的代币，再次加入时默认直接参与"})]})})})},h=t(86501),v=t(27245),j=t(19638),f=t(64777),g=t(44576),b=t(78543),N=e=>{let{actionInfo:s,stakedAmount:t}=e,i=(0,n.useRouter)(),{token:c}=(0,a.useContext)(d.M)||{},{address:m,chain:u}=(0,o.m)(),[N,y]=(0,a.useState)(""),[p,w]=(0,a.useState)(""),[k,I]=(0,a.useState)(""),{balance:C,error:S}=(0,j.hS)(null==c?void 0:c.address,m),{approve:Z,isWriting:A,isConfirming:B,isConfirmed:_,writeError:L}=(0,j.yA)(null==c?void 0:c.address),E=async()=>{if((0,b.S)(u)){if(t&&(0,x.vz)(N)+t>BigInt(s.body.maxStake)){h.Am.error("增加的代币数不能超过最大参与代币数");return}if(!t&&!N){h.Am.error("请输入增加的代币数");return}try{await Z("0x34Aa27F8d9f85d36d797402BD672Fc9977417f1a",(0,x.vz)(N))}catch(e){console.error("Approve failed",e)}}},{join:P,isPending:z,isConfirming:F,isConfirmed:H,error:M}=(0,r.z7)(),R=async()=>{if((0,b.S)(u))try{await P(null==c?void 0:c.address,BigInt(s.head.id),(0,x.vz)(N),k,BigInt(p))}catch(e){console.error("Join failed",e)}};(0,a.useEffect)(()=>{H&&(h.Am.success("加入成功"),y(""),w(""),I(""),setTimeout(()=>{i.push("/action/".concat(s.head.id,"?type=join&symbol=").concat(null==c?void 0:c.symbol))},2e3))},[H]);let T=BigInt(s.body.maxStake)-(t||0n);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"px-6 pt-0 pb-2",children:[(0,l.jsx)(f.Z,{title:"加入行动"}),(0,l.jsxs)("div",{className:"my-4",children:[(0,l.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["增加参与代币: (当前持有：",(0,x.LH)(C||0n)," ",null==c?void 0:c.symbol,")"]}),(0,l.jsx)("input",{type:"number",disabled:T<=0n,placeholder:T>0n?"".concat(null==c?void 0:c.symbol," 数量，不能超过 ").concat((0,x.LH)(T)):"已到最大".concat((0,x.LH)(BigInt(s.body.maxStake)),"，不能再追加"),value:N,onChange:e=>y(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"参与轮数:"}),(0,l.jsx)("input",{type:"number",placeholder:"输入参数轮数",value:p,onChange:e=>w(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"验证信息:"}),(0,l.jsx)("textarea",{placeholder:"".concat(null==s?void 0:s.body.verificationInfoGuide),value:k,onChange:e=>I(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,l.jsx)(v.z,{className:"w-1/2",disabled:A||B||_,onClick:E,children:A||B?"1.授权中...":_?"1.已授权":"1.授权"}),(0,l.jsx)(v.z,{className:"w-1/2",disabled:!_||z||F,onClick:R,children:z||F?"2.加入中...":H?"2.已加入":"2.加入"})]}),S&&(0,l.jsx)("div",{className:"text-red-500 text-center",children:S.message}),L&&(0,l.jsx)("div",{className:"text-red-500 text-center",children:L.message}),M&&(0,l.jsx)("div",{className:"text-red-500 text-center",children:M.message})]}),(0,l.jsx)(g.Z,{isLoading:A||B||z||F})]})},y=t(20725),p=()=>{let{id:e}=(0,n.useRouter)().query,[s,t]=(0,a.useState)(void 0),{token:o}=(0,a.useContext)(d.M)||{},{currentRound:x,isPending:h,error:v}=(0,r.Bk)(),{actionInfo:j,isPending:f,error:g}=(0,i.dI)(null==o?void 0:o.address,void 0===e?void 0:BigInt(e));return!e||Array.isArray(e)||f||h?(0,l.jsx)(m.Z,{}):g||v?(console.error(g,v),(0,l.jsx)("div",{children:"加载失败"})):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.Z,{title:"加入行动"}),(0,l.jsxs)("main",{className:"flex-grow",children:[(0,l.jsx)(u,{actionId:BigInt(e),onStakedAmountChange:function(e){t(e)}}),(0,l.jsx)(N,{actionInfo:j,stakedAmount:s}),(0,l.jsxs)("div",{className:"flex flex-col w-full rounded p-4",children:[(0,l.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,l.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,l.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、轮次结束后，可随时在我的页面取回参与的代币，或者继续参与此行动的之后轮次"})]}),(0,l.jsx)(y.Z,{actionId:BigInt(e),round:x,showSubmitter:!1})]})]})}},78543:function(e,s,t){"use strict";t.d(s,{S:function(){return a}});var l=t(86501);let a=e=>!!e||(l.Am.error("请先将钱包链接 ".concat("sepolia")),!1)}},function(e){e.O(0,[530,1502,4637,9871,2888,9774,179],function(){return e(e.s=66030)}),_N_E=e.O()}]);