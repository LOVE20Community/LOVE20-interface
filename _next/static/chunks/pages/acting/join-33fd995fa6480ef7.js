(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3487],{66030:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(11989)}])},20725:function(e,s,t){"use strict";var l=t(85893),a=t(67294),r=t(94782),n=t(93778),i=t(91529),d=t(27460),c=t(42083);s.Z=e=>{var s;let{actionId:t,round:o,showSubmitter:x}=e,{token:m}=(0,a.useContext)(n.M)||{},{actionInfo:u,isPending:h,error:v}=(0,r.dI)(null==m?void 0:m.address,t),{actionSubmits:j,isPending:f,error:g}=(0,r.WZ)(null==m?void 0:m.address,x?o:0n),b=(null==j?void 0:null===(s=j.find(e=>e.actionId==Number(t)))||void 0===s?void 0:s.submitter)||"N/A";return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2 border-t border-greyscale-100",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("span",{className:"text-sm text-greyscale-500",children:["No.",null==u?void 0:u.head.id.toString()]}),(0,l.jsx)("span",{className:"text-xl font-bold text-black",children:null==u?void 0:u.body.action})]}),(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)("span",{className:"text-greyscale-600",children:null==u?void 0:u.body.consensus})}),(0,l.jsxs)("div",{className:"mt-0 text-xs text-greyscale-500 flex justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:["创建人 ",(0,l.jsx)(d.Z,{address:null==u?void 0:u.head.author})]}),x&&(0,l.jsxs)("div",{className:"flex items-center",children:["推举人 ",(0,l.jsx)(d.Z,{address:b})]})]})]}),(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-6 pt-4 pb-2",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"参与资产上限"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(0,i.LH)((null==u?void 0:u.body.maxStake)||BigInt(0))})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"随机奖励地址数"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.maxRandomAccounts.toString())||"-"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"验证规则"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationRule)||"-"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"验证信息填写指引"}),(0,l.jsx)("p",{className:"text-greyscale-500",children:(null==u?void 0:u.body.verificationInfoGuide)||"-"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"text-sm font-bold",children:"白名单"}),(0,l.jsx)("p",{className:"text-greyscale-500 flex flex-wrap items-center",children:(null==u?void 0:u.body.whiteList.length)?u.body.whiteList.map((e,s)=>(0,l.jsx)("span",{className:"flex items-center mr-2",children:(0,l.jsx)(d.Z,{address:e})},s)):"无限制"})]})]}),(h||x&&f)&&(0,l.jsx)(c.Z,{}),(v||x&&g)&&(0,l.jsx)("div",{className:"text-center text-sm text-red-500",children:(null==v?void 0:v.message)||(null==g?void 0:g.message)})]})]})}},42083:function(e,s,t){"use strict";var l=t(85893);s.Z=()=>(0,l.jsx)("span",{className:"flex justify-center items-center",children:(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3 text-greyscale-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]})})},11989:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var l=t(85893),a=t(67294),r=t(11163),n=t(94782),i=t(5028),d=t(93778),c=t(58732),o=t(92321),x=t(91529),m=t(64777),u=t(42083),h=e=>{let{actionId:s,onStakedAmountChange:t}=e,{address:r}=(0,o.m)(),{token:n}=(0,a.useContext)(d.M)||{},{stakedAmountByAccountByActionId:c,isPending:h,error:v}=(0,i.um)((null==n?void 0:n.address)||"",r||"",s);return((0,a.useEffect)(()=>{h||null==t||t(c||BigInt(0))},[c,h]),v)?(console.error(v),(0,l.jsx)("div",{children:"加载失败"})):(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)(m.Z,{title:"以往参与"}),(0,l.jsx)("div",{className:"stats w-full border divide-x-0 mt-4",children:(0,l.jsxs)("div",{className:"stat place-items-center",children:[(0,l.jsx)("div",{className:"stat-title",children:"未取回代币"}),(0,l.jsx)("div",{className:"stat-value text-2xl",children:h?(0,l.jsx)(u.Z,{}):(0,x.LH)(c||BigInt(0))}),(0,l.jsx)("div",{className:"stat-desc text-xs text-greyscale-400",children:"之前未取回的代币，再次加入时默认直接参与"})]})})]})},v=t(86501),j=t(27245),f=t(19638),g=e=>{let{actionInfo:s,stakedAmount:t}=e,n=(0,r.useRouter)(),{token:c}=(0,a.useContext)(d.M)||{},{address:u}=(0,o.m)(),[h,g]=(0,a.useState)(""),[b,N]=(0,a.useState)(""),[y,p]=(0,a.useState)(""),{balance:w,error:k}=(0,f.hS)(null==c?void 0:c.address,u),{approve:I,isWriting:C,isConfirmed:S,writeError:B}=(0,f.yA)(null==c?void 0:c.address),{join:Z,isPending:A,isConfirming:_,isConfirmed:E,error:P}=(0,i.z7)(),[z,L]=(0,a.useState)(!1),H=async()=>{if(t&&(0,x.vz)(h)+t>BigInt(s.body.maxStake)){v.Am.error("增加的代币数不能超过最大参与代币数");return}if(!t&&!h){v.Am.error("请输入增加的代币数");return}try{L(!0),await I("0x34Aa27F8d9f85d36d797402BD672Fc9977417f1a",(0,x.vz)(h))}catch(e){console.error("Approve failed",e),L(!1)}};(0,a.useEffect)(()=>{S&&z&&Z(null==c?void 0:c.address,BigInt(s.head.id),(0,x.vz)(h),y,BigInt(b)).then(()=>{L(!1)}).catch(e=>{console.error("Stake failed",e),L(!1)})},[S,z]),(0,a.useEffect)(()=>{E&&(v.Am.success("加入成功"),g(""),N(""),p(""),setTimeout(()=>{n.push("/action/".concat(s.head.id,"?type=join&symbol=").concat(null==c?void 0:c.symbol))},2e3))},[E]);let F=BigInt(s.body.maxStake)-(t||0n);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"px-6 pt-0 pb-2",children:[(0,l.jsx)(m.Z,{title:"加入行动"}),(0,l.jsxs)("div",{className:"my-4",children:[(0,l.jsxs)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:["增加参与代币: (当前持有：",(0,x.LH)(w||0n)," ",null==c?void 0:c.symbol,")"]}),(0,l.jsx)("input",{type:"number",disabled:F<=0n,placeholder:F>0n?"".concat(null==c?void 0:c.symbol," 数量，不能超过 ").concat((0,x.LH)(F)):"已到最大".concat((0,x.LH)(BigInt(s.body.maxStake)),"，不能再追加"),value:h,onChange:e=>g(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"参与轮数:"}),(0,l.jsx)("input",{type:"number",placeholder:"输入参数轮数",value:b,onChange:e=>N(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-left mb-1 text-sm text-greyscale-500",children:"验证信息:"}),(0,l.jsx)("textarea",{placeholder:"".concat(null==s?void 0:s.body.verificationInfoGuide),value:y,onChange:e=>p(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,l.jsx)("div",{className:"flex justify-center",children:E?(0,l.jsx)(j.z,{className:"mt-4 w-1/2",children:"提交成功"}):(0,l.jsx)(j.z,{onClick:H,disabled:A||_,className:"mt-4 w-1/2",children:A||_?"提交中...":"提交"})}),k&&(0,l.jsx)("div",{className:"text-red-500 text-center",children:k.message}),B&&(0,l.jsx)("div",{className:"text-red-500 text-center",children:B.message}),P&&(0,l.jsx)("div",{className:"text-red-500 text-center",children:P.message})]})})},b=t(20725),N=()=>{let{id:e}=(0,r.useRouter)().query,[s,t]=(0,a.useState)(void 0),{token:o}=(0,a.useContext)(d.M)||{},{currentRound:x,isPending:m,error:v}=(0,i.Bk)(),{actionInfo:j,isPending:f,error:N}=(0,n.dI)(null==o?void 0:o.address,void 0===e?void 0:BigInt(e));return!e||Array.isArray(e)||f||m?(0,l.jsx)(u.Z,{}):N||v?(console.error(N,v),(0,l.jsx)("div",{children:"加载失败"})):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.Z,{title:"加入行动"}),(0,l.jsxs)("main",{className:"flex-grow",children:[(0,l.jsx)(h,{actionId:BigInt(e),onStakedAmountChange:function(e){t(e)}}),(0,l.jsx)(g,{actionInfo:j,stakedAmount:s}),(0,l.jsxs)("div",{className:"flex flex-col w-full rounded p-4",children:[(0,l.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-2",children:"规则说明："}),(0,l.jsx)("div",{className:"text-sm text-greyscale-500",children:"1、参与代币越多，被选中验证并获得奖励的概率越大"}),(0,l.jsx)("div",{className:"text-sm text-greyscale-500",children:"2、轮次结束后，可随时在我的页面取回参与的代币，或者继续参与此行动的之后轮次"})]}),(0,l.jsx)(b.Z,{actionId:BigInt(e),round:x,showSubmitter:!1})]})]})}}},function(e){e.O(0,[7221,1502,4637,9871,2888,9774,179],function(){return e(e.s=66030)}),_N_E=e.O()}]);